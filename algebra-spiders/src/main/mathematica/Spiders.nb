(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[         0,          0]
NotebookDataLength[    348949,       8516]
NotebookOptionsPosition[    333953,       8053]
NotebookOutlinePosition[    334371,       8071]
CellTagsIndexPosition[    334328,       8068]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Spiders`", "Chapter",
 InitializationCell->True,
 CellChangeTimes->{{3.6436045450930347`*^9, 3.643604576642725*^9}}],

Cell["\<\
A Mathematica package for investigating skein theories, by Scott Morrison and \
Noah Snyder\
\>", "Text",
 InitializationCell->True,
 CellChangeTimes->{{3.6436045494022093`*^9, 3.643604582090026*^9}}],

Cell[BoxData[
 RowBox[{"SetOptions", "[", 
  RowBox[{
   RowBox[{"InputNotebook", "[", "]"}], ",", 
   RowBox[{"AutoGeneratedPackage", "\[Rule]", "Automatic"}]}], "]"}]], "Input",\

 CellChangeTimes->{{3.6436056919285307`*^9, 3.643605691930431*^9}}],

Cell[CellGroupData[{

Cell["Declaring subpackages", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{{3.420291037988891*^9, 3.420291045960354*^9}, {
  3.4202953396844254`*^9, 3.4202953402652607`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"DeclarePackage", "[", 
   RowBox[{"\"\<Spiders`Trivalent`\>\"", ",", 
    RowBox[{"{", 
     RowBox[{
     "\"\<Trivalent\>\"", ",", "\"\<SO3Categories\>\"", ",", 
      "\"\<dMinusOne\>\"", ",", "\"\<SO3\>\"", ",", 
      "\"\<CubicTrivalentCategories\>\"", ",", 
      "\"\<CubicTrivalentCategory\>\"", ",", "\"\<G2Categories\>\"", ",", 
      "\"\<ABACategories\>\"", ",", "\"\<PickledG2\>\""}], "}"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DeclarePackage", "[", 
   RowBox[{"\"\<Spiders`BraidedTrivalent`\>\"", ",", 
    RowBox[{"{", 
     RowBox[{
     "\"\<BraidedTrivalent\>\"", ",", "\"\<SymmetricTrivalent\>\"", ",", 
      "\"\<BraidedSO3Categories\>\"", ",", 
      "\"\<CubicBraidedTrivalentCategories\>\"", ",", 
      "\"\<CubicBraidedTrivalent\>\"", ",", "\"\<BraidedG2Categories\>\""}], 
     "}"}]}], "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.420291117603371*^9, 3.420291118895229*^9}, {
   3.4202913849377794`*^9, 3.420291388132373*^9}, {3.4202920292742896`*^9, 
   3.4202920418123183`*^9}, {3.4202927560893984`*^9, 
   3.4202927623383837`*^9}, {3.42045421068404*^9, 3.4204542737647457`*^9}, {
   3.422309142772846*^9, 3.422309143143379*^9}, {3.4223200548937054`*^9, 
   3.4223200573272047`*^9}, {3.422375248668456*^9, 3.422375252814418*^9}, {
   3.4223758021242867`*^9, 3.422375814021394*^9}, {3.4325166524374104`*^9, 
   3.432516656923388*^9}, {3.432761815099677*^9, 3.4327618166418943`*^9}, {
   3.432764768646669*^9, 3.43276477939212*^9}, {3.4330380029733086`*^9, 
   3.4330380035441294`*^9}, {3.433967209088317*^9, 3.4339672122328386`*^9}, {
   3.434302768103797*^9, 3.4343027688749056`*^9}, {3.4343096082895007`*^9, 
   3.4343096097015314`*^9}, {3.4343930690519533`*^9, 3.434393073788765*^9}, {
   3.4345639820139456`*^9, 3.4345639841069555`*^9}, {3.434744344966757*^9, 
   3.4347443466792192`*^9}, {3.4354440045850115`*^9, 
   3.4354440057466817`*^9}, {3.4457949428591948`*^9, 3.445794945712213*^9}, {
   3.4459128520720263`*^9, 3.445912852970158*^9}, 3.446846035638986*^9, {
   3.4475529354378366`*^9, 3.447552946262328*^9}, {3.452449185709619*^9, 
   3.452449190202622*^9}, {3.46284809518544*^9, 3.4628481036430807`*^9}, {
   3.463943116119879*^9, 3.463943117779564*^9}, {3.466796765560052*^9, 
   3.466796768949822*^9}, {3.469391560478197*^9, 3.469391563293811*^9}, {
   3.469391731593257*^9, 3.469391736056587*^9}, {3.5076580159586897`*^9, 
   3.5076580178103113`*^9}, {3.594943240217538*^9, 3.594943241490148*^9}, {
   3.6436046571271544`*^9, 3.643604670893689*^9}, {3.643606614988442*^9, 
   3.643606615821991*^9}, {3.64360688925073*^9, 3.643606981980482*^9}, {
   3.6436268397653313`*^9, 3.643626843078961*^9}, {3.664568819788179*^9, 
   3.6645688218183804`*^9}}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"DeclarePackage", "::", "aldec"}], "MessageName"], ":", 
  " ", "\<\"Symbol \[NoBreak]\\!\\(\\\"Trivalent\\\"\\)\[NoBreak] in \
\[NoBreak]\\!\\(DeclarePackage[\\(\\(\\\"Spiders`Trivalent`\\\", \
\\(\\({\\\"Trivalent\\\", \\\"SO3Categories\\\", \\\"dMinusOne\\\", \\\"SO3\\\
\", \\\"CubicTrivalentCategories\\\", \\\"CubicTrivalentCategory\\\", \
\\\"G2Categories\\\", \\\"ABACategories\\\", \
\\\"PickledG2\\\"}\\)\\)\\)\\)]\\)\[NoBreak] has already been declared. \
\\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", \
ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/DeclarePackage/aldec\\\", ButtonNote -> \\\
\"DeclarePackage::aldec\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.667440877158041*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"DeclarePackage", "::", "aldec"}], "MessageName"], ":", 
  " ", "\<\"Symbol \[NoBreak]\\!\\(\\\"SO3Categories\\\"\\)\[NoBreak] in \
\[NoBreak]\\!\\(DeclarePackage[\\(\\(\\\"Spiders`Trivalent`\\\", \
\\(\\({\\\"Trivalent\\\", \\\"SO3Categories\\\", \\\"dMinusOne\\\", \\\"SO3\\\
\", \\\"CubicTrivalentCategories\\\", \\\"CubicTrivalentCategory\\\", \
\\\"G2Categories\\\", \\\"ABACategories\\\", \
\\\"PickledG2\\\"}\\)\\)\\)\\)]\\)\[NoBreak] has already been declared. \
\\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", \
ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/DeclarePackage/aldec\\\", ButtonNote -> \\\
\"DeclarePackage::aldec\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.667440877203641*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"DeclarePackage", "::", "aldec"}], "MessageName"], ":", 
  " ", "\<\"Symbol \[NoBreak]\\!\\(\\\"dMinusOne\\\"\\)\[NoBreak] in \
\[NoBreak]\\!\\(DeclarePackage[\\(\\(\\\"Spiders`Trivalent`\\\", \
\\(\\({\\\"Trivalent\\\", \\\"SO3Categories\\\", \\\"dMinusOne\\\", \\\"SO3\\\
\", \\\"CubicTrivalentCategories\\\", \\\"CubicTrivalentCategory\\\", \
\\\"G2Categories\\\", \\\"ABACategories\\\", \
\\\"PickledG2\\\"}\\)\\)\\)\\)]\\)\[NoBreak] has already been declared. \
\\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", ButtonStyle->\\\"Link\\\", \
ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/DeclarePackage/aldec\\\", ButtonNote -> \\\
\"DeclarePackage::aldec\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.667440877207637*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"General", "::", "stop"}], "MessageName"], ":", 
  " ", "\<\"Further output of \[NoBreak]\\!\\(\\*StyleBox[\\(DeclarePackage \
:: aldec\\), \\\"MessageName\\\"]\\)\[NoBreak] will be suppressed during this \
calculation. \\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", \
ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/General/stop\\\", ButtonNote -> \
\\\"General::stop\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.667440877255175*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"DeclarePackage", "::", "aldec"}], "MessageName"], ":", 
  " ", "\<\"Symbol \[NoBreak]\\!\\(\\\"BraidedTrivalent\\\"\\)\[NoBreak] in \
\[NoBreak]\\!\\(DeclarePackage[\\(\\(\\\"Spiders`BraidedTrivalent`\\\", \
\\(\\({\\\"BraidedTrivalent\\\", \\\"SymmetricTrivalent\\\", \
\\\"BraidedSO3Categories\\\", \\\"CubicBraidedTrivalentCategories\\\", \
\\\"CubicBraidedTrivalent\\\", \\\"BraidedG2Categories\\\"}\\)\\)\\)\\)]\\)\
\[NoBreak] has already been declared. \\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\
\\\", ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/DeclarePackage/aldec\\\", ButtonNote -> \\\
\"DeclarePackage::aldec\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.667440877260038*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"DeclarePackage", "::", "aldec"}], "MessageName"], ":", 
  " ", "\<\"Symbol \[NoBreak]\\!\\(\\\"SymmetricTrivalent\\\"\\)\[NoBreak] in \
\[NoBreak]\\!\\(DeclarePackage[\\(\\(\\\"Spiders`BraidedTrivalent`\\\", \
\\(\\({\\\"BraidedTrivalent\\\", \\\"SymmetricTrivalent\\\", \
\\\"BraidedSO3Categories\\\", \\\"CubicBraidedTrivalentCategories\\\", \
\\\"CubicBraidedTrivalent\\\", \\\"BraidedG2Categories\\\"}\\)\\)\\)\\)]\\)\
\[NoBreak] has already been declared. \\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\
\\\", ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/DeclarePackage/aldec\\\", ButtonNote -> \\\
\"DeclarePackage::aldec\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.6674408772641373`*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"DeclarePackage", "::", "aldec"}], "MessageName"], ":", 
  " ", "\<\"Symbol \[NoBreak]\\!\\(\\\"BraidedSO3Categories\\\"\\)\[NoBreak] \
in \[NoBreak]\\!\\(DeclarePackage[\\(\\(\\\"Spiders`BraidedTrivalent`\\\", \
\\(\\({\\\"BraidedTrivalent\\\", \\\"SymmetricTrivalent\\\", \
\\\"BraidedSO3Categories\\\", \\\"CubicBraidedTrivalentCategories\\\", \
\\\"CubicBraidedTrivalent\\\", \\\"BraidedG2Categories\\\"}\\)\\)\\)\\)]\\)\
\[NoBreak] has already been declared. \\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\
\\\", ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/DeclarePackage/aldec\\\", ButtonNote -> \\\
\"DeclarePackage::aldec\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.667440877305233*^9}],

Cell[BoxData[
 RowBox[{
  StyleBox[
   RowBox[{"General", "::", "stop"}], "MessageName"], ":", 
  " ", "\<\"Further output of \[NoBreak]\\!\\(\\*StyleBox[\\(DeclarePackage \
:: aldec\\), \\\"MessageName\\\"]\\)\[NoBreak] will be suppressed during this \
calculation. \\!\\(\\*ButtonBox[\\\"\[RightSkeleton]\\\", \
ButtonStyle->\\\"Link\\\", ButtonFrame->None, \
ButtonData:>\\\"paclet:ref/message/General/stop\\\", ButtonNote -> \
\\\"General::stop\\\"]\\)\"\>"}]], "Message", "MSG",
 CellChangeTimes->{3.66744087731006*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Print loading statement", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{{3.4202910743011055`*^9, 3.4202910795386367`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Print", "[", "\[IndentingNewLine]", 
  "\"\<Loading Spiders` version 2015-06-18 ...\>\"", "\[IndentingNewLine]", 
  "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.420291094860669*^9, 3.4202911096118803`*^9}, {
   3.64360467451751*^9, 3.6436046897552757`*^9}, 3.6436062248938*^9}],

Cell[BoxData["\<\"Loading Spiders` version 2015-06-18 ...\"\>"], "Print",
 CellChangeTimes->{3.667157497176635*^9, 3.667157693067165*^9, 
  3.667163099426716*^9, 3.667440877355844*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["The core package", "Section",
 InitializationCell->True,
 CellChangeTimes->{{3.420291084395621*^9, 3.4202910873398542`*^9}, {
  3.420291344749992*^9, 3.420291345451*^9}, {3.420291407660453*^9, 
  3.420291409573203*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"BeginPackage", "[", 
   RowBox[{"\"\<Spiders`\>\"", ",", 
    RowBox[{"{", 
     RowBox[{"\"\<JLink`\>\"", ",", "\"\<GuessingPolynomials`\>\""}], "}"}]}],
    "]"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.4202911560186095`*^9, 3.4202911587124834`*^9}, {
   3.420295014256483*^9, 3.4202950158788157`*^9}, {3.4202954024747133`*^9, 
   3.42029543357944*^9}, {3.4202954793853054`*^9, 3.4202955565763006`*^9}, {
   3.4202956106340322`*^9, 3.420295640847477*^9}, {3.643604693829954*^9, 
   3.643604730663877*^9}, 3.64362889065841*^9, {3.643888839960338*^9, 
   3.643888843584415*^9}}],

Cell[BoxData[
 RowBox[{"h", ";", "t", ";", "d", ";", "z", ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643606688185375*^9, 3.643606688374896*^9}, {
   3.6436068101715517`*^9, 3.6436068159287157`*^9}, 3.6436289251594143`*^9}],

Cell[BoxData[
 RowBox[{"ScalaSingleton", ";", "ScalaCaseClass", ";", "FromScalaObject", ";",
   "AsScalaObject", ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6436049067415133`*^9, 3.643604923415689*^9}, {
   3.643605806006961*^9, 3.643605823528779*^9}, 3.643628926266213*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Diagram", ";", "NamedPolyhedron", ";", "PlanarGraphs", ";", 
  "polygon", ";", "Name", ";", "DrawPlanarGraph", ";", 
  "DrawReducingRelations", ";", "DrawRelations"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643604955267066*^9, 3.643604968239443*^9}, {
   3.643605823960834*^9, 3.643605825467445*^9}, 3.643628927415464*^9, {
   3.666991881143012*^9, 3.666991885956607*^9}}],

Cell[BoxData["DrawRelations"], "Output",
 CellChangeTimes->{3.666991899058289*^9, 3.667157497221695*^9, 
  3.667157693124497*^9, 3.667163099500518*^9, 3.667440877444663*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{"unionDiagrams", ";", "complementDiagrams", ";", "memberQDiagrams", 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643604975941514*^9, 3.643604980846593*^9}, {
   3.643605825861874*^9, 3.6436058262076178`*^9}, 3.643628928285295*^9}],

Cell[BoxData[
 RowBox[{"SaveGroebnerCalculations", ";", "LoadGroebnerCalculations", 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.639792491945012*^9, 3.6397924965109262`*^9}, {
   3.643604997613728*^9, 3.64360500506649*^9}, 3.643605826566387*^9, 
   3.643628929201954*^9}],

Cell[BoxData[
 RowBox[{"IntroduceNewVariable", ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{3.643628930215086*^9}],

Cell[BoxData[
 RowBox[{"Manifold", ";", "DeclarePolynomialZero", ";", 
  "DeclarePolynomialsZero", ";", "DeclareAtLeastOnePolynomialZero", ";", 
  "DeclareAtLeastOnePolynomialNonZero", ";", "DeclarePolynomialNonZero", ";", 
  "DeclarePolynomialsNonZero", ";", "DeclarePolynomialEitherZeroOrNonZero", 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643604868875517*^9, 3.643604883613524*^9}, {
   3.643605033989997*^9, 3.643605034169765*^9}, {3.643605827064665*^9, 
   3.6436058289212303`*^9}, {3.643606654950947*^9, 3.6436066570193377`*^9}, 
   3.643628931374511*^9, {3.6730898135651608`*^9, 3.673089813857298*^9}}],

Cell[BoxData[
 RowBox[{"DeclareDimensionBounds", ";", "DimensionBounds", ";", 
  "DimensionLowerBound", ";", "DimensionUpperBound", ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643605095771995*^9, 3.6436051737751837`*^9}, {
   3.643605829618196*^9, 3.643605830643652*^9}, 3.643628932482808*^9}],

Cell[BoxData[
 RowBox[{"p", ";", "tt", ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643606670580126*^9, 3.643606671731707*^9}, 
   3.6436289336290627`*^9}],

Cell[BoxData[
 RowBox[{"IndependentDiagrams", ";", "DependentDiagrams", ";", "SpanningSets",
   ";", "ReducingRelations", ";", "NonReducingRelations", ";", 
  "AppendIndependentDiagram", ";", "AppendDependentDiagram", ";", 
  "AppendClosedDiagram", ";", "ReducedDiagrams", ";", "ReducibleDiagrams", 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643605095771995*^9, 3.6436051737751837`*^9}, {
   3.643605831112342*^9, 3.643605834891511*^9}, 3.6436289350248203`*^9, {
   3.6640065556245203`*^9, 3.664006556867599*^9}}],

Cell[BoxData[
 RowBox[{"SpiderAnalysis", ";", "buildSpiderAnalysis", ";", "FreeSpider", ";",
   "emptySpiderAnalysis", ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643605149795582*^9, 3.643605175989421*^9}, {
   3.643605835799965*^9, 3.64360583638234*^9}, {3.6436288826968393`*^9, 
   3.6436288829434967`*^9}, 3.643628935908761*^9}],

Cell[BoxData[
 RowBox[{"internalValences", ";", "diagramWeight", ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6436052266018*^9, 3.643605226802528*^9}, 
   3.643605836921831*^9, 3.643628937728969*^9}],

Cell[BoxData[
 RowBox[{"EvaluateDiagram", ";", "EvaluateClosedDiagram", ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643605231684935*^9, 3.643605231949671*^9}, 
   3.643605837400096*^9, 3.64362893904733*^9}],

Cell[BoxData[
 RowBox[{"ClosedDiagrams", ";", "ConsiderClosedDiagram", ";", 
  "ConsiderClosedDiagrams", ";", "ReconsiderClosedDiagrams", ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643605239353279*^9, 3.643605246388352*^9}, {
   3.643605294490994*^9, 3.643605294661327*^9}, {3.643605837962327*^9, 
   3.643605839060789*^9}, 3.643628940446905*^9}],

Cell[BoxData[
 RowBox[{"ConsiderPotentialSpanningSet", ";", "DeclareSpanningSet", ";", 
  "DeclareBasis", ";", "ConsiderDiagrams", ";", "ConsiderDiagram", ";", 
  "ConsiderIndependentDiagram", ";", "ConsiderDependentDiagram", ";", 
  "IntroduceRelation", ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6436052649025793`*^9, 3.643605292993987*^9}, {
   3.64360541872784*^9, 3.6436054222998343`*^9}, {3.643605470266749*^9, 
   3.643605470480298*^9}, {3.6436058396182337`*^9, 3.643605843266551*^9}, 
   3.643628941823153*^9}],

Cell[BoxData[
 RowBox[{"PairRelationsWith", ";", "ReducePolynomials", ";", 
  "ReducePolynomialsFurther", ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643605319159449*^9, 3.64360532098769*^9}, {
   3.6436058441005793`*^9, 3.643605844636722*^9}, 3.6436289430506268`*^9}],

Cell[BoxData[
 RowBox[{"PickleSpiderAnalysis", ";", "UnpickleSpiderAnalysis", ";", 
  "PickledSpiderAnalysis", ";", "PickledQuotientSpider", ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643604853468566*^9, 3.643604855109346*^9}, 
   3.643605845352047*^9, {3.643626800627792*^9, 3.643626806180974*^9}, 
   3.64362894410878*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}]], "Input",
 InitializationCell->True],

Cell[CellGroupData[{

Cell["Scala interface", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.639695149466408*^9, 3.639695154413146*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SpidersMathematicaDirectory", "=", 
   RowBox[{
    RowBox[{"FileNames", "[", 
     RowBox[{"Cases", "[", 
      RowBox[{
       RowBox[{"$Path", "~", "Join", "~", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"Quiet", "[", 
           RowBox[{"{", 
            RowBox[{"NotebookDirectory", "[", "]"}], "}"}], "]"}], "/.", 
          RowBox[{"$Failed", "\[Rule]", 
           RowBox[{"{", "}"}]}]}], ")"}]}], ",", 
       RowBox[{"s_", "/;", 
        RowBox[{"StringMatchQ", "[", 
         RowBox[{"s", ",", 
          RowBox[{
          "__", "~~", "\"\<toolkit/algebra-spiders/src/main/mathematica\>\"", 
           "~~", "___"}]}], "]"}]}]}], "]"}], "]"}], "\[LeftDoubleBracket]", 
    "1", "\[RightDoubleBracket]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.644254228848028*^9, 3.644254230829771*^9}, 
   3.661458787296886*^9, {3.661458822012547*^9, 3.6614588307885723`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"SpidersDirectory", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{
     "SpidersMathematicaDirectory", ",", "\"\<..\>\"", ",", "\"\<..\>\"", 
      ",", "\"\<..\>\""}], "}"}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.620615134091938*^9, 3.6206151457129593`*^9}, 
   3.620615239685563*^9, 3.6436060971667223`*^9, 3.643606165717702*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ScalaMajorVersion", "=", "\"\<2.12\>\""}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6206151682519627`*^9, 3.6206151702992373`*^9}, 
   3.620615238961542*^9, {3.7159664140192213`*^9, 3.7159664140457983`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"AddToClassPath", "[", 
   RowBox[{"FileNames", "[", 
    RowBox[{"ToFileName", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"SpidersDirectory", ",", "\"\<target\>\"", ",", 
        RowBox[{"\"\<scala-\>\"", "<>", "ScalaMajorVersion"}], ",", 
        "\"\<classes\>\""}], "}"}], ",", "\"\<log4j.xml\>\""}], "]"}], "]"}], 
   "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AddToClassPath", "[", 
   RowBox[{"FileNames", "[", 
    RowBox[{"ToFileName", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"SpidersDirectory", ",", "\"\<..\>\""}], "}"}], ",", 
      RowBox[{
      "\"\<*/target/scala-\>\"", "<>", "ScalaMajorVersion", "<>", 
       "\"\</*.jar\>\""}]}], "]"}], "]"}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AddToClassPath", "[", 
   RowBox[{"FileNames", "[", 
    RowBox[{"ToFileName", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "SpidersDirectory", ",", "\"\<..\>\"", ",", "\"\<lib_managed\>\"", 
        ",", "\"\<jars\>\""}], "}"}], ",", "\"\<*/*/*.jar\>\""}], "]"}], 
    "]"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AddToClassPath", "[", 
   RowBox[{"FileNames", "[", 
    RowBox[{"ToFileName", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "SpidersDirectory", ",", "\"\<..\>\"", ",", "\"\<lib_managed\>\"", 
        ",", "\"\<bundles\>\""}], "}"}], ",", "\"\<*/*/*.jar\>\""}], "]"}], 
    "]"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AddToClassPath", "[", 
   RowBox[{"FileNames", "[", 
    RowBox[{"{", 
     RowBox[{"ToFileName", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"SpidersDirectory", ",", "\"\<target\>\"", ",", 
         RowBox[{"\"\<scala-\>\"", "<>", "ScalaMajorVersion"}]}], "}"}], ",", 
       "\"\<*.jar\>\""}], "]"}], "}"}], "]"}], "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.62061515077351*^9, 3.62061515663029*^9}, {
  3.6206152019928713`*^9, 3.620615232387548*^9}, {3.620615357968029*^9, 
  3.62061536473571*^9}, {3.620615432590061*^9, 3.6206154814738703`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ScalaSingleton", "[", "className_String", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"LoadJavaClass", "[", 
      RowBox[{"className", "<>", "\"\<$\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Symbol", "[", 
      RowBox[{
       RowBox[{"StringReplace", "[", 
        RowBox[{"className", ",", 
         RowBox[{"\"\<.\>\"", "\[Rule]", "\"\<`\>\""}]}], "]"}], "<>", 
       "\"\<$`MODULE$\>\""}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.620615680466634*^9, 3.620615719606987*^9}, {
  3.620615752979535*^9, 3.6206157658834877`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ScalaCaseClass", "[", 
   RowBox[{"className_String", ",", "arguments___"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"o", ",", "applyTypes", ",", "a"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"LoadJavaClass", "[", 
      RowBox[{"className", "<>", "\"\<$\>\""}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"o", "=", 
      RowBox[{"Symbol", "[", 
       RowBox[{
        RowBox[{"StringReplace", "[", 
         RowBox[{"className", ",", 
          RowBox[{"\"\<.\>\"", "\[Rule]", "\"\<`\>\""}]}], "]"}], "<>", 
        "\"\<$`MODULE$\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"applyTypes", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"StringCases", "[", 
           RowBox[{"#", ",", 
            RowBox[{
             RowBox[{
             "className", "~~", "\"\< apply(\>\"", "~~", "types__", "~~", 
              "\"\<)\>\""}], "\[RuleDelayed]", " ", 
             RowBox[{"StringSplit", "[", 
              RowBox[{"types", ",", "\"\<, \>\""}], "]"}]}]}], "]"}], "&"}], "/@", 
         RowBox[{"StringSplit", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"o", "//", "Methods"}], "//", "ToString"}], ",", 
           "\"\<\\n\>\""}], "]"}]}], ",", "1"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"a", "=", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "applyTypes", "]"}], "\[Equal]", "1"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"AsScalaObject", "@@", "#"}], "&"}], "/@", 
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", "arguments", "}"}], ",", 
            RowBox[{
            "applyTypes", "\[LeftDoubleBracket]", "1", 
             "\[RightDoubleBracket]"}]}], "}"}], "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"AsScalaObject", "/@", "arguments"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"o", "@", 
      RowBox[{"apply", "[", 
       RowBox[{"Sequence", "@@", "a"}], "]"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.620616049511447*^9, 3.62061612779088*^9}, {
  3.620616199220964*^9, 3.62061620208167*^9}, {3.620616284445912*^9, 
  3.6206163705023518`*^9}, {3.620616466135068*^9, 3.620616466446186*^9}, {
  3.620616515026765*^9, 3.620616520866987*^9}, {3.620616611028926*^9, 
  3.620616678441863*^9}, {3.620616914384459*^9, 3.62061695311658*^9}, {
  3.620617379356743*^9, 3.62061739933346*^9}, {3.620617613578689*^9, 
  3.6206177347186937`*^9}, {3.6206178319915333`*^9, 3.620617832351356*^9}, {
  3.6210665333680696`*^9, 3.621066533634903*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"LoadJavaClass", "[", 
   RowBox[{"\"\<scala.collection.immutable.List$\>\"", ",", 
    RowBox[{"\"\<AllowShortContext\>\"", "\[Rule]", "False"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"LoadJavaClass", "[", 
   RowBox[{"\"\<scala.collection.immutable.Set$\>\"", ",", 
    RowBox[{"\"\<AllowShortContext\>\"", "\[Rule]", "False"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"LoadJavaClass", "[", 
   RowBox[{"\"\<scala.collection.immutable.Map$\>\"", ",", 
    RowBox[{"\"\<AllowShortContext\>\"", "\[Rule]", "False"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"LoadJavaClass", "[", 
   RowBox[{"\"\<scala.Some$\>\"", ",", 
    RowBox[{"\"\<AllowShortContext\>\"", "\[Rule]", "False"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"LoadJavaClass", "[", 
   RowBox[{"\"\<scala.None$\>\"", ",", 
    RowBox[{"\"\<AllowShortContext\>\"", "\[Rule]", "False"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"LoadJavaClass", "[", 
   RowBox[{"\"\<java.util.Arrays\>\"", ",", 
    RowBox[{"\"\<AllowShortContext\>\"", "\[Rule]", "False"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"LoadJavaClass", "[", 
   RowBox[{"\"\<scala.collection.JavaConversions\>\"", ",", 
    RowBox[{"\"\<AllowShortContext\>\"", "\[Rule]", "False"}]}], "]"}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6206171377083406`*^9, 3.620617142109476*^9}}],

Cell[BoxData[
 RowBox[{"Clear", "[", "FromScalaObject", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.62107136398026*^9, 3.621071366766077*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"FromScalaObject", "[", 
   RowBox[{"o_", ",", "0"}], "]"}], ":=", "o"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621071356363893*^9, 3.621071362525692*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"FromScalaObject", "[", 
   RowBox[{
    RowBox[{"o_", "/;", 
     RowBox[{"!", 
      RowBox[{"JavaObjectQ", "[", "o", "]"}]}]}], ",", 
    RowBox[{"depth", ":", 
     RowBox[{"_", "?", "Positive"}], ":", "\[Infinity]"}]}], "]"}], ":=", 
  "o"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.620685973953511*^9, 3.62068599009939*^9}, {
  3.621071296578188*^9, 3.6210713076520987`*^9}, {3.62107152227485*^9, 
  3.621071523432488*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"FromScalaObject", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"o_", "?", "JavaObjectQ"}], "/;", 
     RowBox[{"InstanceOf", "[", 
      RowBox[{"o", ",", "\"\<scala.collection.Traversable\>\""}], "]"}]}], 
    ",", 
    RowBox[{"depth", ":", 
     RowBox[{"_", "?", "Positive"}], ":", "\[Infinity]"}]}], "]"}], ":=", 
  RowBox[{"FromScalaObject", "[", 
   RowBox[{
    RowBox[{"JavaConversions`seqAsJavaList", "[", 
     RowBox[{"o", "@", 
      RowBox[{"toList", "[", "]"}]}], "]"}], ",", "depth"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FromScalaObject", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"o_", "?", "JavaObjectQ"}], "/;", 
     RowBox[{"InstanceOf", "[", 
      RowBox[{"o", ",", "\"\<java.util.List\>\""}], "]"}]}], ",", 
    RowBox[{"depth", ":", 
     RowBox[{"_", "?", "Positive"}], ":", "\[Infinity]"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"FromScalaObject", "[", 
     RowBox[{"#", ",", 
      RowBox[{"depth", "-", "1"}]}], "]"}], "&"}], "/@", 
   RowBox[{"(", 
    RowBox[{"o", "@", 
     RowBox[{"toArray", "[", "]"}]}], ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FromScalaObject", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"o_", "?", "JavaObjectQ"}], "/;", 
     RowBox[{"InstanceOf", "[", 
      RowBox[{"o", ",", "\"\<scala.Tuple2\>\""}], "]"}]}], ",", 
    RowBox[{"depth", ":", 
     RowBox[{"_", "?", "Positive"}], ":", "\[Infinity]"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"FromScalaObject", "[", 
     RowBox[{"#", ",", 
      RowBox[{"depth", "-", "1"}]}], "]"}], "&"}], "/@", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"o", "@", 
      RowBox[{"U1", "[", "]"}]}], ",", 
     RowBox[{"o", "@", 
      RowBox[{"U2", "[", "]"}]}]}], "}"}]}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.620685905677429*^9, 3.620685971489717*^9}, {
  3.620686018063477*^9, 3.620686018358594*^9}, {3.620686051026619*^9, 
  3.620686085436668*^9}, {3.6210713163013563`*^9, 3.6210713280749826`*^9}, {
  3.621071407598166*^9, 3.621071440205065*^9}, {3.62107148187836*^9, 
  3.62107148459435*^9}, {3.621071530358083*^9, 3.621071532320162*^9}, {
  3.62107158933505*^9, 3.621071593123454*^9}, {3.643599627599841*^9, 
  3.643599653941758*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"FromScalaObject", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"o_", "?", "JavaObjectQ"}], "/;", 
     RowBox[{"InstanceOf", "[", 
      RowBox[{"o", ",", "\"\<net.tqft.toolkit.algebra.Fraction\>\""}], 
      "]"}]}], ",", 
    RowBox[{"depth", ":", 
     RowBox[{"_", "?", "Positive"}], ":", "\[Infinity]"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"FromScalaObject", "[", 
    RowBox[{
     RowBox[{"o", "@", 
      RowBox[{"numerator", "[", "]"}]}], ",", 
     RowBox[{"depth", "-", "1"}]}], "]"}], "/", 
   RowBox[{"FromScalaObject", "[", 
    RowBox[{
     RowBox[{"o", "@", 
      RowBox[{"denominator", "[", "]"}]}], ",", 
     RowBox[{"depth", "-", "1"}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.620686099032484*^9, 3.620686143802018*^9}, {
   3.621071330747308*^9, 3.621071343592873*^9}, 3.6210714430352383`*^9, {
   3.6210714870670033`*^9, 3.621071487421856*^9}, 3.621071538806362*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"latch", "[", "f_", "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"latch", "[", "f", "]"}], "=", "False"}], ";", "True"}], 
   ")"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.645944753226823*^9, 3.6459447944584084`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"FromScalaObject", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"o_", "?", "JavaObjectQ"}], "/;", 
     RowBox[{"InstanceOf", "[", 
      RowBox[{
      "o", ",", 
       "\"\<net.tqft.toolkit.algebra.polynomials.RationalExpression\>\""}], 
      "]"}]}], ",", 
    RowBox[{"depth", ":", 
     RowBox[{"_", "?", "Positive"}], ":", "\[Infinity]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "result", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"result", "=", 
      RowBox[{
       RowBox[{"ToExpression", "[", 
        RowBox[{"rationalExpressionMathematicaForm", "@", 
         RowBox[{"toMathematicaInputString", "[", "o", "]"}]}], "]"}], "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"q_Symbol", "/;", 
           RowBox[{"StringMatchQ", "[", 
            RowBox[{
             RowBox[{"SymbolName", "[", "q", "]"}], ",", 
             RowBox[{"\"\<p\>\"", "~~", 
              RowBox[{"DigitCharacter", ".."}]}]}], "]"}]}], "\[RuleDelayed]", 
          SubscriptBox["p", 
           RowBox[{"ToExpression", "[", 
            RowBox[{"StringDrop", "[", 
             RowBox[{
              RowBox[{"SymbolName", "[", "q", "]"}], ",", "1"}], "]"}], 
            "]"}]]}], ",", 
         RowBox[{
          RowBox[{"t0_Symbol", "/;", 
           RowBox[{"StringMatchQ", "[", 
            RowBox[{
             RowBox[{"SymbolName", "[", "t0", "]"}], ",", 
             RowBox[{"\"\<t\>\"", "~~", 
              RowBox[{"DigitCharacter", ".."}]}]}], "]"}]}], "\[RuleDelayed]", 
          RowBox[{"tt", "[", 
           RowBox[{"ToExpression", "[", 
            RowBox[{"StringDrop", "[", 
             RowBox[{
              RowBox[{"SymbolName", "[", "t0", "]"}], ",", "1"}], "]"}], 
            "]"}], "]"}]}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"latch", "[", 
          RowBox[{"o", "@", 
           RowBox[{"toString", "[", "]"}]}], "]"}], ",", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<interpreting \>\"", ",", 
           RowBox[{"o", "@", 
            RowBox[{"toString", "[", "]"}]}], ",", " ", 
           "\"\< with mathematica form \>\"", ",", 
           RowBox[{"rationalExpressionMathematicaForm", "@", 
            RowBox[{"toMathematicaInputString", "[", "o", "]"}]}], ",", " ", 
           "\"\< as \>\"", ",", "result"}], "]"}]}], "]"}], ";"}], "*)"}], 
     "\[IndentingNewLine]", "result"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6206861496678267`*^9, 3.620686158667761*^9}, 
   3.620686215481686*^9, {3.620686535145565*^9, 3.620686553200324*^9}, {
   3.620686594021265*^9, 3.6206865964043913`*^9}, {3.621071334167357*^9, 
   3.621071334459256*^9}, 3.621071448046927*^9, {3.621071490004142*^9, 
   3.621071490365494*^9}, 3.6210715412296553`*^9, {3.621212792813389*^9, 
   3.621212945787644*^9}, {3.639788259228426*^9, 3.6397882911945963`*^9}, {
   3.6399498219204187`*^9, 3.639949833779598*^9}, {3.641027071298697*^9, 
   3.641027109906953*^9}, {3.641157482162086*^9, 3.641157497932026*^9}, {
   3.641157551938105*^9, 3.641157558659319*^9}, {3.641159200652711*^9, 
   3.641159200958167*^9}, {3.6442521176063766`*^9, 3.644252119830805*^9}, 
   3.644252186099807*^9, {3.645944577271282*^9, 3.645944629085816*^9}, {
   3.6459447794257927`*^9, 3.645944790004154*^9}, 3.6459545580037823`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"FromScalaObject", "[", 
   RowBox[{
    RowBox[{"o_", "?", "JavaObjectQ"}], ",", 
    RowBox[{"depth", ":", 
     RowBox[{"_", "?", "Positive"}], ":", "\[Infinity]"}]}], "]"}], ":=", 
  RowBox[{"o", "@", 
   RowBox[{"toString", "[", "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621070650555408*^9, 3.6210706549814587`*^9}, {
   3.621071376162065*^9, 3.621071376330752*^9}, 3.62107145214402*^9, {
   3.621071493912489*^9, 3.621071494338603*^9}, 3.621071543160831*^9}],

Cell[BoxData[
 RowBox[{"ScalaSingleton", "[", 
  "\"\<net.tqft.toolkit.algebra.mathematica.MathematicaForm\>\"", 
  "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{"ScalaSingleton", "[", 
  "\"\<net.tqft.toolkit.algebra.BigIntegers\>\"", "]"}]], "Input",
 InitializationCell->True],

Cell[BoxData[{
 RowBox[{
  RowBox[{"bigIntMathematicaForm", "=", 
   RowBox[{
   "ScalaSingleton", "[", 
    "\"\<net.tqft.toolkit.algebra.mathematica.MathematicaForm$\
BigIntMathematicaForm\>\"", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bareStringMathematicaForm", "=", 
   RowBox[{
   "ScalaSingleton", "[", 
    "\"\<net.tqft.toolkit.algebra.mathematica.MathematicaForm$\
BareStringMathematicaForm\>\"", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.620686307242064*^9, 3.62068634724087*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"bigRationalMathematicaForm", "=", 
   RowBox[{
    RowBox[{
    "ScalaSingleton", "[", 
     "\"\<net.tqft.toolkit.algebra.mathematica.MathematicaForm\>\"", "]"}], 
    "@", 
    RowBox[{"fractionMathematicaForm", "[", 
     RowBox[{"bigIntMathematicaForm", ",", 
      RowBox[{
      "ScalaSingleton", "[", "\"\<net.tqft.toolkit.algebra.BigIntegers\>\"", 
       "]"}]}], "]"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6206863593348207`*^9, 3.620686373113858*^9}, {
  3.620686464160671*^9, 3.620686479529668*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rationalExpressionMathematicaForm", "=", 
   RowBox[{
    RowBox[{
    "ScalaSingleton", "[", 
     "\"\<net.tqft.toolkit.algebra.mathematica.MathematicaForm\>\"", "]"}], 
    "@", 
    RowBox[{"rationalExpressionMathematicaForm2", "[", 
     RowBox[{"bigRationalMathematicaForm", ",", "bareStringMathematicaForm"}],
      "]"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.620686482491015*^9, 3.620686522030469*^9}, {
  3.644252154773637*^9, 3.6442521733666353`*^9}}],

Cell[BoxData[
 RowBox[{"Clear", "[", "AsScalaObject", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.620617808659605*^9, 3.6206178129491177`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"AsScalaList", "[", 
   RowBox[{"list", ":", 
    RowBox[{"{", "__Integer", "}"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"scala`collection`JavaConversions`asScalaBuffer", "[", 
    RowBox[{"java`util`Arrays`asList", "[", 
     RowBox[{"MakeJavaObject", "/@", "list"}], "]"}], "]"}], "@", 
   RowBox[{"toList", "[", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AsScalaList", "[", 
   RowBox[{"list", ":", 
    RowBox[{"{", "__Real", "}"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"scala`collection`JavaConversions`asScalaBuffer", "[", 
    RowBox[{"java`util`Arrays`asList", "[", 
     RowBox[{"MakeJavaObject", "/@", "list"}], "]"}], "]"}], "@", 
   RowBox[{"toList", "[", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AsScalaList", "[", 
   RowBox[{"list", ":", 
    RowBox[{"{", "__List", "}"}]}], "]"}], ":=", 
  RowBox[{"AsScalaList", "[", 
   RowBox[{"AsScalaList", "/@", "list"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AsScalaList", "[", "list_List", "]"}], ":=", 
  RowBox[{"Fold", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"#1", "@", 
      RowBox[{"$colon$colon", "[", "#2", "]"}]}], "&"}], ",", 
    RowBox[{
    "ScalaSingleton", "[", "\"\<scala.collection.immutable.Nil\>\"", "]"}], 
    ",", 
    RowBox[{"Reverse", "[", "list", "]"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AsScalaList", "[", 
   RowBox[{"{", "}"}], "]"}], ":=", 
  RowBox[{"scala`collection`immutable`List$`MODULE$", "@", 
   RowBox[{"empty", "[", "]"}]}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.567720614334144*^9, 3.567720621410693*^9}, {
  3.567720654523664*^9, 3.567720676011091*^9}, {3.567720731822373*^9, 
  3.5677207326500893`*^9}, {3.5677247654667683`*^9, 3.567724771552896*^9}, {
  3.5677269994289722`*^9, 3.567727075733775*^9}, {3.567804777400037*^9, 
  3.5678048076200457`*^9}, {3.622232210703191*^9, 3.622232276044817*^9}, {
  3.622232369014154*^9, 3.62223236933265*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"AsScalaObject", "[", "x_", "]"}], ":=", 
  RowBox[{"AsScalaObject", "[", 
   RowBox[{"x", ",", "\"\<Object\>\""}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6206177943869257`*^9, 3.620617806425729*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"AsScalaObject", "[", 
   RowBox[{"i_Integer", ",", "\"\<Object\>\""}], "]"}], ":=", 
  RowBox[{"MakeJavaObject", "[", "i", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AsScalaObject", "[", 
   RowBox[{"i_Integer", ",", "\"\<int\>\""}], "]"}], ":=", 
  "i"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AsScalaObject", "[", 
   RowBox[{"i_Integer", ",", "\"\<java.math.BigInteger\>\""}], "]"}], ":=", 
  RowBox[{"JavaNew", "[", 
   RowBox[{"\"\<java.math.BigInteger\>\"", ",", 
    RowBox[{"ToString", "[", "i", "]"}]}], "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.620616137795076*^9, 3.620616171698071*^9}, {
  3.620617760222375*^9, 3.6206177928254547`*^9}, {3.641163892990485*^9, 
  3.641163915792355*^9}, {3.64116397347353*^9, 3.641163976075478*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"AsScalaObject", "[", 
   RowBox[{
    RowBox[{"o_", "?", "JavaObjectQ"}], ",", "_"}], "]"}], ":=", 
  "o"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.620617184745891*^9, 3.6206171924730053`*^9}, {
  3.620617771063404*^9, 3.620617771503463*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"AsScalaObject", "[", 
   RowBox[{
    RowBox[{"rules", ":", 
     RowBox[{"{", "__Rule", "}"}]}], ",", 
    RowBox[{
    "\"\<Object\>\"", "|", "\"\<scala.collection.immutable.Map\>\""}]}], 
   "]"}], ":=", 
  RowBox[{"AsScalaMap", "[", "rules", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AsScalaObject", "[", 
   RowBox[{
    RowBox[{"rules", ":", 
     RowBox[{"{", "___Rule", "}"}]}], ",", 
    "\"\<scala.collection.immutable.Map\>\""}], "]"}], ":=", 
  RowBox[{"AsScalaMap", "[", "rules", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AsScalaMap", "[", 
   RowBox[{"rules", ":", 
    RowBox[{"{", "___Rule", "}"}]}], "]"}], ":=", 
  RowBox[{
   RowBox[{"ScalaCaseClass", "[", 
    RowBox[{"\"\<scala.collection.immutable.Map\>\"", ",", 
     RowBox[{"AsScalaList", "[", 
      RowBox[{"{", "}"}], "]"}]}], "]"}], "@", 
   RowBox[{"$plus$plus", "[", 
    RowBox[{"AsScalaList", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"ScalaCaseClass", "[", 
        RowBox[{"\"\<scala.Tuple2\>\"", ",", 
         RowBox[{"Sequence", "@@", "#"}]}], "]"}], "&"}], "/@", "rules"}], 
     "]"}], "]"}]}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.62061696816663*^9, 3.620617029772686*^9}, {
   3.620617062733923*^9, 3.620617064885275*^9}, {3.620617095409789*^9, 
   3.6206170967028437`*^9}, 3.620617130508194*^9, {3.620617266650272*^9, 
   3.620617268825653*^9}, {3.6206177802090197`*^9, 3.620617783193287*^9}, {
   3.6397012108943043`*^9, 3.639701211125737*^9}, {3.641351873929637*^9, 
   3.6413519137339363`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Fraction", "=", 
   RowBox[{
   "ScalaSingleton", "[", "\"\<net.tqft.toolkit.algebra.Fraction\>\"", 
    "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.622189671692155*^9, 3.6221896935508823`*^9}, 
   3.622189771460307*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Ring", "=", 
   RowBox[{
    RowBox[{
    "ScalaSingleton", "[", 
     "\"\<net.tqft.toolkit.algebra.spiders.examples.QuantumExceptionalSeries\>\
\"", "]"}], "@", 
    RowBox[{"ring", "[", "]"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6409984824459047`*^9, 3.640998486491748*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"BigIntegers", "=", 
   RowBox[{
   "ScalaSingleton", "[", "\"\<net.tqft.toolkit.algebra.BigIntegers\>\"", 
    "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6442523785766087`*^9, 3.644252396697558*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"AsScalaObject", "[", 
   RowBox[{"x_Plus", ",", "\"\<MultivariableRationalFunction\>\""}], "]"}], ":=", 
  RowBox[{"Ring", "@", 
   RowBox[{"sum", "[", 
    RowBox[{"AsScalaList", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"AsScalaObject", "[", 
        RowBox[{"#", ",", "\"\<MultivariableRationalFunction\>\""}], "]"}], 
       "&"}], "/@", 
      RowBox[{"(", 
       RowBox[{"List", "@@", "x"}], ")"}]}], "]"}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AsScalaObject", "[", 
   RowBox[{"x_Times", ",", "\"\<MultivariableRationalFunction\>\""}], "]"}], ":=", 
  RowBox[{"Ring", "@", 
   RowBox[{"product", "[", 
    RowBox[{"AsScalaList", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"AsScalaObject", "[", 
        RowBox[{"#", ",", "\"\<MultivariableRationalFunction\>\""}], "]"}], 
       "&"}], "/@", 
      RowBox[{"(", 
       RowBox[{"List", "@@", "x"}], ")"}]}], "]"}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AsScalaObject", "[", 
   RowBox[{
    RowBox[{"Power", "[", 
     RowBox[{"x_", ",", "k_Integer"}], "]"}], ",", 
    "\"\<MultivariableRationalFunction\>\""}], "]"}], ":=", 
  RowBox[{"Ring", "@", 
   RowBox[{"power", "[", 
    RowBox[{
     RowBox[{"AsScalaObject", "[", 
      RowBox[{"x", ",", "\"\<MultivariableRationalFunction\>\""}], "]"}], ",",
      "k"}], "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AsScalaObject", "[", 
   RowBox[{"x_Integer", ",", "\"\<MultivariableRationalFunction\>\""}], "]"}],
   ":=", 
  RowBox[{"Ring", "@", 
   RowBox[{"fromBigInteger", "[", 
    RowBox[{"AsScalaObject", "[", 
     RowBox[{"x", ",", "\"\<java.math.BigInteger\>\""}], "]"}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AsScalaObject", "[", 
   RowBox[{"x_Rational", ",", "\"\<MultivariableRationalFunction\>\""}], 
   "]"}], ":=", 
  RowBox[{"Ring", "@", 
   RowBox[{"quotient", "[", 
    RowBox[{
     RowBox[{"AsScalaObject", "[", 
      RowBox[{
       RowBox[{"Numerator", "[", "x", "]"}], ",", 
       "\"\<MultivariableRationalFunction\>\""}], "]"}], ",", 
     RowBox[{"AsScalaObject", "[", 
      RowBox[{
       RowBox[{"Denominator", "[", "x", "]"}], ",", 
       "\"\<MultivariableRationalFunction\>\""}], "]"}]}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AsScalaObject", "[", 
   RowBox[{
    SubscriptBox["p", "k_Integer"], ",", 
    "\"\<MultivariableRationalFunction\>\""}], "]"}], ":=", 
  RowBox[{"AsScalaObject", "[", 
   RowBox[{
    RowBox[{"\"\<p\>\"", "<>", 
     RowBox[{"ToString", "[", "k", "]"}]}], ",", 
    "\"\<MultivariableRationalFunction\>\""}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AsScalaObject", "[", 
   RowBox[{
    RowBox[{"tt", "[", "k_Integer", "]"}], ",", 
    "\"\<MultivariableRationalFunction\>\""}], "]"}], ":=", 
  RowBox[{"AsScalaObject", "[", 
   RowBox[{
    RowBox[{"\"\<t\>\"", "<>", 
     RowBox[{"ToString", "[", "k", "]"}]}], ",", 
    "\"\<MultivariableRationalFunction\>\""}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"AsScalaObject", "[", 
   RowBox[{"x_", ",", "\"\<MultivariableRationalFunction\>\""}], "]"}], ":=", 
  
  RowBox[{
   RowBox[{"AsScalaObject", "[", 
    RowBox[{"x", ",", "\"\<MultivariableRationalFunction\>\""}], "]"}], "=", 
   "\[IndentingNewLine]", 
   RowBox[{"ScalaCaseClass", "[", 
    RowBox[{
    "\"\<net.tqft.toolkit.algebra.polynomials.RationalExpression$variable\>\"\
", ",", 
     RowBox[{"MakeJavaObject", "[", 
      RowBox[{"ToString", "[", "x", "]"}], "]"}]}], "\[IndentingNewLine]", 
    "]"}]}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.622188762687854*^9, 3.622188795384698*^9}, {
   3.6221888489999123`*^9, 3.622189006628018*^9}, {3.622189232407415*^9, 
   3.622189233377647*^9}, {3.622189312931966*^9, 3.622189341378357*^9}, {
   3.622189372592013*^9, 3.622189397515503*^9}, {3.622189486946396*^9, 
   3.622189492574689*^9}, {3.622189562653119*^9, 3.62218958961937*^9}, {
   3.622189696640812*^9, 3.622189759715749*^9}, {3.6221900765629587`*^9, 
   3.6221900801376333`*^9}, {3.6221905840693808`*^9, 3.622190607516776*^9}, {
   3.6222317371583138`*^9, 3.622231763047621*^9}, {3.639788229347769*^9, 
   3.6397882423733883`*^9}, {3.640998491668171*^9, 3.640998519042638*^9}, 
   3.641027130870366*^9, {3.6411577127336693`*^9, 3.6411577156113977`*^9}, {
   3.641158838948984*^9, 3.6411588612470493`*^9}, {3.641158923083767*^9, 
   3.6411589550414677`*^9}, {3.641159095513474*^9, 3.64115910341044*^9}, {
   3.6411630957953167`*^9, 3.641163100833849*^9}, {3.641163162592236*^9, 
   3.64116316617551*^9}, {3.641163765875554*^9, 3.641163766233603*^9}, {
   3.641163796634838*^9, 3.641163812168847*^9}, {3.6411639931670218`*^9, 
   3.641163997661765*^9}, {3.6411642859065332`*^9, 3.64116429042577*^9}, {
   3.644251928323897*^9, 3.64425198534439*^9}, {3.644252344198204*^9, 
   3.64425240462829*^9}, {3.644252465654388*^9, 3.644252479623293*^9}, {
   3.6442525138463*^9, 3.6442525596127253`*^9}, {3.64425469845933*^9, 
   3.644254703080079*^9}}],

Cell[CellGroupData[{

Cell["Building and naming planar graphs", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{{3.642061956224696*^9, 3.6420619673535833`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Diagram", "=", 
   RowBox[{"_", "?", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"JavaObjectQ", "[", "#", "]"}], "\[And]", 
       RowBox[{"InstanceOf", "[", 
        RowBox[{
        "#", ",", "\"\<net.tqft.toolkit.algebra.spiders.PlanarGraph\>\""}], 
        "]"}]}], "&"}], ")"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621210559679555*^9, 3.621210570964134*^9}, {
  3.6212106106958523`*^9, 3.621210635825304*^9}, {3.621210997844269*^9, 
  3.621210998915182*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"NamedPolyhedron", "[", 
   SubscriptBox["p", "k_"], "]"}], ":=", 
  RowBox[{
   RowBox[{
   "ScalaSingleton", "[", 
    "\"\<net.tqft.toolkit.algebra.spiders.PolyhedronNamer\>\"", "]"}], "@", 
   RowBox[{
    RowBox[{"byName", "[", 
     RowBox[{"\"\<p\>\"", "<>", 
      RowBox[{"ToString", "[", "k", "]"}]}], "]"}], "@", 
    RowBox[{"get", "[", "]"}]}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.622426264200357*^9, 3.622426286312983*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PlanarGraphs", "=", 
   RowBox[{
   "ScalaSingleton", "[", 
    "\"\<net.tqft.toolkit.algebra.spiders.PlanarGraph\>\"", "]"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641353990416082*^9, 3.641353993920079*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"polygon", "[", "n_Integer", "]"}], ":=", 
  RowBox[{
   RowBox[{"polygon", "[", "n", "]"}], "=", 
   RowBox[{"PlanarGraphs", "@", 
    RowBox[{
     RowBox[{"polygon", "[", "]"}], "@", 
     RowBox[{"apply", "[", 
      RowBox[{"AsScalaObject", "[", 
       RowBox[{"n", ",", "\"\<Object\>\""}], "]"}], "]"}]}]}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641161200569439*^9, 3.64116122376475*^9}, 
   3.641353997946494*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Name", "[", 
   RowBox[{"d0", ":", "Diagram"}], "]"}], ":=", 
  RowBox[{"FromScalaObject", "[", 
   RowBox[{
    RowBox[{
    "ScalaSingleton", "[", 
     "\"\<net.tqft.toolkit.algebra.spiders.examples.BraidedTrivalentSpider\>\"\
", "]"}], "@", 
    RowBox[{"evaluate", "[", 
     RowBox[{"AsScalaObject", "[", 
      RowBox[{"{", 
       RowBox[{"d0", "\[Rule]", 
        RowBox[{"Ring", "@", 
         RowBox[{"one", "[", "]"}]}]}], "}"}], "]"}], "]"}]}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641354024759295*^9, 3.641354054336452*^9}, {
  3.6434661324437313`*^9, 3.643466135201641*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Drawing planar graphs", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{{3.643353372330868*^9, 3.6433533765660152`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"DrawPlanarGraph$", "=", 
   RowBox[{
    RowBox[{
    "ScalaSingleton", "[", 
     "\"\<net.tqft.toolkit.algebra.spiders.DrawPlanarGraph\>\"", "]"}], "@", 
    RowBox[{"withOutputPath", "[", 
     RowBox[{"FileNameJoin", "[", 
      RowBox[{"{", 
       RowBox[{"SpidersMathematicaDirectory", ",", "\"\<graphs\>\""}], "}"}], 
      "]"}], "]"}]}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643353169701387*^9, 3.6433532120219812`*^9}, {
   3.643365517643046*^9, 3.643365538195389*^9}, 3.643606169099206*^9, {
   3.644130508370414*^9, 3.6441305086752872`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DrawPlanarGraph", "[", "g_", "]"}], "/;", 
   RowBox[{"InstanceOf", "[", 
    RowBox[{
    "g", ",", "\"\<net.tqft.toolkit.algebra.spiders.PlanarGraph\>\""}], 
    "]"}]}], ":=", 
  RowBox[{
   RowBox[{"Import", "[", 
    RowBox[{"DrawPlanarGraph$", "@", 
     RowBox[{
      RowBox[{"createPDF", "[", "g", "]"}], "@", 
      RowBox[{"toString", "[", "]"}]}]}], "]"}], "/.", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"$Failed", "\[Rule]", 
      RowBox[{"g", "@", 
       RowBox[{"toString", "[", "]"}]}]}], ",", 
     RowBox[{
      RowBox[{"{", "picture_", "}"}], "\[RuleDelayed]", "picture"}]}], 
    "}"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DrawPlanarGraph", "[", "X_List", "]"}], ":=", 
  RowBox[{"DrawPlanarGraph", "/@", "X"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643353122550913*^9, 3.6433531680081177`*^9}, {
  3.6433532180404167`*^9, 3.6433532220877037`*^9}, {3.6434319968663197`*^9, 
  3.643431997199682*^9}, {3.646206052034531*^9, 3.64620610682588*^9}, {
  3.667360520885727*^9, 3.667360521151589*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"DrawPlanarGraph", "[", "S_String", "]"}], ":=", 
  RowBox[{"DrawPlanarGraph", "[", 
   RowBox[{"PlanarGraphs", "@", 
    RowBox[{"fromString", "[", "S", "]"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.645844428335821*^9, 3.645844440582955*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"DrawPlanarGraph", "[", 
   SubscriptBox["p", "k_Integer"], "]"}], ":=", 
  RowBox[{"DrawPlanarGraph", "[", 
   RowBox[{"NamedPolyhedron", "[", 
    SubscriptBox["p", "k"], "]"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6436295230029507`*^9, 3.643629541454623*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DrawReducingRelations", "[", "n_Integer", "]"}], "[", 
   "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"ReducingRelations", "[", "n", "]"}], "[", "s", "]"}], 
      "\[LeftDoubleBracket]", 
      RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], ")"}], "/.", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"c_", ",", 
       RowBox[{"d", ":", "Diagram"}]}], "}"}], "\[RuleDelayed]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"ReducePolynomialsFurther", "[", "s", "]"}], "[", "c", "]"}], 
       ",", 
       RowBox[{"DrawPlanarGraph", "[", "d", "]"}]}], "}"}]}]}], "//", 
   "TableForm"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.666986663800384*^9, 3.666986720613206*^9}, {
  3.666987913469914*^9, 3.6669879177900743`*^9}, {3.667157482496264*^9, 
  3.6671574859571743`*^9}, {3.667157535392466*^9, 3.667157536767455*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DrawRelations", "[", "n_Integer", "]"}], "[", "s_SpiderAnalysis", 
   "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"ReducingRelations", "[", "n", "]"}], "[", "s", "]"}], 
       "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], "~", "Join", "~", 
      RowBox[{
       RowBox[{"NonReducingRelations", "[", "n", "]"}], "[", "s", "]"}]}], 
     ")"}], "/.", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"c_", ",", 
       RowBox[{"d", ":", "Diagram"}]}], "}"}], "\[RuleDelayed]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"ReducePolynomialsFurther", "[", "s", "]"}], "[", "c", "]"}], 
       ",", 
       RowBox[{"DrawPlanarGraph", "[", "d", "]"}]}], "}"}]}]}], "//", 
   "TableForm"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.666986663800384*^9, 3.666986720613206*^9}, {
  3.667157488149776*^9, 3.667157492960371*^9}, {3.667157539376541*^9, 
  3.667157540559761*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Set operations on diagrams", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{{3.642061803496758*^9, 3.642061813160201*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"unionDiagrams", "[", "diagrams_", "]"}], ":=", 
  RowBox[{
   RowBox[{"Union", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"#", "@", 
          RowBox[{"toString", "[", "]"}]}], ",", "#"}], "}"}], "&"}], "/@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "@", 
          RowBox[{
           RowBox[{"canonicalFormWithDefect", "[", "]"}], "@", 
           RowBox[{"U1", "[", "]"}]}]}], "&"}], "/@", "diagrams"}], ")"}]}], 
     ",", 
     RowBox[{"SameTest", "\[Rule]", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"First", "[", "#1", "]"}], "===", 
         RowBox[{"First", "[", "#2", "]"}]}], "&"}], ")"}]}]}], "]"}], 
   "\[LeftDoubleBracket]", 
   RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6412663411528187`*^9, 3.6412664162935047`*^9}, {
  3.6414417089451447`*^9, 3.6414417134939404`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"complementDiagrams", "[", 
   RowBox[{"diagrams1_", ",", "diagrams2_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"PlanarGraphs", "@", 
     RowBox[{"fromString", "[", "#", "]"}]}], "&"}], "/@", 
   RowBox[{"DeleteCases", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"#", "@", 
        RowBox[{
         RowBox[{"canonicalFormWithDefect", "[", "]"}], "@", 
         RowBox[{
          RowBox[{"U1", "[", "]"}], "@", 
          RowBox[{"toString", "[", "]"}]}]}]}], "&"}], "/@", "diagrams1"}], 
     ",", 
     RowBox[{"Alternatives", "@@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "@", 
          RowBox[{
           RowBox[{"canonicalFormWithDefect", "[", "]"}], "@", 
           RowBox[{
            RowBox[{"U1", "[", "]"}], "@", 
            RowBox[{"toString", "[", "]"}]}]}]}], "&"}], "/@", "diagrams2"}], 
       ")"}]}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641441729452479*^9, 3.641441765743965*^9}, {
  3.645954039677397*^9, 3.645954148423325*^9}, {3.645954228540782*^9, 
  3.645954274240799*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"memberQDiagrams", "[", 
   RowBox[{"diagrams_", ",", "diagram_"}], "]"}], ":=", 
  RowBox[{"MemberQ", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"#", "@", 
       RowBox[{
        RowBox[{"canonicalFormWithDefect", "[", "]"}], "@", 
        RowBox[{
         RowBox[{"U1", "[", "]"}], "@", 
         RowBox[{"toString", "[", "]"}]}]}]}], "&"}], "/@", "diagrams"}], ",", 
    RowBox[{"diagram", "@", 
     RowBox[{
      RowBox[{"canonicalFormWithDefect", "[", "]"}], "@", 
      RowBox[{
       RowBox[{"U1", "[", "]"}], "@", 
       RowBox[{"toString", "[", "]"}]}]}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641461362863668*^9, 3.6414613958005667`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Caching calculations", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{{3.642061862662367*^9, 3.6420618707553463`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"cachedGroebnerBasis", "[", 
   RowBox[{"ideal_", ",", "variables_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"cachedGroebnerBasis", "[", 
    RowBox[{"ideal", ",", "variables"}], "]"}], "=", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "result", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Print", "[", "\"\<beginning GroebnerBasis calculation...\>\"", "]"}], 
       ";"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"result", "=", 
       RowBox[{"GroebnerBasis", "[", 
        RowBox[{"ideal", ",", "variables"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Print", "[", "\"\<finishing GroebnerBasis calculation...\>\"", "]"}],
         ";"}], "*)"}], "\[IndentingNewLine]", "result"}]}], 
    "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cachedPolynomialReduce", "[", 
   RowBox[{"polynomial_", ",", "basis_", ",", "variables_"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"cachedPolynomialReduce", "[", 
    RowBox[{"polynomial", ",", "basis", ",", "variables"}], "]"}], "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "result", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Print", "[", "\"\<beginning PolynomialReduce calculation...\>\"", 
        "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"result", "=", 
       RowBox[{"PolynomialReduce", "[", 
        RowBox[{"polynomial", ",", "basis", ",", "variables"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Print", "[", "\"\<finishing PolynomialReduce calculation...\>\"", 
         "]"}], ";"}], "*)"}], "\[IndentingNewLine]", "result"}]}], 
    "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cachedRationalFunctionReduce", "[", 
   RowBox[{"function_", ",", "basis_", ",", "variables_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"t", "=", 
      RowBox[{"Together", "[", "function", "]"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"cachedPolynomialReduce", "[", 
       RowBox[{
        RowBox[{"Numerator", "[", "t", "]"}], ",", "basis", ",", 
        "variables"}], "]"}], "\[LeftDoubleBracket]", "2", 
      "\[RightDoubleBracket]"}], "/", 
     RowBox[{
      RowBox[{"cachedPolynomialReduce", "[", 
       RowBox[{
        RowBox[{"Denominator", "[", "t", "]"}], ",", "basis", ",", 
        "variables"}], "]"}], "\[LeftDoubleBracket]", "2", 
      "\[RightDoubleBracket]"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.6397923067837267`*^9, 3.63979239928529*^9}, {
  3.639866856165765*^9, 3.639866914639234*^9}, {3.641198638639989*^9, 
  3.641198653728924*^9}, {3.641243715892174*^9, 3.6412437249284897`*^9}, {
  3.643535054806356*^9, 3.643535137650576*^9}, {3.643535369467766*^9, 
  3.643535374305543*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SaveGroebnerCalculations", "[", "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"LoadGroebnerCalculations", "[", "]"}], ";", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"DownValues", "[", "cachedGroebnerBasis", "]"}], "=", 
     RowBox[{"Cases", "[", 
      RowBox[{
       RowBox[{"DownValues", "[", "cachedGroebnerBasis", "]"}], ",", 
       RowBox[{"r_", "/;", 
        RowBox[{"FreeQ", "[", 
         RowBox[{"r", ",", "_t"}], "]"}]}]}], "]"}]}], ";", 
    RowBox[{"Put", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"DownValues", "[", "cachedGroebnerBasis", "]"}], ",", 
        RowBox[{"DownValues", "[", "cachedPolynomialReduce", "]"}]}], "}"}], 
      ",", 
      RowBox[{"FileNameJoin", "[", 
       RowBox[{"{", 
        RowBox[{
        "SpidersMathematicaDirectory", ",", 
         "\"\<groebnerCalculations.m\>\""}], "}"}], "]"}]}], "]"}]}], 
   ")"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"LoadGroebnerCalculations", "[", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"file", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{
         "SpidersMathematicaDirectory", ",", 
          "\"\<groebnerCalculations.m\>\""}], "}"}], "]"}]}], ",", "data"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"FileExistsQ", "[", "file", "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"data", "=", 
        RowBox[{"Get", "[", "file", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"DownValues", "[", "cachedGroebnerBasis", "]"}], "=", 
        RowBox[{
         RowBox[{"DownValues", "[", "cachedGroebnerBasis", "]"}], "~", "Join",
          "~", 
         RowBox[{
         "data", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"DownValues", "[", "cachedPolynomialReduce", "]"}], "=", 
        RowBox[{
         RowBox[{"DownValues", "[", "cachedPolynomialReduce", "]"}], "~", 
         "Join", "~", 
         RowBox[{
         "data", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}]}], 
       ";"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.639792407173942*^9, 3.63979259847049*^9}, {
  3.639880981253808*^9, 3.639880982630843*^9}, {3.643606174202362*^9, 
  3.6436061757545757`*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"SaveGroebnerCalculations", "[", "]"}], "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.639792491945012*^9, 3.6397924965109262`*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"LoadGroebnerCalculations", "[", "]"}], "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.639792498871615*^9, 3.639792500701706*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Manipulating polynomials", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.639695197863172*^9, 3.6396952047707233`*^9}, {
  3.642060740437893*^9, 3.642060742000311*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"timesToList", "[", "X_Times", "]"}], ":=", 
  RowBox[{"List", "@@", "X"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"timesToList", "[", "X_", "]"}], ":=", 
  RowBox[{"{", "X", "}"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.620687830485553*^9, 3.620687840496121*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"withoutMultiplicity", "[", 
    SuperscriptBox["X_", "k_"], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"X", ",", "k"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"withoutMultiplicity", "[", "X_", "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{"X", ",", "1"}], "}"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6212224769249983`*^9, 3.621222482269302*^9}}],

Cell[BoxData[
 RowBox[{"Clear", "[", "text", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621067051644389*^9, 3.621067056226892*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"text", "[", "A___", "]"}], ":=", 
  RowBox[{"text", "[", 
   RowBox[{"StringJoin", "@@", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"Switch", "[", 
        RowBox[{"#", ",", "_String", ",", "#", ",", 
         RowBox[{"_", "?", "JavaObjectQ"}], ",", 
         RowBox[{"#", "@", 
          RowBox[{"toString", "[", "]"}]}], ",", "_", ",", 
         RowBox[{"\"\<\\(\>\"", "<>", 
          RowBox[{"ToString", "[", 
           RowBox[{"#", ",", "TeXForm"}], "]"}], "<>", "\"\<\\)\>\""}]}], 
        "]"}], "&"}], "/@", 
      RowBox[{"{", "A", "}"}]}], ")"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"text", "[", "S_String", "]"}], ":=", 
  RowBox[{"Print", "[", "S", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621038111625039*^9, 3.621038117609947*^9}, {
  3.6210667865970592`*^9, 3.621066816623557*^9}, {3.621066853271764*^9, 
  3.6210668907271214`*^9}, {3.6210670037502937`*^9, 3.621067005039667*^9}, {
  3.621067040951891*^9, 3.621067101007056*^9}, {3.6210701847663918`*^9, 
  3.621070202827035*^9}, {3.6212126730811577`*^9, 3.621212756897361*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"automaticFlatMap", "[", "f_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"f", "[", "a__", "]"}], "[", "Xs_List", "]"}], ":=", 
   RowBox[{"Union", "[", 
    RowBox[{"Flatten", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"f", "[", "a", "]"}], "/@", "Xs"}], ",", "1"}], "]"}], 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.620688164125411*^9, 3.6206881829282207`*^9}, 
   3.621222094490674*^9, {3.622184360145545*^9, 3.622184374088087*^9}, 
   3.6221846255217333`*^9, {3.6397733010736923`*^9, 3.639773303288205*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"automaticFlatMap", "/@", 
   RowBox[{"{", 
    RowBox[{
    "DeclarePolynomialEitherZeroOrNonZero", ",", "DeclarePolynomialsZero", 
     ",", "DeclarePolynomialZero", ",", "DeclareAtLeastOnePolynomialZero", 
     ",", "DeclareAtLeastOnePolynomialNonZero", ",", 
     "DeclarePolynomialNonZero", ",", "DeclarePolynomialsNonZero", ",", 
     "DeclareIrreduciblePolynomialNonZero"}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.620688203498723*^9, 3.620688228220294*^9}, {
   3.621037774354138*^9, 3.621037774538066*^9}, {3.621213181785121*^9, 
   3.621213182060973*^9}, {3.6219053543307333`*^9, 3.621905355321931*^9}, {
   3.621905775538089*^9, 3.6219057765212517`*^9}, {3.622184381956562*^9, 
   3.622184395355117*^9}, 3.641290231639022*^9, {3.6413690058365498`*^9, 
   3.64136900624524*^9}, {3.673089806644156*^9, 3.673089807833292*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"IntroduceNewVariable", "[", "v_", "]"}], "[", "X_", "]"}], ":=", 
  RowBox[{"X", "/.", 
   RowBox[{"{", 
    RowBox[{"m_Manifold", "\[RuleDelayed]", 
     RowBox[{"ReplacePart", "[", 
      RowBox[{"m", ",", 
       RowBox[{"5", "\[Rule]", 
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"m", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}],
           ",", "v"}], "]"}]}]}], "]"}]}], "}"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641438493747291*^9, 3.64143855898709*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DeclarePolynomialEitherZeroOrNonZero", "[", "polynomial_", "]"}], 
   "[", "m_Manifold", "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"DeclarePolynomialZero", "[", "polynomial", "]"}], "[", "m", 
       "]"}], ",", 
      RowBox[{
       RowBox[{"DeclarePolynomialNonZero", "[", "polynomial", "]"}], "[", "m",
        "]"}]}], "}"}], ",", "1"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641368837494574*^9, 3.641368881121245*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DeclarePolynomialsZero", "[", "polynomials_", "]"}], "[", 
   "m_Manifold", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"variables", ",", "sortedPolynomials"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"variables", "=", 
      RowBox[{
       RowBox[{"m", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}], 
       "~", "Join", "~", 
       RowBox[{"Union", "[", 
        RowBox[{"Cases", "[", 
         RowBox[{"polynomials", ",", 
          RowBox[{
           SubscriptBox["p", "_"], "|", 
           RowBox[{"tt", "[", "_", "]"}]}], ",", "\[Infinity]"}], "]"}], 
        "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"sortedPolynomials", "=", 
      RowBox[{"SortBy", "[", 
       RowBox[{"polynomials", ",", 
        RowBox[{"Function", "[", 
         RowBox[{"polynomial", ",", 
          RowBox[{"Min", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Exponent", "[", 
                RowBox[{"polynomial", ",", "#"}], "]"}], "&"}], "/@", 
              "variables"}], ")"}], "/.", 
            RowBox[{"{", 
             RowBox[{"0", "\[Rule]", "\[Infinity]"}], "}"}]}], "]"}]}], 
         "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"sortedPolynomials", "=", 
      RowBox[{"SortBy", "[", 
       RowBox[{"polynomials", ",", "ByteCount"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", "sortedPolynomials", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Fold", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"DeclarePolynomialZero", "[", "#2", "]"}], "[", "#1", "]"}], 
        "&"}], ",", 
       RowBox[{"{", "m", "}"}], ",", "sortedPolynomials"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621213144724956*^9, 3.621213172415187*^9}, {
  3.622184216006274*^9, 3.622184236615327*^9}, {3.6411667618233643`*^9, 
  3.641166849035301*^9}, {3.6413682402158613`*^9, 3.641368248851986*^9}, {
  3.6413682953707333`*^9, 3.641368349968392*^9}, {3.641368588487007*^9, 
  3.641368612130106*^9}, {3.641505519739024*^9, 3.641505521671625*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DeclareAtLeastOnePolynomialZero", "[", "p_List", "]"}], "[", 
   "m_Manifold", "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"DeclarePolynomialZero", "[", "#", "]"}], "[", "m", "]"}], 
      "&"}], "/@", "p"}], ",", "1"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621905302372225*^9, 3.621905341703635*^9}, {
   3.622184238739737*^9, 3.622184253330801*^9}, 3.641290204412778*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DeclareAtLeastOnePolynomialNonZero", "[", "p_List", "]"}], "[", 
   "m_Manifold", "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"DeclarePolynomialNonZero", "[", "#", "]"}], "[", "m", "]"}], 
      "&"}], "/@", 
     RowBox[{"Union", "[", "p", "]"}]}], ",", "1"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621905302372225*^9, 3.621905341703635*^9}, {
   3.622184238739737*^9, 3.622184253330801*^9}, 3.641290204412778*^9, {
   3.6730897759446573`*^9, 3.67308979899905*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DeclarePolynomialZero", "[", "0", "]"}], "[", "m_Manifold", "]"}],
   ":=", 
  RowBox[{"{", "m", "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DeclarePolynomialZero", "[", "p_", "]"}], "[", 
   RowBox[{"m", ":", 
    RowBox[{"Manifold", "[", 
     RowBox[{
     "substitutions_List", ",", "groebnerBasis_List", ",", 
      "otherIdentities_List", ",", "nonzeroPolynomials_List", ",", 
      "variables_List"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "factors", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"MemberQ", "[", 
       RowBox[{
        RowBox[{"nonzeroPolynomials", "~", "Join", "~", 
         RowBox[{"(", 
          RowBox[{"-", "nonzeroPolynomials"}], ")"}]}], ",", "p"}], "]"}], 
      ",", 
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"factors", "=", 
        RowBox[{"Complement", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ReducePolynomials", "[", "m", "]"}], "/@", 
           RowBox[{"Cases", "[", 
            RowBox[{
             RowBox[{"withoutMultiplicity", "/@", 
              RowBox[{"timesToList", "[", 
               RowBox[{"Factor", "[", 
                RowBox[{
                 RowBox[{"ReducePolynomials", "[", "m", "]"}], "[", "p", 
                 "]"}], "]"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"f_", ",", "k_"}], "}"}], "/;", 
               RowBox[{"k", ">", "0"}]}], "\[RuleDelayed]", "f"}]}], "]"}]}], 
          ",", 
          RowBox[{"nonzeroPolynomials", "~", "Join", "~", 
           RowBox[{"(", 
            RowBox[{"-", "nonzeroPolynomials"}], ")"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"factors", "===", 
          RowBox[{"{", "0", "}"}]}], ",", 
         RowBox[{"{", "m", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"factors", "=", 
           RowBox[{"DeleteCases", "[", 
            RowBox[{"factors", ",", 
             RowBox[{"_Integer", "|", "_Rational"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "factors", "]"}], "\[Equal]", "0"}], ",", 
            
            RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"Complement", "[", 
                 RowBox[{"factors", ",", 
                  RowBox[{"groebnerBasis", "~", "Join", "~", 
                   RowBox[{"(", 
                    RowBox[{"-", "groebnerBasis"}], ")"}]}]}], "]"}], "]"}], 
               "\[Equal]", "0"}], ",", 
              RowBox[{"{", "m", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Print", "[", 
                RowBox[{
                "\"\<We find the factors \>\"", " ", ",", "factors", ",", 
                 "\"\< and then require that at least one is zero. \>\""}], 
                "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    "DeclareIrreduciblePolynomialZero", "[", "#", "]"}], "[", 
                    "m", "]"}], "&"}], "/@", "factors"}], ",", "1"}], 
                "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
           "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}],
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.62068694287613*^9, 3.620686974838972*^9}, {
   3.620687311310376*^9, 3.620687319287264*^9}, {3.62068736563314*^9, 
   3.62068751170623*^9}, {3.620687591458665*^9, 3.6206878838875713`*^9}, {
   3.620688252258073*^9, 3.6206882962474117`*^9}, {3.620690462994953*^9, 
   3.620690471603466*^9}, 3.621037605612302*^9, {3.621038081031516*^9, 
   3.621038085110836*^9}, {3.6210672134802637`*^9, 3.621067230238785*^9}, {
   3.621067302279681*^9, 3.6210673705942097`*^9}, 3.621067406200392*^9, {
   3.62121870704679*^9, 3.621218709902493*^9}, {3.621222486815775*^9, 
   3.621222502888832*^9}, {3.621222918808002*^9, 3.6212229210158167`*^9}, {
   3.622184257799323*^9, 3.622184275579892*^9}, {3.6224234040538683`*^9, 
   3.6224234097009*^9}, {3.639773120135066*^9, 3.6397731237053833`*^9}, {
   3.641244167187468*^9, 3.6412442043394833`*^9}, {3.641244437471623*^9, 
   3.6412444398255157`*^9}, {3.641244494220333*^9, 3.641244496339011*^9}, {
   3.641244560300302*^9, 3.64124460859984*^9}, {3.641244767411227*^9, 
   3.641244792267888*^9}, {3.641245226829062*^9, 3.641245230210504*^9}, {
   3.641245458190032*^9, 3.6412454692247047`*^9}, {3.64124603237013*^9, 
   3.6412460390582867`*^9}, {3.641246071191598*^9, 3.6412460888959427`*^9}, {
   3.641246528420402*^9, 3.641246584865932*^9}, {3.6412468700146008`*^9, 
   3.6412468721003647`*^9}, {3.641247063852124*^9, 3.6412471421058483`*^9}, {
   3.641247180952523*^9, 3.6412471810140533`*^9}, {3.641247842826194*^9, 
   3.6412478874204617`*^9}, {3.641345313853321*^9, 3.641345321547658*^9}, {
   3.641499975583962*^9, 3.641499981797701*^9}, {3.646204093212676*^9, 
   3.646204093387479*^9}, {3.6642293276755753`*^9, 3.664229378594754*^9}}],

Cell[BoxData[
 RowBox[{"Clear", "[", "DeclareIrreduciblePolynomialZero", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.639772398012538*^9, 3.63977239898426*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DeclareIrreduciblePolynomialZero", "[", "polynomial_", "]"}], "[", 
   RowBox[{"m", ":", 
    RowBox[{"Manifold", "[", 
     RowBox[{
     "substitutions_List", ",", "groebnerBasis_List", ",", 
      "otherIdentities_List", ",", "nonzeroPolynomials_List", ",", 
      "variables_List"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"newSubstitutions", ",", "variables0"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"polynomial", "===", "0"}], ",", 
      RowBox[{"{", "m", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"NumericQ", "[", "polynomial", "]"}], "\[Or]", 
         RowBox[{"MemberQ", "[", 
          RowBox[{"nonzeroPolynomials", ",", "polynomial"}], "]"}]}], ",", 
        RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"FreeQ", "[", 
           RowBox[{"polynomial", ",", 
            RowBox[{
             SubscriptBox["p", "_"], "|", 
             RowBox[{"tt", "[", "_", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
           "this", " ", "goes", " ", "into", " ", "the", " ", "Groebner", " ",
             "basis"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "AddIrreduciblePolynomialToGroebnerBasis", "[", "polynomial", 
            "]"}], "[", "m", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
           "this", " ", "goes", " ", "into", " ", "the", " ", "other", " ", 
            "identities"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
           "AddIrreduciblePolynomialToOtherIdentities", "[", "polynomial", 
            "]"}], "[", "m", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
       "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.62068694287613*^9, 3.620686974838972*^9}, {
   3.620687311310376*^9, 3.620687319287264*^9}, {3.62068736563314*^9, 
   3.62068751170623*^9}, {3.620687591458665*^9, 3.6206878838875713`*^9}, {
   3.620688252258073*^9, 3.6206882962474117`*^9}, {3.620690462994953*^9, 
   3.620690471603466*^9}, {3.621037605612302*^9, 3.621037617162682*^9}, {
   3.621038208643729*^9, 3.621038256008492*^9}, {3.621066743392267*^9, 
   3.621066779330867*^9}, {3.62106689774835*^9, 3.62106698270452*^9}, {
   3.6210671069501743`*^9, 3.621067109595055*^9}, {3.621218686487599*^9, 
   3.6212186959586763`*^9}, {3.6212201431019487`*^9, 
   3.6212201441019297`*^9}, {3.6212216016943197`*^9, 3.621221615238813*^9}, {
   3.622184278608469*^9, 3.622184283544512*^9}, {3.6224231051319647`*^9, 
   3.62242316496782*^9}, {3.6224232435928087`*^9, 3.622423245783929*^9}, {
   3.622425004501227*^9, 3.622425029838397*^9}, {3.622425524759184*^9, 
   3.6224255321737967`*^9}, {3.6397699164982*^9, 3.639769927560562*^9}, {
   3.639769960926674*^9, 3.639770064571308*^9}, {3.639772023069644*^9, 
   3.639772025529634*^9}, {3.639773230674425*^9, 3.639773235754599*^9}, {
   3.639788309425571*^9, 3.639788318903706*^9}, {3.6397926235753517`*^9, 
   3.6397926267983627`*^9}, {3.639792752074298*^9, 3.6397927571994553`*^9}, {
   3.639864129451456*^9, 3.639864151434799*^9}, 3.639871037229535*^9, {
   3.63987118303194*^9, 3.639871266757765*^9}, {3.639880870373076*^9, 
   3.639880873080023*^9}, {3.639881631569764*^9, 3.639881638188406*^9}, {
   3.639958402547928*^9, 3.639958440974629*^9}, {3.641006094902272*^9, 
   3.6410061027806787`*^9}, {3.6410243011717777`*^9, 3.6410243117657757`*^9}, 
   3.641026966647201*^9, 3.641089848585413*^9, {3.641246964656255*^9, 
   3.6412469866994753`*^9}, {3.641247202236911*^9, 3.641247205761232*^9}, {
   3.6412478950770073`*^9, 3.641247898788711*^9}, {3.6412479799817944`*^9, 
   3.641248032269476*^9}, {3.6412480784988117`*^9, 3.641248114925301*^9}, {
   3.6412481582436647`*^9, 3.641248209462139*^9}, {3.641345340946909*^9, 
   3.641345388718512*^9}, 3.64134554822038*^9, {3.6415003935824614`*^9, 
   3.641500393867885*^9}, {3.643519801872449*^9, 3.643519806532572*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
   "AddIrreduciblePolynomialToGroebnerBasis", "[", "polynomial_", "]"}], "[", 
   
   RowBox[{"m", ":", 
    RowBox[{"Manifold", "[", 
     RowBox[{
     "substitutions_List", ",", "groebnerBasis_List", ",", 
      "otherIdentities_List", ",", "nonzeroPolynomials_List", ",", 
      "variables_List"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "linearVariables", ",", "newGroebnerBasis", ",", "newNonzeroPolynomials",
       ",", "newOtherIdentities", ",", "newManifold", ",", 
      "newSubstitutions"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"newNonzeroPolynomials", "=", 
      RowBox[{"Union", "[", 
       RowBox[{"Factor", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"cachedRationalFunctionReduce", "[", 
           RowBox[{"#", ",", 
            RowBox[{
             RowBox[{"{", "polynomial", "}"}], "~", "Join", "~", 
             "groebnerBasis"}], ",", "variables"}], "]"}], "&"}], "/@", 
         "nonzeroPolynomials"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"newNonzeroPolynomials", "=", 
      RowBox[{"Union", "[", 
       RowBox[{"newNonzeroPolynomials", ",", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Cases", "[", 
            RowBox[{
             RowBox[{"withoutMultiplicity", "/@", 
              RowBox[{"timesToList", "[", 
               RowBox[{"Factor", "[", "#", "]"}], "]"}]}], ",", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"f_", ",", "k_"}], "}"}], "\[RuleDelayed]", "f"}]}], 
            "]"}], "&"}], "/@", "newNonzeroPolynomials"}], "]"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{"newNonzeroPolynomials", ",", "0"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"linearVariables", "=", 
            RowBox[{"Cases", "[", 
             RowBox[{"variables", ",", 
              RowBox[{"v_", "/;", 
               RowBox[{
                RowBox[{"Exponent", "[", 
                 RowBox[{"polynomial", ",", "v"}], "]"}], "\[Equal]", "1"}]}],
               ",", "1", ",", "1"}], "]"}]}], "]"}], ">", "0"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{
           "\"\<solving \>\"", ",", "polynomial", ",", " ", 
            "\"\< immediately\>\""}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"VerifyNonzero", "[", "nonzeroPolynomials", "]"}], "[", 
           RowBox[{
            RowBox[{"FactorGroebnerBasis", "[", 
             RowBox[{
              RowBox[{"SolvePolynomial", "[", 
               RowBox[{"polynomial", ",", 
                RowBox[{
                "linearVariables", "\[LeftDoubleBracket]", "1", 
                 "\[RightDoubleBracket]"}]}], "]"}], "[", "m", "]"}], "]"}], 
            ",", "m"}], "]"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{
           "\"\<adding \>\"", ",", " ", "polynomial", ",", 
            "\"\< to the Groebner basis \>\"", ",", 
            RowBox[{"Short", "[", "groebnerBasis", "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"newGroebnerBasis", "=", 
           RowBox[{"cachedGroebnerBasis", "[", 
            RowBox[{
             RowBox[{"groebnerBasis", "~", "Join", "~", 
              RowBox[{"{", "polynomial", "}"}]}], ",", "variables"}], "]"}]}],
           ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"MemberQ", "[", 
             RowBox[{"newGroebnerBasis", ",", 
              RowBox[{"1", "|", 
               RowBox[{"-", "1"}]}]}], "]"}], ",", 
            RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"\"\<newGroebnerBasis: \>\"", ",", "newGroebnerBasis"}],
               "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"newOtherIdentities", "=", 
              RowBox[{"DeleteCases", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"cachedPolynomialReduce", "[", 
                    RowBox[{"#", ",", "newGroebnerBasis", ",", "variables"}], 
                    "]"}], "\[LeftDoubleBracket]", "2", 
                   "\[RightDoubleBracket]"}], "&"}], "/@", 
                 "otherIdentities"}], ",", "0"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Print", "[", 
              RowBox[{"\"\<substitutions: \>\"", ",", "substitutions"}], 
              "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"newNonzeroPolynomials", "=", 
              RowBox[{"Union", "[", 
               RowBox[{"Factor", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"cachedRationalFunctionReduce", "[", 
                   RowBox[{"#", ",", "newGroebnerBasis", ",", "variables"}], 
                   "]"}], "&"}], "/@", "newNonzeroPolynomials"}], "]"}], 
               "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"newNonzeroPolynomials", "=", 
              RowBox[{"Union", "[", 
               RowBox[{"newNonzeroPolynomials", ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Cases", "[", 
                    RowBox[{
                    RowBox[{"withoutMultiplicity", "/@", 
                    RowBox[{"timesToList", "[", 
                    RowBox[{"Factor", "[", "#", "]"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"f_", ",", "k_"}], "}"}], "\[RuleDelayed]", 
                    "f"}]}], "]"}], "&"}], "/@", "newNonzeroPolynomials"}], 
                 "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"newManifold", "=", 
              RowBox[{"Manifold", "[", 
               RowBox[{
               "substitutions", ",", "newGroebnerBasis", ",", 
                "newOtherIdentities", ",", "newNonzeroPolynomials", ",", 
                "variables"}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"newNonzeroPolynomials", "=", 
              RowBox[{"Union", "[", 
               RowBox[{"Factor", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"cachedRationalFunctionReduce", "[", 
                   RowBox[{"#", ",", "newGroebnerBasis", ",", "variables"}], 
                   "]"}], "&"}], "/@", "nonzeroPolynomials"}], "]"}], "]"}]}],
              ";", "\[IndentingNewLine]", 
             RowBox[{"newNonzeroPolynomials", "=", 
              RowBox[{"Union", "[", 
               RowBox[{"newNonzeroPolynomials", ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Cases", "[", 
                    RowBox[{
                    RowBox[{"withoutMultiplicity", "/@", 
                    RowBox[{"timesToList", "[", 
                    RowBox[{"Factor", "[", "#", "]"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"f_", ",", "k_"}], "}"}], "\[RuleDelayed]", 
                    "f"}]}], "]"}], "&"}], "/@", "newNonzeroPolynomials"}], 
                 "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"MemberQ", "[", 
                RowBox[{"newNonzeroPolynomials", ",", "0"}], "]"}], ",", 
               RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"newSubstitutions", "=", 
                 RowBox[{
                  RowBox[{"Function", "[", 
                   RowBox[{
                    RowBox[{"{", "subst", "}"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"Print", "[", 
                    RowBox[{"\"\<updating substitution: \>\"", ",", "subst"}],
                     "]"}], ";"}], "*)"}], 
                    RowBox[{
                    RowBox[{
                    "subst", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "\[Rule]", 
                    RowBox[{
                    RowBox[{"ReducePolynomials", "[", "newManifold", "]"}], 
                    "[", 
                    RowBox[{
                    "subst", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "]"}]}]}], "]"}], "/@", 
                  "substitutions"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"newNonzeroPolynomials", "=", 
                 RowBox[{"DeleteCases", "[", 
                  RowBox[{"newNonzeroPolynomials", ",", 
                   RowBox[{"_Integer", "|", "_Rational"}]}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"newManifold", "=", 
                 RowBox[{"Manifold", "[", 
                  RowBox[{
                  "newSubstitutions", ",", "newGroebnerBasis", ",", 
                   "newOtherIdentities", ",", "newNonzeroPolynomials", ",", 
                   "variables"}], "]"}]}], ";", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"VerifyNonzero", "[", "nonzeroPolynomials", "]"}], 
                 "[", 
                 RowBox[{
                  RowBox[{"FactorGroebnerBasis", "[", 
                   RowBox[{"SolveOtherIdentities", "[", 
                    RowBox[{"SolveGroebnerBasis", "[", 
                    RowBox[{
                    "PromoteOtherIdentities", "[", "newManifold", "]"}], 
                    "]"}], "]"}], "]"}], ",", "m"}], "]"}]}]}], 
              "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
           "]"}]}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641248224824554*^9, 3.64124839720849*^9}, {
   3.641248448749979*^9, 3.6412486636302767`*^9}, {3.6412487406308823`*^9, 
   3.64124875066332*^9}, {3.6412488314178143`*^9, 3.6412488379444447`*^9}, {
   3.64125344268929*^9, 3.6412534681429873`*^9}, {3.641253513325467*^9, 
   3.641253522108859*^9}, {3.641253558162541*^9, 3.641253570841941*^9}, {
   3.641260733315907*^9, 3.641260734507578*^9}, {3.6412608599027433`*^9, 
   3.641260865847746*^9}, {3.641280281774345*^9, 3.641280354798017*^9}, {
   3.6412803930948267`*^9, 3.641280423496262*^9}, {3.641280495228668*^9, 
   3.6412805309751263`*^9}, 3.6412809311870623`*^9, {3.641280973502864*^9, 
   3.641280978351769*^9}, {3.641281088199069*^9, 3.641281110861013*^9}, {
   3.641281252648644*^9, 3.641281258374546*^9}, {3.641281696714312*^9, 
   3.641281711529524*^9}, {3.64128204242266*^9, 3.641282119142066*^9}, {
   3.641282156960935*^9, 3.641282176152022*^9}, {3.641282207689069*^9, 
   3.641282264516941*^9}, {3.641289657449955*^9, 3.6412897552437973`*^9}, {
   3.6412900002900143`*^9, 3.6412900063391047`*^9}, {3.6412905107044287`*^9, 
   3.6412905169194927`*^9}, {3.641290642413754*^9, 3.64129064406277*^9}, {
   3.641345542068892*^9, 3.641345604022766*^9}, {3.641347604335763*^9, 
   3.6413476075693817`*^9}, {3.641376225306913*^9, 3.641376227814458*^9}, {
   3.6415004020999613`*^9, 3.6415004198271427`*^9}, {3.641525654009844*^9, 
   3.641525663013143*^9}, {3.641982669783655*^9, 3.641982704164853*^9}, {
   3.641982999553739*^9, 3.6419830174570637`*^9}, {3.641983050156165*^9, 
   3.641983059010769*^9}, {3.641983175455017*^9, 3.641983224246249*^9}, {
   3.64199944678225*^9, 3.641999457583254*^9}, {3.6419994932483587`*^9, 
   3.641999527457161*^9}, {3.6419995874878607`*^9, 3.641999588209147*^9}, {
   3.642000517006291*^9, 3.642000573668983*^9}, {3.642000915884472*^9, 
   3.6420009291043367`*^9}, {3.642004040497759*^9, 3.642004054737783*^9}, {
   3.643454598165895*^9, 3.64345459983571*^9}, {3.643455321692362*^9, 
   3.643455395357512*^9}, {3.643455542097746*^9, 3.643455542502885*^9}, {
   3.643455783853595*^9, 3.6434558002031803`*^9}, {3.643467763831662*^9, 
   3.643467773108283*^9}, {3.643514979337359*^9, 3.643514990351404*^9}, {
   3.643522932121923*^9, 3.643522950092307*^9}, {3.6435318252433043`*^9, 
   3.64353182531415*^9}, {3.6435326674307547`*^9, 3.643532685404726*^9}, {
   3.643533996870921*^9, 3.6435340091112757`*^9}, {3.643534080534809*^9, 
   3.643534081284878*^9}, {3.643534463770665*^9, 3.6435344833273773`*^9}, {
   3.6435351607832823`*^9, 3.6435351807404623`*^9}, {3.6435353889625883`*^9, 
   3.643535396161765*^9}, {3.664226434376554*^9, 3.66422646864928*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"VerifyNonzero", "[", "polynomials_", "]"}], "[", 
   RowBox[{"m_Manifold", ",", "ms___Manifold"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"!", 
     RowBox[{"And", "@@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"mustBeNonZeroQ", "[", 
           RowBox[{"m", ",", "#"}], "]"}], "===", "True"}], "&"}], "/@", 
        "polynomials"}], ")"}]}]}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
     "Print", "[", "\"\<nonzero polynomials seem to have been forgotten!\>\"",
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"Cases", "[", 
       RowBox[{"polynomials", ",", 
        RowBox[{"pp_", "/;", 
         RowBox[{"!", 
          RowBox[{"mustBeNonZeroQ", "[", 
           RowBox[{"m", ",", "pp"}], "]"}]}]}]}], "]"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"\"\<manifold: \>\"", ",", "m"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"{", "ms", "}"}], "]"}], ">", "0"}], ",", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<old manifold: \>\"", ",", "ms"}], "]"}]}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Message", "[", 
      RowBox[{"foo", "::", "bar"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Abort", "[", "]"}]}], ",", "\[IndentingNewLine]", "m"}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641982708270176*^9, 3.6419827911403503`*^9}, {
  3.641982856449347*^9, 3.641982868910939*^9}, {3.641983130051114*^9, 
  3.641983133745376*^9}, {3.641983361249338*^9, 3.6419833693336*^9}, {
  3.6419999061446133`*^9, 3.641999909685442*^9}, {3.643523398324182*^9, 
  3.6435234382355843`*^9}, {3.643531552958267*^9, 3.643531580791751*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"VerifyNonzero", "[", "polynomials_", "]"}], "[", 
   RowBox[{"m_Manifold", ",", "ms___Manifold"}], "]"}], ":=", "m"}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.643536516943046*^9, 3.643536517954997*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"VerifyNonzero", "[", "polynomials_", "]"}], "[", 
   RowBox[{"S_List", ",", "ms___Manifold"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"VerifyNonzero", "[", "polynomials", "]"}], "[", 
     RowBox[{"#", ",", "ms"}], "]"}], "&"}], "/@", "S"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6419827926182957`*^9, 3.641982811050305*^9}, {
  3.643531709274272*^9, 3.64353171891516*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"FactorGroebnerBasis", "[", 
   RowBox[{"m", ":", 
    RowBox[{"Manifold", "[", 
     RowBox[{
     "substitutions_List", ",", "groebnerBasis_List", ",", 
      "otherIdentities_List", ",", "nonzeroPolynomials_List", ",", 
      "variables_List"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "targets", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"targets", "=", 
      RowBox[{"Cases", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"withoutMultiplicity", "/@", 
            RowBox[{"timesToList", "[", 
             RowBox[{"Factor", "[", "#", "]"}], "]"}]}], ")"}], "&"}], "/@", 
         "groebnerBasis"}], ",", 
        RowBox[{"factorization_", "/;", 
         RowBox[{
          RowBox[{"Total", "[", 
           RowBox[{"factorization", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}], "]"}], 
          "\[GreaterEqual]", "2"}]}], ",", "1", ",", "1"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "targets", "]"}], "\[Equal]", "0"}], ",", 
       RowBox[{"{", "m", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"FactorGroebnerBasis", "[", 
        RowBox[{
         RowBox[{"VerifyNonzero", "[", "nonzeroPolynomials", "]"}], "[", 
         RowBox[{
          RowBox[{
           RowBox[{"DeclareAtLeastOnePolynomialZero", "[", 
            RowBox[{"targets", "\[LeftDoubleBracket]", 
             RowBox[{"1", ",", "All", ",", "1"}], "\[RightDoubleBracket]"}], 
            "]"}], "[", "m", "]"}], ",", "m"}], "]"}], "]"}]}], 
      "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"FactorGroebnerBasis", "[", "M_List", "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{"FactorGroebnerBasis", "/@", "M"}], ",", "1"}], "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641290009505801*^9, 3.641290174655426*^9}, {
  3.641290342137782*^9, 3.641290348125752*^9}, {3.6412904321691637`*^9, 
  3.641290433734964*^9}, {3.6413456146777897`*^9, 3.641345615583177*^9}, {
  3.6435150046204023`*^9, 3.643515017561677*^9}, {3.643531736217347*^9, 
  3.643531736284738*^9}, {3.6435320056919727`*^9, 3.643532007316421*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PromoteOtherIdentities", "[", 
   RowBox[{"m", ":", 
    RowBox[{"Manifold", "[", 
     RowBox[{
     "substitutions_List", ",", "groebnerBasis_List", ",", 
      "otherIdentities_List", ",", "nonzeroPolynomials_List", ",", 
      "variables_List"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "targets", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"targets", "=", 
      RowBox[{"Cases", "[", 
       RowBox[{"otherIdentities", ",", 
        RowBox[{"e_", "/;", 
         RowBox[{"FreeQ", "[", 
          RowBox[{"e", ",", 
           RowBox[{
            SubscriptBox["p", "_"], "|", 
            RowBox[{"tt", "[", "_", "]"}]}]}], "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "targets", "]"}], "\[Equal]", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", "m", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{
         "\"\<Promoting identities into the Groebner basis: \>\"", ",", 
          "targets"}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"VerifyNonzero", "[", "nonzeroPolynomials", "]"}], "[", 
         RowBox[{
          RowBox[{
           RowBox[{"DeclarePolynomialsZero", "[", "targets", "]"}], "[", 
           RowBox[{"Manifold", "[", 
            RowBox[{"substitutions", ",", "groebnerBasis", ",", 
             RowBox[{"Complement", "[", 
              RowBox[{"otherIdentities", ",", "targets"}], "]"}], ",", 
             "nonzeroPolynomials", ",", "variables"}], "]"}], "]"}], ",", 
          "m"}], "\[IndentingNewLine]", "]"}]}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PromoteOtherIdentities", "[", "M_List", "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{"PromoteOtherIdentities", "/@", "M"}], ",", "1"}], 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641248839838923*^9, 3.641248963522365*^9}, 
   3.64125026157305*^9, {3.641345623345378*^9, 3.641345635903265*^9}, {
   3.641369170790618*^9, 3.64136918214573*^9}, {3.643515032790677*^9, 
   3.6435150350034513`*^9}, {3.64353174760268*^9, 3.643531747660699*^9}, {
   3.643537539618792*^9, 3.643537540762355*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"SolveGroebnerBasis", "[", 
   RowBox[{"m", ":", 
    RowBox[{"Manifold", "[", 
     RowBox[{
     "substitutions_List", ",", "groebnerBasis_List", ",", 
      "otherIdentities_List", ",", "nonzeroPolynomials_List", ",", 
      "variables_List"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"targets", ",", "denominator", ",", "numerator"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"targets", "=", 
      RowBox[{"Cases", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Outer", "[", 
           RowBox[{"List", ",", "groebnerBasis", ",", "variables", ",", "1"}],
            "]"}], ",", "1"}], "]"}], ",", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"polynomial_", ",", "variable_"}], "}"}], "/;", 
         RowBox[{
          RowBox[{"Exponent", "[", 
           RowBox[{"polynomial", ",", "variable"}], "]"}], "\[Equal]", 
          "1"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "targets", "]"}], "\[Equal]", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"{", "m", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"SolvePolynomial", "[", 
         RowBox[{
          RowBox[{"targets", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ",", 
          RowBox[{"targets", "\[LeftDoubleBracket]", 
           RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}]}], "]"}], "[", 
        "m", "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]",
    "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SolveGroebnerBasis", "[", "M_List", "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{"SolveGroebnerBasis", "/@", "M"}], ",", "1"}], "]"}]}]}], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.6412497913934507`*^9, 3.6412500154426928`*^9}, {
   3.641250074328336*^9, 3.641250074686675*^9}, {3.641250293408928*^9, 
   3.641250311119103*^9}, {3.641250368158031*^9, 3.6412503919731617`*^9}, {
   3.641253729789172*^9, 3.64125372986007*^9}, {3.641281380040257*^9, 
   3.6412814423973913`*^9}, 3.6412823209035463`*^9, {3.6412825861587467`*^9, 
   3.641282588148843*^9}, {3.641282648340604*^9, 3.6412826566498117`*^9}, {
   3.641289276496995*^9, 3.6412892963268547`*^9}, {3.641290540159171*^9, 
   3.641290541873866*^9}, {3.641290590115423*^9, 3.641290598423792*^9}, {
   3.64134564426539*^9, 3.641345651319271*^9}, 3.64345519086833*^9, {
   3.6434552545795193`*^9, 3.643455270320051*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SolvePolynomial", "[", 
    RowBox[{"p_", ",", "v_"}], "]"}], "[", 
   RowBox[{"m", ":", 
    RowBox[{"Manifold", "[", 
     RowBox[{
     "substitutions_List", ",", "groebnerBasis_List", ",", 
      "otherIdentities_List", ",", "nonzeroPolynomials_List", ",", 
      "variables_List"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"numerator", ",", "denominator"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Print", "[", 
      RowBox[{"\"\<solving for \>\"", ",", "v"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"numerator", "=", 
      RowBox[{"-", 
       RowBox[{"(", 
        RowBox[{"p", "/.", 
         RowBox[{"v", "\[Rule]", "0"}]}], ")"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"denominator", "=", 
      RowBox[{"Coefficient", "[", 
       RowBox[{"p", ",", "v"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Flatten", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{
           "\"\<considering the case where the coefficients \>\"", ",", 
            RowBox[{"{", 
             RowBox[{"numerator", ",", "denominator"}], "}"}], ",", 
            "\"\< vanish separately\>\""}], "]"}], ";", 
          RowBox[{
           RowBox[{"VerifyNonzero", "[", "nonzeroPolynomials", "]"}], "[", 
           RowBox[{
            RowBox[{
             RowBox[{"DeclarePolynomialsZero", "[", 
              RowBox[{"{", 
               RowBox[{"numerator", ",", "denominator"}], "}"}], "]"}], "[", 
             "m", "]"}], ",", "m"}], "]"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"\"\<adding the substitution \>\"", ",", 
            RowBox[{"v", "\[Rule]", 
             RowBox[{"Factor", "[", 
              RowBox[{"numerator", "/", "denominator"}], "]"}]}]}], "]"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"VerifyNonzero", "[", "nonzeroPolynomials", "]"}], "[", 
           RowBox[{
            RowBox[{
             RowBox[{"AddSubstitution", "[", 
              RowBox[{"v", "\[Rule]", 
               RowBox[{"Factor", "[", 
                RowBox[{"numerator", "/", "denominator"}], "]"}]}], "]"}], 
             "[", 
             RowBox[{
              RowBox[{"DeclarePolynomialNonZero", "[", "denominator", "]"}], 
              "[", "m", "]"}], "]"}], ",", "m"}], "]"}]}]}], 
        "\[IndentingNewLine]", "}"}], ",", "1"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643455194206019*^9, 3.6434552489035873`*^9}, {
  3.643514720289662*^9, 3.643514738233843*^9}, {3.643514894921876*^9, 
  3.64351490486966*^9}, {3.643515049067698*^9, 3.643515057948412*^9}, {
  3.6435178137553463`*^9, 3.643517817406143*^9}, {3.643517913978544*^9, 
  3.643517916573823*^9}, {3.643531753320882*^9, 3.643531759102499*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
   "AddIrreduciblePolynomialToOtherIdentities", "[", "polynomial_", "]"}], 
   "[", 
   RowBox[{"m", ":", 
    RowBox[{"Manifold", "[", 
     RowBox[{
     "substitutions_List", ",", "groebnerBasis_List", ",", 
      "otherIdentities_List", ",", "nonzeroPolynomials_List", ",", 
      "variables_List"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"VerifyNonzero", "[", "nonzeroPolynomials", "]"}], "[", 
     RowBox[{
      RowBox[{"SolveOtherIdentities", "[", 
       RowBox[{"Manifold", "[", 
        RowBox[{"substitutions", ",", "groebnerBasis", ",", 
         RowBox[{"Union", "[", 
          RowBox[{"otherIdentities", "~", "Join", "~", 
           RowBox[{"{", "polynomial", "}"}]}], "]"}], ",", 
         "nonzeroPolynomials", ",", "variables"}], "]"}], "]"}], ",", "m"}], 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641248667818824*^9, 3.6412487372199583`*^9}, {
  3.641253851398995*^9, 3.641253855281599*^9}, {3.6413456589736347`*^9, 
  3.6413456622080107`*^9}, {3.643515064451785*^9, 3.643515067517132*^9}, {
  3.643531764198564*^9, 3.643531764262471*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"SolveOtherIdentities", "[", 
    RowBox[{"m", ":", 
     RowBox[{"Manifold", "[", 
      RowBox[{
      "substitutions_List", ",", "groebnerBasis_List", ",", 
       "otherIdentities_List", ",", "nonzeroPolynomials_List", ",", 
       "variables_List"}], "]"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"variables1", ",", "variables2", ",", "targets"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"variables1", " ", "=", 
       RowBox[{"Union", "[", 
        RowBox[{"Cases", "[", 
         RowBox[{"otherIdentities", ",", 
          RowBox[{"tt", "[", "_", "]"}], ",", "\[Infinity]"}], "]"}], "]"}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"targets", "=", 
       RowBox[{"Cases", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"Outer", "[", 
            RowBox[{
            "List", ",", "otherIdentities", ",", "variables1", ",", "1"}], 
            "]"}], ",", "1"}], "]"}], ",", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"polynomial_", ",", "variable_"}], "}"}], "/;", 
          RowBox[{
           RowBox[{
            RowBox[{"Exponent", "[", 
             RowBox[{"polynomial", ",", "variable"}], "]"}], "\[Equal]", 
            "1"}], "\[And]", 
           RowBox[{"mustBeNonZeroQ", "[", 
            RowBox[{"m", ",", 
             RowBox[{"Coefficient", "[", 
              RowBox[{"polynomial", ",", "variable"}], "]"}]}], "]"}]}]}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "targets", "]"}], "\[Equal]", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"variables2", "=", 
          RowBox[{"Union", "[", 
           RowBox[{"Cases", "[", 
            RowBox[{"otherIdentities", ",", 
             SubscriptBox["p", "_"], ",", "\[Infinity]"}], "]"}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"targets", "=", 
          RowBox[{"Cases", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"Outer", "[", 
               RowBox[{
               "List", ",", "otherIdentities", ",", "variables2", ",", "1"}], 
               "]"}], ",", "1"}], "]"}], ",", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"polynomial_", ",", "variable_"}], "}"}], "/;", 
             RowBox[{
              RowBox[{
               RowBox[{"Exponent", "[", 
                RowBox[{"polynomial", ",", "variable"}], "]"}], "\[Equal]", 
               "1"}], "\[And]", 
              RowBox[{"mustBeNonZeroQ", "[", 
               RowBox[{"m", ",", 
                RowBox[{"Coefficient", "[", 
                 RowBox[{"polynomial", ",", "variable"}], "]"}]}], 
               "]"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"targets", "=", 
          RowBox[{"SortBy", "[", 
           RowBox[{"targets", ",", 
            RowBox[{
             RowBox[{"-", 
              RowBox[{"diagramWeight", "[", 
               RowBox[{"NamedPolyhedron", "[", 
                RowBox[{
                "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                "]"}], "]"}]}], "&"}]}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "targets", "]"}], "\[Equal]", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", "m", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"SolveOtherIdentities", "[", 
         RowBox[{
          RowBox[{"VerifyNonzero", "[", "nonzeroPolynomials", "]"}], "[", 
          RowBox[{
           RowBox[{
            RowBox[{"AddSubstitution", "[", 
             RowBox[{
              RowBox[{"targets", "\[LeftDoubleBracket]", 
               RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "\[Rule]", 
              
              RowBox[{"Factor", "[", 
               RowBox[{
                RowBox[{"Solve", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"targets", "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], 
                   "\[Equal]", "0"}], ",", 
                  RowBox[{"targets", "\[LeftDoubleBracket]", 
                   RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}]}], 
                 "]"}], "\[LeftDoubleBracket]", 
                RowBox[{"1", ",", "1", ",", "2"}], "\[RightDoubleBracket]"}], 
               "]"}]}], "]"}], "[", 
            RowBox[{"Manifold", "[", 
             RowBox[{"substitutions", ",", "groebnerBasis", ",", 
              RowBox[{"DeleteCases", "[", 
               RowBox[{"otherIdentities", ",", 
                RowBox[{"targets", "\[LeftDoubleBracket]", 
                 RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], "]"}], 
              ",", "nonzeroPolynomials", ",", "variables"}], "]"}], "]"}], 
           ",", "m"}], "]"}], "]"}]}], "\[IndentingNewLine]", "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SolveOtherIdentities", "[", "M_List", "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{"SolveOtherIdentities", "/@", "M"}], ",", "1"}], 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641248754584976*^9, 3.641248792534904*^9}, {
   3.641248976519203*^9, 3.64124897787123*^9}, {3.641249015931525*^9, 
   3.641249148425807*^9}, {3.6412491975752563`*^9, 3.641249323548952*^9}, {
   3.6412498559049263`*^9, 3.64124985672792*^9}, {3.641250316098567*^9, 
   3.6412503214538107`*^9}, {3.641250689139324*^9, 3.6412506892014914`*^9}, {
   3.6412531522963657`*^9, 3.641253161484106*^9}, {3.641259140458313*^9, 
   3.641259172023282*^9}, {3.64134567381332*^9, 3.641345695702335*^9}, {
   3.641982874687357*^9, 3.6419828776189413`*^9}, {3.643515075167141*^9, 
   3.6435150777642612`*^9}, {3.643520832727236*^9, 3.6435208381041737`*^9}, {
   3.6435317724801064`*^9, 3.6435317725111227`*^9}, {3.664218865019133*^9, 
   3.664218874978528*^9}, {3.664218906606832*^9, 3.664219038069045*^9}, 
   3.664219125126605*^9, {3.664219217057232*^9, 3.66421922965761*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"mustBeNonZeroQ", "[", 
   RowBox[{
    RowBox[{"m", ":", 
     RowBox[{"_", "[", 
      RowBox[{
      "_List", ",", "_List", ",", "_List", ",", "nonzeroPolynomials_List", 
       ",", "_List"}], "]"}]}], ",", "polynomial_"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "factors", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"Print", "[", 
       RowBox[{"\"\<mustBeNonZeroQ: \>\"", ",", "polynomial"}], "]"}], ";"}], 
     "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"factors", "=", 
      RowBox[{"Cases", "[", 
       RowBox[{
        RowBox[{"withoutMultiplicity", "/@", 
         RowBox[{"timesToList", "[", 
          RowBox[{"Factor", "[", 
           RowBox[{
            RowBox[{"ReducePolynomials", "[", "m", "]"}], "[", "polynomial", 
            "]"}], "]"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{"f_", ",", "k_"}], "}"}], "/;", 
          RowBox[{"k", ">", "0"}]}], "\[RuleDelayed]", "f"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Print", "[", 
        RowBox[{"\"\<factors: \>\"", ",", "factors"}], "]"}], ";"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"factors", "===", 
        RowBox[{"{", "0", "}"}]}], ",", "\[IndentingNewLine]", "False", ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"factors", "=", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{"factors", ",", 
           RowBox[{"_Integer", "|", "_Rational", "|", "_AlgebraicNumber"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"factors", "=", 
         RowBox[{"Complement", "[", 
          RowBox[{"factors", ",", 
           RowBox[{"nonzeroPolynomials", "~", "Join", "~", 
            RowBox[{"(", 
             RowBox[{"-", "nonzeroPolynomials"}], ")"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"\"\<factors: \>\"", ",", "factors"}], "]"}], ";"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "factors", "]"}], ">", "1"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Print", "[", "m", "]"}]}], "\[IndentingNewLine]", "]"}], 
          ";"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Length", "[", "factors", "]"}], "\[Equal]", "0"}]}]}], 
      "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641249326675974*^9, 3.641249448289446*^9}, {
   3.6412505241127367`*^9, 3.641250567869129*^9}, {3.641345705556122*^9, 
   3.641345706664383*^9}, {3.6419993009019127`*^9, 3.64199932286961*^9}, {
   3.6419997509123697`*^9, 3.641999754519656*^9}, {3.642000029204363*^9, 
   3.642000043254738*^9}, 3.6434531353709393`*^9, {3.6434574620158567`*^9, 
   3.643457465547216*^9}, {3.6434582978396997`*^9, 3.643458313524227*^9}, {
   3.6434597030085573`*^9, 3.643459713906014*^9}, {3.643515260479045*^9, 
   3.6435152832258453`*^9}, 3.643525245748095*^9, {3.664488907214129*^9, 
   3.6644889101477327`*^9}}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "AddSubstitution", "]"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"AddSubstitution", "[", 
    RowBox[{"substitution", ":", 
     RowBox[{"(", 
      RowBox[{"_", "\[Rule]", "_"}], ")"}]}], "]"}], "[", 
   RowBox[{"m", ":", 
    RowBox[{"Manifold", "[", 
     RowBox[{
     "substitutions_List", ",", "groebnerBasis_List", ",", 
      "otherIdentities_List", ",", "nonzeroPolynomials_List", ",", 
      "variables_List"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "newGroebnerBasis", ",", "newSubstitutions", ",", "newOtherIdentities", 
      ",", "newNonzeroPolynomials", ",", "newManifold"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"MemberQ", "[", 
       RowBox[{"substitutions", ",", "substitution"}], "]"}], ",", 
      RowBox[{"{", "m", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"newGroebnerBasis", "=", 
        RowBox[{"cachedGroebnerBasis", "[", 
         RowBox[{
          RowBox[{"Numerator", "[", 
           RowBox[{"Together", "[", 
            RowBox[{"groebnerBasis", "/.", "substitution"}], "]"}], "]"}], 
          ",", "variables"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"MemberQ", "[", 
          RowBox[{"newGroebnerBasis", ",", 
           RowBox[{"1", "|", 
            RowBox[{"-", "1"}]}]}], "]"}], ",", 
         RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
           RowBox[{
           "this", " ", "is", " ", "a", " ", "shocking", " ", "mess"}], ",", 
           " ", 
           RowBox[{
           "trying", " ", "to", " ", "make", " ", "sure", " ", "we", " ", 
            "keep", " ", "around", " ", "all", " ", "the", " ", "nonzero", 
            " ", "polynomials", " ", "correctly"}]}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"newNonzeroPolynomials", "=", 
           RowBox[{"Union", "[", 
            RowBox[{"Factor", "[", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"cachedRationalFunctionReduce", "[", 
                 RowBox[{
                  RowBox[{"Together", "[", 
                   RowBox[{"#", "/.", "substitution"}], "]"}], ",", 
                  "newGroebnerBasis", ",", "variables"}], "]"}], "&"}], "/@", 
               "nonzeroPolynomials"}], ")"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"newNonzeroPolynomials", "=", 
           RowBox[{"Factor", "[", 
            RowBox[{"Union", "[", 
             RowBox[{"newNonzeroPolynomials", ",", 
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Cases", "[", 
                  RowBox[{
                   RowBox[{"withoutMultiplicity", "/@", 
                    RowBox[{"timesToList", "[", 
                    RowBox[{"Factor", "[", "#", "]"}], "]"}]}], ",", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"f_", ",", "k_"}], "}"}], "\[RuleDelayed]", 
                    "f"}]}], "]"}], "&"}], "/@", "newNonzeroPolynomials"}], 
               "]"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"MemberQ", "[", 
             RowBox[{"newNonzeroPolynomials", ",", "0"}], "]"}], ",", 
            RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"newOtherIdentities", "=", 
              RowBox[{"DeleteCases", "[", 
               RowBox[{
                RowBox[{"Expand", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"cachedPolynomialReduce", "[", 
                    RowBox[{
                    RowBox[{"Numerator", "[", 
                    RowBox[{"Together", "[", 
                    RowBox[{"#", "/.", "substitution"}], "]"}], "]"}], ",", 
                    "newGroebnerBasis", ",", "variables"}], "]"}], 
                    "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
                   "&"}], "/@", "otherIdentities"}], "]"}], ",", "0"}], 
               "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"newManifold", "=", 
              RowBox[{"Manifold", "[", 
               RowBox[{
               "substitutions", ",", "newGroebnerBasis", ",", 
                "newOtherIdentities", ",", 
                RowBox[{"DeleteCases", "[", 
                 RowBox[{"newNonzeroPolynomials", ",", 
                  RowBox[{"_", "?", "NumericQ"}]}], "]"}], ",", "variables"}],
                "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"newSubstitutions", "=", 
              RowBox[{
               RowBox[{"Function", "[", 
                RowBox[{
                 RowBox[{"{", "subst", "}"}], ",", "\[IndentingNewLine]", 
                 RowBox[{"(*", 
                  RowBox[{
                   RowBox[{"Print", "[", 
                    RowBox[{"\"\<updating substitution: \>\"", ",", "subst"}],
                     "]"}], ";"}], "*)"}], 
                 RowBox[{
                  RowBox[{
                  "subst", "\[LeftDoubleBracket]", "1", 
                   "\[RightDoubleBracket]"}], "\[Rule]", 
                  RowBox[{
                   RowBox[{"ReducePolynomials", "[", "newManifold", "]"}], 
                   "[", 
                   RowBox[{
                   "subst", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "]"}]}]}], "]"}], "/@", 
               RowBox[{"Together", "[", 
                RowBox[{"Sort", "[", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"substitutions", "/.", "substitution"}], ")"}], 
                  "~", "Join", "~", 
                  RowBox[{"{", "substitution", "}"}]}], "]"}], "]"}]}]}], ";",
              "\[IndentingNewLine]", 
             RowBox[{"newManifold", "=", 
              RowBox[{"ReplacePart", "[", 
               RowBox[{"newManifold", ",", 
                RowBox[{"1", "\[Rule]", "newSubstitutions"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"newNonzeroPolynomials", "=", 
              RowBox[{"Union", "[", 
               RowBox[{"newNonzeroPolynomials", ",", 
                RowBox[{"Factor", "[", 
                 RowBox[{
                  RowBox[{"ReducePolynomials", "[", "newManifold", "]"}], "[",
                   "nonzeroPolynomials", "]"}], "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"newNonzeroPolynomials", "=", 
              RowBox[{"Union", "[", 
               RowBox[{"newNonzeroPolynomials", ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Cases", "[", 
                    RowBox[{
                    RowBox[{"withoutMultiplicity", "/@", 
                    RowBox[{"timesToList", "[", 
                    RowBox[{"Factor", "[", "#", "]"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"f_", ",", "k_"}], "}"}], "\[RuleDelayed]", 
                    "f"}]}], "]"}], "&"}], "/@", "newNonzeroPolynomials"}], 
                 "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"MemberQ", "[", 
                RowBox[{"newNonzeroPolynomials", ",", "0"}], "]"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Print", "[", 
                 RowBox[{
                 "\"\<The substitution \>\"", ",", "substitution", ",", 
                  "\"\< would render a nonzero quantity zero, so we reject \
this possibility.\>\""}], "]"}], ";", "\[IndentingNewLine]", 
                RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"newManifold", "=", 
                 RowBox[{"ReplacePart", "[", 
                  RowBox[{"newManifold", ",", 
                   RowBox[{
                    RowBox[{"-", "2"}], "\[Rule]", 
                    RowBox[{"DeleteCases", "[", 
                    RowBox[{"newNonzeroPolynomials", ",", 
                    RowBox[{"_", "?", "NumericQ"}]}], "]"}]}]}], "]"}]}], ";",
                 "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{
                 "TODO", " ", "what", " ", "other", " ", "processing", " ", 
                  "has", " ", "to", " ", "happen", " ", 
                  RowBox[{"afterwards", "?"}]}], " ", "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"VerifyNonzero", "[", "nonzeroPolynomials", "]"}], 
                 "[", 
                 RowBox[{
                  RowBox[{"FactorGroebnerBasis", "[", 
                   RowBox[{"SolveOtherIdentities", "[", 
                    RowBox[{"SolveGroebnerBasis", "[", 
                    RowBox[{"PromoteOtherIdentities", "[", 
                    RowBox[{
                    RowBox[{"VerifyNonzero", "[", "nonzeroPolynomials", "]"}],
                     "[", 
                    RowBox[{
                    RowBox[{"{", "newManifold", "}"}], ",", "m"}], "]"}], 
                    "]"}], "]"}], "]"}], "]"}], ",", "newManifold"}], 
                 "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}],
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"automaticFlatMap", "[", "AddSubstitution", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6412506588695107`*^9, 3.641250669005137*^9}, {
   3.641253737485458*^9, 3.641253737556233*^9}, {3.64134571147746*^9, 
   3.6413457432833*^9}, {3.6413475902810926`*^9, 3.641347594147258*^9}, {
   3.641369130045911*^9, 3.6413691331055317`*^9}, {3.641369374304831*^9, 
   3.641369383106831*^9}, {3.641500372688263*^9, 3.641500374999509*^9}, {
   3.641999570042079*^9, 3.641999570476804*^9}, {3.6434435609418*^9, 
   3.643443585887637*^9}, {3.643515085621306*^9, 3.643515117955401*^9}, {
   3.643516370988233*^9, 3.643516416692309*^9}, {3.643516456211917*^9, 
   3.6435164709966784`*^9}, {3.643517501803393*^9, 3.6435175318593616`*^9}, {
   3.6435191232334633`*^9, 3.6435192235521393`*^9}, {3.643519256615099*^9, 
   3.6435192676642847`*^9}, {3.643519371432661*^9, 3.643519379791688*^9}, {
   3.643519844242302*^9, 3.6435198986756363`*^9}, {3.643520634339265*^9, 
   3.643520644818644*^9}, {3.643523055309896*^9, 3.6435230813456087`*^9}, {
   3.643523744311124*^9, 3.6435237582612*^9}, {3.643523941630332*^9, 
   3.643523964366609*^9}, {3.643524121353548*^9, 3.643524143264625*^9}, 
   3.6435242061927423`*^9, {3.6435246312614307`*^9, 3.643524692450914*^9}, {
   3.643531779264352*^9, 3.643531804963876*^9}, {3.6435340355696507`*^9, 
   3.6435340714303427`*^9}, {3.6435344967193003`*^9, 3.643534506198966*^9}, {
   3.643535191360363*^9, 3.643535197957603*^9}, {3.64353540017977*^9, 
   3.643535400548052*^9}, {3.643557118285947*^9, 3.643557122925461*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DeclarePolynomialsNonZero", "[", "p_List", "]"}], "[", 
   "m_Manifold", "]"}], ":=", 
  RowBox[{"Fold", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"DeclarePolynomialNonZero", "[", "#2", "]"}], "[", "#1", "]"}], 
     "&"}], ",", 
    RowBox[{"{", "m", "}"}], ",", "p"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621905752774639*^9, 3.6219057663311768`*^9}, {
   3.622184291897727*^9, 3.622184302743968*^9}, 3.622185454632936*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DeclarePolynomialNonZero", "[", 
    RowBox[{"1", "|", 
     RowBox[{"-", "1"}]}], "]"}], "[", "m_Manifold", "]"}], ":=", 
  RowBox[{"{", "m", "}"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.639772346645834*^9, 3.6397723616829863`*^9}, {
  3.641459727311832*^9, 3.641459727952956*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DeclarePolynomialNonZero", "[", "p_", "]"}], "[", "m_Manifold", 
   "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "factors", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"factors", "=", 
      RowBox[{"Complement", "[", 
       RowBox[{
        RowBox[{"DeleteCases", "[", 
         RowBox[{
          RowBox[{"Cases", "[", 
           RowBox[{
            RowBox[{"withoutMultiplicity", "/@", 
             RowBox[{"timesToList", "[", 
              RowBox[{"Factor", "[", "p", "]"}], "]"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"{", 
               RowBox[{"f_", ",", "k_"}], "}"}], "/;", 
              RowBox[{"k", ">", "0"}]}], "\[RuleDelayed]", "f"}]}], "]"}], 
          ",", 
          RowBox[{"1", "|", 
           RowBox[{"-", "1"}]}]}], "]"}], ",", 
        RowBox[{
         RowBox[{"m", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
         "~", "Join", "~", 
         RowBox[{"(", 
          RowBox[{"-", 
           RowBox[{
           "m", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
          ")"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "factors", "]"}], ">", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"text", "[", 
        RowBox[{
        "\"\<We find the factors \>\"", " ", ",", "factors", ",", 
         "\"\< and then require that each is nonzero.\>\""}], "]"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"DeclareIrreduciblePolynomialNonZero", "[", 
       RowBox[{"Numerator", "[", 
        RowBox[{"Together", "[", "p", "]"}], "]"}], "]"}], "[", 
      RowBox[{"Fold", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"DeclareIrreduciblePolynomialNonZero", "[", "#2", "]"}], 
          "[", "#1", "]"}], "&"}], ",", 
        RowBox[{"{", "m", "}"}], ",", "factors"}], "]"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.62068694287613*^9, 3.620686974838972*^9}, {
   3.620687311310376*^9, 3.620687319287264*^9}, {3.62068736563314*^9, 
   3.62068751170623*^9}, {3.620687591458665*^9, 3.6206878838875713`*^9}, {
   3.620688252258073*^9, 3.6206882962474117`*^9}, {3.620690462994953*^9, 
   3.620690471603466*^9}, {3.621037605612302*^9, 3.621037621563476*^9}, {
   3.621037700451891*^9, 3.621037745998996*^9}, {3.621037808174513*^9, 
   3.621037904670384*^9}, {3.621037940593836*^9, 3.6210380695587263`*^9}, {
   3.6210671148994837`*^9, 3.621067126739744*^9}, 3.621222526413845*^9, 
   3.6212230494289207`*^9, {3.622184305443404*^9, 3.62218432246428*^9}, {
   3.622423418126356*^9, 3.622423423086355*^9}, {3.641244218576878*^9, 
   3.641244236281629*^9}, {3.641244311377351*^9, 3.6412443323516617`*^9}, {
   3.641244367285705*^9, 3.641244380051936*^9}, {3.642001204757572*^9, 
   3.642001226669303*^9}, {3.642003825905979*^9, 3.6420038284706717`*^9}, {
   3.6420042704363956`*^9, 3.6420042753572187`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DeclareIrreduciblePolynomialNonZero", "[", "polynomial_", "]"}], 
   "[", 
   RowBox[{"m", ":", 
    RowBox[{"Manifold", "[", 
     RowBox[{
     "substitutions_List", ",", "groebnerBasis_List", ",", 
      "otherIdentities_List", ",", "nonzeroPolynomials_List", ",", 
      "variables_List"}], "]"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"reduced", ",", "variables0"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"variables0", "=", 
      RowBox[{
       RowBox[{"Union", "[", 
        RowBox[{"Cases", "[", 
         RowBox[{"groebnerBasis", ",", 
          RowBox[{
           SubscriptBox["p", "_"], "|", 
           RowBox[{"tt", "[", "_", "]"}]}], ",", "\[Infinity]"}], "]"}], 
        "]"}], "~", "Join", "~", "variables"}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"reduced", "=", 
      RowBox[{
       RowBox[{"ReducePolynomials", "[", "m", "]"}], "[", "polynomial", 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"reduced", "===", "0"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"text", "[", 
         RowBox[{
         "\"\<Since \>\"", ",", "polynomial", ",", " ", 
          "\"\< is zero modulo the ideal, we terminate the analysis \
here.\>\""}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"text", "[", 
          RowBox[{
          "\"\<We add \>\"", ",", "reduced", ",", 
           "\"\< to the list of nonzero quantities.\>\""}], "]"}], ";"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"VerifyNonzero", "[", "nonzeroPolynomials", "]"}], "[", 
        RowBox[{
         RowBox[{"SolveOtherIdentities", "[", 
          RowBox[{"{", 
           RowBox[{"Manifold", "[", 
            RowBox[{
            "substitutions", ",", "groebnerBasis", ",", "otherIdentities", 
             ",", 
             RowBox[{"Union", "[", 
              RowBox[{"nonzeroPolynomials", "~", "Join", "~", 
               RowBox[{"DeleteCases", "[", 
                RowBox[{
                 RowBox[{"{", "reduced", "}"}], ",", 
                 RowBox[{"_", "?", "NumericQ"}]}], "]"}]}], "]"}], ",", 
             "variables"}], "]"}], "}"}], "]"}], ",", "m"}], "]"}]}], 
      "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.62068694287613*^9, 3.620686974838972*^9}, {
   3.620687311310376*^9, 3.620687319287264*^9}, {3.62068736563314*^9, 
   3.62068751170623*^9}, {3.620687591458665*^9, 3.6206878838875713`*^9}, {
   3.620688252258073*^9, 3.6206882962474117`*^9}, {3.620690462994953*^9, 
   3.620690471603466*^9}, {3.621037605612302*^9, 3.621037621563476*^9}, {
   3.621038149102412*^9, 3.621038180920744*^9}, 3.621067131711853*^9, {
   3.6210671665262423`*^9, 3.6210671938995934`*^9}, {3.6212097200139217`*^9, 
   3.621209721718713*^9}, {3.621221581947818*^9, 3.621221585802703*^9}, {
   3.622184325059463*^9, 3.622184331808283*^9}, {3.63977061664219*^9, 
   3.639770635354681*^9}, {3.639792717958839*^9, 3.639792718399808*^9}, {
   3.639864567224434*^9, 3.639864583193198*^9}, {3.641006120474098*^9, 
   3.641006128078597*^9}, {3.641250812944668*^9, 3.641250840434505*^9}, {
   3.641259885591123*^9, 3.641259906517991*^9}, {3.6413457538033123`*^9, 
   3.64134578866923*^9}, {3.641369256591455*^9, 3.641369258808199*^9}, {
   3.641369397416857*^9, 3.641369398373251*^9}, {3.641515128445861*^9, 
   3.641515129700837*^9}, {3.6435151289796753`*^9, 3.643515131674765*^9}, {
   3.64352242175482*^9, 3.643522465401318*^9}, {3.643531813903194*^9, 
   3.643531813978839*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Manipulating spiders", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.639695197863172*^9, 3.6396952047707233`*^9}}],

Cell[CellGroupData[{

Cell["Building and extracting data from a SpiderAnalysis", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{{3.6420616710800867`*^9, 3.642061684673987*^9}}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "buildSpiderAnalysis", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"buildSpiderAnalysis", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"spider_", "?", "JavaObjectQ"}], "/;", 
     RowBox[{"InstanceOf", "[", 
      RowBox[{
      "spider", ",", 
       "\"\<net.tqft.toolkit.algebra.spiders.examples.QuotientSpider\>\""}], 
      "]"}]}], ",", "\[IndentingNewLine]", "manifold_Manifold", ",", 
    "\[IndentingNewLine]", 
    RowBox[{"dimensionBounds", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"_Integer", ",", 
         RowBox[{"_Integer", "|", "\[Infinity]"}]}], "}"}], ".."}], "}"}]}], 
    ",", "\[IndentingNewLine]", 
    RowBox[{"independentDiagrams", ":", 
     RowBox[{"{", 
      RowBox[{"Diagram", "..."}], "}"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"dependentDiagrams", ":", 
     RowBox[{"{", 
      RowBox[{"Diagram", "..."}], "}"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"closedDiagrams", ":", 
     RowBox[{"{", 
      RowBox[{"Diagram", "..."}], "}"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"spanningSets", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"Diagram", "..."}], "}"}], "..."}], "}"}], "..."}], "}"}]}],
     ",", "\[IndentingNewLine]", 
    RowBox[{"reducingRelations", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"Diagram", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"Diagram", "\[Rule]", "_"}], ")"}], "..."}], "}"}]}], 
        ")"}], "..."}], "}"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{"nonReducingRelations", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"Diagram", "\[Rule]", "_"}], ")"}], ".."}], "}"}], "..."}], 
      "}"}]}]}], "]"}], ":=", 
  RowBox[{"SpiderAnalysis", "[", 
   RowBox[{
   "spider", ",", "manifold", ",", "dimensionBounds", ",", 
    "independentDiagrams", ",", "dependentDiagrams", ",", "closedDiagrams", 
    ",", "spanningSets", ",", "reducingRelations", ",", 
    "nonReducingRelations"}], "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.620686834670459*^9, 3.620686885654628*^9}, {
  3.6206869327631817`*^9, 3.6206869404999533`*^9}, {3.620686978831314*^9, 
  3.6206869819675417`*^9}, {3.620687016059319*^9, 3.620687258507056*^9}, {
  3.621070286747486*^9, 3.6210703001813507`*^9}, {3.621210406533744*^9, 
  3.6212105438578167`*^9}, {3.6212204884690657`*^9, 3.6212205000619917`*^9}, {
  3.621220609217463*^9, 3.621220623567325*^9}, {3.621896929150733*^9, 
  3.6218969381322117`*^9}, {3.641178876989626*^9, 3.641178889140676*^9}, {
  3.64118031520989*^9, 3.641180316527817*^9}, {3.641439434811636*^9, 
  3.641439479391198*^9}, {3.642060774763947*^9, 3.642060805841406*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Format", "[", 
   RowBox[{"SpiderAnalysis", "[", 
    RowBox[{
    "spider_", ",", "manifold_", ",", "dimensionBounds_", ",", 
     "independentDiagrams_", ",", "dependentDiagrams_", ",", 
     "closedDiagrams_", ",", "spanningSets_", ",", "reducingRelations_", ",", 
     "nonReducingRelations_"}], "]"}], "]"}], ":=", 
  RowBox[{"\"\<SpiderAnalysis\>\"", "[", 
   RowBox[{"spider", ",", "manifold", ",", "dimensionBounds", ",", 
    RowBox[{"Short", "[", "independentDiagrams", "]"}], ",", 
    RowBox[{"Short", "[", "dependentDiagrams", "]"}], ",", 
    RowBox[{"Short", "[", "closedDiagrams", "]"}], ",", "spanningSets", ",", 
    RowBox[{"Short", "[", "reducingRelations", "]"}], ",", 
    RowBox[{"Short", "[", "nonReducingRelations", "]"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641162400431046*^9, 3.641162490909869*^9}, {
   3.641162568559248*^9, 3.6411625879604263`*^9}, {3.6411788997450523`*^9, 
   3.641178913303793*^9}, {3.641439483326119*^9, 3.641439493109063*^9}, {
   3.643453791756742*^9, 3.643453795745912*^9}, 3.6434667963596077`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"DimensionBounds", "[", "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{
  "s", "\[LeftDoubleBracket]", "3", 
   "\[RightDoubleBracket]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DimensionBounds", "[", 
   RowBox[{"s_SpiderAnalysis", ",", "k_Integer"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"bounds", "=", 
      RowBox[{"DimensionBounds", "[", "s", "]"}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", "bounds", "]"}], "<", 
       RowBox[{"k", "+", "1"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "\[Infinity]"}], "}"}], ",", 
      RowBox[{"bounds", "\[LeftDoubleBracket]", 
       RowBox[{"k", "+", "1"}], "\[RightDoubleBracket]"}]}], "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6212212012145653`*^9, 3.621221208168165*^9}, {
   3.622184436132186*^9, 3.622184443508594*^9}, 3.622184553907645*^9, {
   3.641366922283182*^9, 3.641366974055118*^9}, {3.642060798428671*^9, 
   3.642060800000527*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"DimensionLowerBound", "[", 
   RowBox[{"s_SpiderAnalysis", ",", "k_Integer"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"DimensionBounds", "[", 
    RowBox[{"s", ",", "k"}], "]"}], "\[LeftDoubleBracket]", "1", 
   "\[RightDoubleBracket]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DimensionUpperBound", "[", 
   RowBox[{"s_SpiderAnalysis", ",", "k_Integer"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"DimensionBounds", "[", 
    RowBox[{"s", ",", "k"}], "]"}], "\[LeftDoubleBracket]", "2", 
   "\[RightDoubleBracket]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.64206082581147*^9, 3.642060850637065*^9}, {
  3.6420733791757*^9, 3.642073380518743*^9}, {3.6433646518694267`*^9, 
  3.643364651953484*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"IndependentDiagrams", "[", "k_Integer", "]"}], "[", 
   "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"Cases", "[", 
   RowBox[{
    RowBox[{"s", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], ",", 
    
    RowBox[{"d_", "/;", 
     RowBox[{
      RowBox[{"d", "@", 
       RowBox[{"numberOfBoundaryPoints", "[", "]"}]}], "\[Equal]", "k"}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DependentDiagrams", "[", "k_Integer", "]"}], "[", 
   "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"Cases", "[", 
   RowBox[{
    RowBox[{"s", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}], ",", 
    
    RowBox[{"d_", "/;", 
     RowBox[{
      RowBox[{"d", "@", 
       RowBox[{"numberOfBoundaryPoints", "[", "]"}]}], "\[Equal]", "k"}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SpanningSets", "[", "k_Integer", "]"}], "[", "s_SpiderAnalysis", 
   "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"s", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}], 
      "]"}], "<", 
     RowBox[{"k", "+", "1"}]}], ",", 
    RowBox[{"{", "}"}], ",", 
    RowBox[{"s", "\[LeftDoubleBracket]", 
     RowBox[{"7", ",", 
      RowBox[{"k", "+", "1"}]}], "\[RightDoubleBracket]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ReducingRelations", "[", "k_Integer", "]"}], "[", 
   "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"Cases", "[", 
   RowBox[{
    RowBox[{"s", "\[LeftDoubleBracket]", "8", "\[RightDoubleBracket]"}], ",", 
    
    RowBox[{"l_", "/;", 
     RowBox[{
      RowBox[{
       RowBox[{"l", "\[LeftDoubleBracket]", 
        RowBox[{"2", ",", "1", ",", "2"}], "\[RightDoubleBracket]"}], "@", 
       RowBox[{"numberOfBoundaryPoints", "[", "]"}]}], "\[Equal]", "k"}]}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ReducibleDiagrams", "[", "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"s", "\[LeftDoubleBracket]", 
   RowBox[{"8", ",", "All", ",", "2", ",", 
    RowBox[{"-", "1"}], ",", "2"}], 
   "\[RightDoubleBracket]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NonReducingRelations", "[", "k_Integer", "]"}], "[", 
   "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"Cases", "[", 
   RowBox[{
    RowBox[{"s", "\[LeftDoubleBracket]", "9", "\[RightDoubleBracket]"}], ",", 
    
    RowBox[{"l_", "/;", 
     RowBox[{
      RowBox[{
       RowBox[{"l", "\[LeftDoubleBracket]", 
        RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "@", 
       RowBox[{"numberOfBoundaryPoints", "[", "]"}]}], "\[Equal]", "k"}]}]}], 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6212103481196213`*^9, 3.621210387249819*^9}, {
  3.621210659203514*^9, 3.621210674508813*^9}, {3.621211458007388*^9, 
  3.621211530189834*^9}, {3.6212205099114103`*^9, 3.621220519183495*^9}, {
  3.621896942517138*^9, 3.621896956005661*^9}, {3.622184445838972*^9, 
  3.6221844821591883`*^9}, {3.641069926301072*^9, 3.641069926364765*^9}, {
  3.641178922048482*^9, 3.641178937833606*^9}, {3.6412667403301487`*^9, 
  3.641266747381023*^9}, {3.641273156614704*^9, 3.641273156664398*^9}, {
  3.6412761806693087`*^9, 3.6412761807396297`*^9}, {3.641439509627509*^9, 
  3.6414395122234364`*^9}, {3.6414406709126167`*^9, 3.64144071347766*^9}, {
  3.664006526919808*^9, 3.664006538894577*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"AppendIndependentDiagram", "[", 
    RowBox[{"d0", ":", "Diagram"}], "]"}], "[", "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"ReplacePart", "[", 
   RowBox[{"s", ",", 
    RowBox[{"4", "\[Rule]", 
     RowBox[{
      RowBox[{"s", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], 
      "~", "Join", "~", 
      RowBox[{"{", "d0", "}"}]}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621897222582961*^9, 3.621897223069605*^9}, {
  3.622184485155908*^9, 3.622184490056203*^9}, {3.643465981794943*^9, 
  3.643465983891263*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"AppendDependentDiagram", "[", 
    RowBox[{"d0", ":", "Diagram"}], "]"}], "[", "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"ReplacePart", "[", 
   RowBox[{"s", ",", 
    RowBox[{"5", "\[Rule]", 
     RowBox[{
      RowBox[{"s", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}], 
      "~", "Join", "~", 
      RowBox[{"{", "d0", "}"}]}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.621897366618808*^9, {3.622184491577291*^9, 3.622184496225565*^9}, {
   3.643465986053528*^9, 3.643465988585269*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"AppendClosedDiagram", "[", 
    RowBox[{"d0", ":", "Diagram"}], "]"}], "[", "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"ReplacePart", "[", 
   RowBox[{"s", ",", 
    RowBox[{"6", "\[Rule]", 
     RowBox[{"Union", "[", 
      RowBox[{
       RowBox[{"s", "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}], 
       "~", "Join", "~", 
       RowBox[{"{", "d0", "}"}]}], "]"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641178947249943*^9, 3.641178958891428*^9}, {
  3.64120113037647*^9, 3.641201133337631*^9}, {3.643465990928761*^9, 
  3.643465993140265*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"automaticFlatMap", "/@", 
   RowBox[{"{", 
    RowBox[{
    "AppendIndependentDiagram", ",", "AppendDependentDiagram", ",", 
     "AppendClosedDiagram"}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621219070736085*^9, 3.621219089800869*^9}, {
  3.621897976372347*^9, 3.621897978179473*^9}, {3.6221844987651587`*^9, 
  3.622184500613967*^9}, {3.641178964902318*^9, 3.641178965071168*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ReducedDiagrams", "[", 
   RowBox[{
   "s_SpiderAnalysis", ",", "circumference_Integer", ",", 
    "numbersOfVertices___Integer"}], "]"}], ":=", 
  RowBox[{"FromScalaObject", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "@", 
     RowBox[{"reducedDiagrams", "[", 
      RowBox[{"circumference", ",", 
       RowBox[{"AsScalaObject", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Rule", "@@", "#"}], "&"}], "/@", 
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"#", "@", 
               RowBox[{"U1", "[", "]"}]}], "&"}], "/@", 
             RowBox[{"FromScalaObject", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                "s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                "@", 
                RowBox[{"generators", "[", "]"}]}], ",", "1"}], "]"}]}], ",", 
            
            RowBox[{"{", "numbersOfVertices", "}"}]}], "}"}], "]"}]}], 
        "]"}]}], "]"}]}], ",", "1"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621070370472617*^9, 3.6210704289694157`*^9}, {
  3.6210704770022087`*^9, 3.6210704799713783`*^9}, {3.621070511589752*^9, 
  3.621070520817786*^9}, {3.622184864966071*^9, 3.622184890998218*^9}, {
  3.641198326786395*^9, 3.6411983292203207`*^9}, {3.6413538021279917`*^9, 
  3.641353869500469*^9}, {3.641353908343898*^9, 3.6413539125724297`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"TrivalentQ", "[", "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "@", 
     RowBox[{
      RowBox[{"generators", "[", "]"}], "@", 
      RowBox[{"size", "[", "]"}]}]}], "\[Equal]", "1"}], "\[And]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"FromScalaObject", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
         "@", 
         RowBox[{"generators", "[", "]"}]}], ",", "1"}], "]"}], 
      "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "@", 
     RowBox[{
      RowBox[{"U1", "[", "]"}], "@", 
      RowBox[{"perimeter", "[", "]"}]}]}], "\[Equal]", "3"}], "\[And]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"FromScalaObject", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
         "@", 
         RowBox[{"generators", "[", "]"}]}], ",", "1"}], "]"}], 
      "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "@", 
     RowBox[{
      RowBox[{"U1", "[", "]"}], "@", 
      RowBox[{"allowedRotationStep", "[", "]"}]}]}], "\[Equal]", 
    "1"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.664006188287574*^9, 3.664006289650642*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ReducedDiagrams", "[", 
    RowBox[{
    "s_SpiderAnalysis", ",", "circumference_Integer", ",", 
     "numberOfVertices_Integer"}], "]"}], "/;", 
   RowBox[{"TrivalentQ", "[", "s", "]"}]}], ":=", "\[IndentingNewLine]", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"OddQ", "[", 
     RowBox[{"numberOfVertices", "-", "circumference"}], "]"}], ",", 
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"withFaces", ",", 
        RowBox[{"result", "=", 
         RowBox[{"{", "}"}]}], ",", "f"}], "}"}], ",", "\[IndentingNewLine]", 
      
      RowBox[{
       RowBox[{
        RowBox[{"withFaces", "[", "n_", "]"}], ":=", 
        RowBox[{
         RowBox[{"withFaces", "[", "n", "]"}], "=", "\[IndentingNewLine]", 
         RowBox[{"Cases", "[", 
          RowBox[{
           RowBox[{"FromScalaObject", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
              "ScalaSingleton", "[", 
               "\"\<net.tqft.toolkit.algebra.spiders.\
BoundaryConnectedPlanarGraphs\>\"", "]"}], "@", 
              RowBox[{
               RowBox[{"apply", "[", 
                RowBox[{"circumference", ",", "n", ",", 
                 RowBox[{"Spiders`Private`AsScalaList", "[", 
                  RowBox[{"ReducibleDiagrams", "[", "s", "]"}], "]"}]}], 
                "]"}], "@", 
               RowBox[{"toList", "[", "]"}]}]}], ",", "1"}], "]"}], ",", 
           RowBox[{"d_", "/;", 
            RowBox[{
             RowBox[{"d", "@", 
              RowBox[{"numberOfInternalVertices", "[", "]"}]}], "\[Equal]", 
             "numberOfVertices"}]}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"f", "=", 
        RowBox[{"Max", "[", 
         RowBox[{
          RowBox[{"1", "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"numberOfVertices", "-", "circumference"}], ")"}], "/", 
            "2"}]}], ",", "0"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"While", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"withFaces", "[", "f", "]"}], "]"}], ">", "0"}], ",", 
         RowBox[{
          RowBox[{"result", "=", 
           RowBox[{"result", "~", "Join", "~", 
            RowBox[{"withFaces", "[", "f", "]"}]}]}], ";", 
          RowBox[{"f", "++"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
       "result"}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621070370472617*^9, 3.6210704289694157`*^9}, {
   3.6210704770022087`*^9, 3.6210704799713783`*^9}, {3.621070511589752*^9, 
   3.621070520817786*^9}, {3.622184864966071*^9, 3.622184890998218*^9}, {
   3.641198326786395*^9, 3.6411983292203207`*^9}, {3.6413538021279917`*^9, 
   3.641353869500469*^9}, {3.641353908343898*^9, 3.6413539125724297`*^9}, {
   3.664006317010301*^9, 3.6640063249007463`*^9}, {3.664006592905079*^9, 
   3.664006672304*^9}, {3.664006772110846*^9, 3.664006772826947*^9}, {
   3.664006836053131*^9, 3.664006860040415*^9}, {3.664007562926014*^9, 
   3.66400770789575*^9}, 3.664008098373197*^9}],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
  "TODO", " ", "add", " ", "support", " ", "for", " ", "declaring", " ", 
   "dimension", " ", "bounds", " ", 
   RowBox[{"\"\<after the fact\>\"", "?"}]}], " ", "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.64206460510955*^9, 3.642064620929387*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DeclareDimensionBounds", "[", 
    RowBox[{"bounds", ":", 
     RowBox[{"{", "__Integer", "}"}]}], "]"}], "[", "s_SpiderAnalysis", "]"}],
   ":=", 
  RowBox[{
   RowBox[{"DeclareDimensionBounds", "[", 
    RowBox[{"ReplacePart", "[", 
     RowBox[{
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{"bounds", ",", "bounds"}], "}"}], "]"}], ",", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "}"}], "\[Rule]", "0"}]}], "]"}], 
    "]"}], "[", "s", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DeclareDimensionBounds", "[", 
    RowBox[{"bounds", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"_Integer", ",", 
         RowBox[{"_Integer", "|", "\[Infinity]"}]}], "}"}], ".."}], "}"}]}], 
    "]"}], "[", "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"ReplacePart", "[", 
   RowBox[{"s", ",", 
    RowBox[{"3", "\[Rule]", "bounds"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DeclareDimensionBounds", "[", "bounds_", "]"}], "[", "S_List", 
   "]"}], ":=", 
  RowBox[{
   RowBox[{"DeclareDimensionBounds", "[", "bounds", "]"}], "/@", 
   "S"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641353481754798*^9, 3.6413535344570312`*^9}, {
  3.642060946191695*^9, 3.6420610485223227`*^9}, {3.6420732616951437`*^9, 
  3.642073270729051*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"FreeSpider", "[", 
   RowBox[{"vertices", ":", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"_Integer", ",", " ", "_Integer", ",", "_Integer", ",", "_"}], 
       "}"}], "..."}], "}"}]}], "]"}], ":=", 
  RowBox[{"ScalaCaseClass", "[", 
   RowBox[{
   "\"\<net.tqft.toolkit.algebra.spiders.examples.QuotientSpider\>\"", ",", 
    RowBox[{
     RowBox[{"AsScalaObject", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"ScalaCaseClass", "[", 
          RowBox[{
          "\"\<net.tqft.toolkit.algebra.spiders.VertexType\>\"", ",", 
           RowBox[{
           "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
           RowBox[{
           "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",", 
           RowBox[{
           "#", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
          "]"}], "\[Rule]", 
         RowBox[{"AsScalaObject", "[", 
          RowBox[{
           RowBox[{
           "#", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], ",", 
           "\"\<MultivariableRationalFunction\>\""}], "]"}]}], "&"}], "/@", 
       "vertices"}], "]"}], "@", 
     RowBox[{"toSeq", "[", "]"}]}], ",", 
    RowBox[{"AsScalaList", "[", 
     RowBox[{"{", "}"}], "]"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641353271080328*^9, 3.641353398569433*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"emptySpiderAnalysis", "[", 
   RowBox[{"spider_", ",", "variables_"}], "]"}], ":=", 
  RowBox[{"buildSpiderAnalysis", "[", 
   RowBox[{"spider", ",", 
    RowBox[{"Manifold", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", 
      RowBox[{"{", "}"}], ",", 
      RowBox[{"{", "}"}], ",", 
      RowBox[{"{", "}"}], ",", "variables"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}]}], "}"}], ",", 
    RowBox[{"{", "}"}], ",", 
    RowBox[{"{", "}"}], ",", 
    RowBox[{"{", "}"}], ",", 
    RowBox[{"{", "}"}], ",", 
    RowBox[{"{", "}"}], ",", 
    RowBox[{"{", "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641353542016638*^9, 3.6413535944180737`*^9}, {
  3.6414422527944307`*^9, 3.6414422540957336`*^9}, {3.642061059459014*^9, 
  3.642061067947188*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Diagram weights", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{{3.64206177475005*^9, 3.6420617794057417`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"internalValences", "[", "diagram_", "]"}], ":=", 
  RowBox[{"Length", "/@", 
   RowBox[{"FromScalaObject", "[", 
    RowBox[{"diagram", "@", 
     RowBox[{
      RowBox[{"vertexFlags", "[", "]"}], "@", 
      RowBox[{"tail", "[", "]"}]}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641154146418594*^9, 3.641154166036174*^9}}],

Cell[BoxData[
 RowBox[{"If", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"DownValues", "[", "diagramWeight", "]"}], "]"}], "\[Equal]", 
    "0"}], ",", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"diagramWeight", "[", "diagram_", "]"}], ":=", 
    RowBox[{
     RowBox[{"Count", "[", 
      RowBox[{
       RowBox[{"internalValences", "[", "diagram", "]"}], ",", "3"}], "]"}], 
     "+", 
     RowBox[{"4", 
      RowBox[{"Count", "[", 
       RowBox[{
        RowBox[{"internalValences", "[", "diagram", "]"}], ",", "4"}], 
       "]"}]}]}]}]}], "\[IndentingNewLine]", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641154169376309*^9, 3.641154195909103*^9}, {
  3.664665425538183*^9, 3.66466544135005*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Closed diagrams", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{{3.642061691271805*^9, 3.6420616960839252`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"EvaluateDiagram", "[", "s_SpiderAnalysis", "]"}], "[", 
   RowBox[{"d0", ":", "Diagram"}], "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"DrawPlanarGraph", "[", 
      RowBox[{"#", "@", 
       RowBox[{"U1", "[", "]"}]}], "]"}], "\[Rule]", 
     RowBox[{
      RowBox[{"ReducePolynomials", "[", "s", "]"}], "[", 
      RowBox[{"FromScalaObject", "[", 
       RowBox[{"#", "@", 
        RowBox[{"U2", "[", "]"}]}], "]"}], "]"}]}], "&"}], "/@", 
   RowBox[{"FromScalaObject", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"s", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "@", 
      RowBox[{"canonicalForm", "[", 
       RowBox[{"AsScalaMap", "[", 
        RowBox[{"{", 
         RowBox[{"d0", "\[Rule]", 
          RowBox[{"AsScalaObject", "[", 
           RowBox[{"1", ",", "\"\<MultivariableRationalFunction\>\""}], 
           "]"}]}], "}"}], "]"}], "]"}]}], ",", "1"}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6415256004819613`*^9, 3.641525610453802*^9}, {
  3.643466001424953*^9, 3.643466005112973*^9}, {3.6435535527306223`*^9, 
  3.643553558982684*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"EvaluateClosedDiagram", "[", "s_SpiderAnalysis", "]"}], "[", 
   RowBox[{"d0", ":", "Diagram"}], "]"}], ":=", 
  RowBox[{
   RowBox[{"ReducePolynomials", "[", "s", "]"}], "[", 
   RowBox[{"FromScalaObject", "[", 
    RowBox[{
     RowBox[{"s", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "@", 
     RowBox[{"evaluate", "[", 
      RowBox[{
       RowBox[{"s", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "@", 
       RowBox[{"canonicalForm", "[", 
        RowBox[{"AsScalaMap", "[", 
         RowBox[{"{", 
          RowBox[{"d0", "\[Rule]", 
           RowBox[{"AsScalaObject", "[", 
            RowBox[{"1", ",", "\"\<MultivariableRationalFunction\>\""}], 
            "]"}]}], "}"}], "]"}], "]"}]}], "]"}]}], "]"}], "]"}]}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.643553114249529*^9, 3.6435531874992933`*^9}, {
   3.643554931025827*^9, 3.643554959046357*^9}, {3.643628491318242*^9, 
   3.6436285199908123`*^9}, 3.643628714091057*^9, {3.643629461347314*^9, 
   3.643629474695519*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ClosedDiagrams", "[", "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{
  "s", "\[LeftDoubleBracket]", "6", "\[RightDoubleBracket]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6411796130717163`*^9, 3.641179623499236*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ConsiderClosedDiagram", "[", 
   RowBox[{"d0", ":", 
    SubscriptBox["p", "_"]}], "]"}], ":=", 
  RowBox[{"ConsiderClosedDiagram", "[", 
   RowBox[{"NamedPolyhedron", "[", "d0", "]"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ConsiderClosedDiagram", "[", 
    RowBox[{"d0", ":", "Diagram"}], "]"}], "[", "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "evaluations", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"MemberQ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"#", "@", 
           RowBox[{"hashCode", "[", "]"}]}], "&"}], "/@", 
         RowBox[{"ClosedDiagrams", "[", "s", "]"}]}], ",", 
        RowBox[{"d0", "@", 
         RowBox[{"hashCode", "[", "]"}]}]}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", "s", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Print", "[", 
        RowBox[{"\"\<Considering a new closed diagram: \>\"", ",", 
         RowBox[{"DrawPlanarGraph", "[", "d0", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{
         RowBox[{"s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
         "@", 
         RowBox[{
          RowBox[{"evaluate", "[", 
           RowBox[{"AsScalaObject", "[", 
            RowBox[{"{", 
             RowBox[{"d0", "\[Rule]", 
              RowBox[{"Ring", "@", 
               RowBox[{"one", "[", "]"}]}]}], "}"}], "]"}], "]"}], "@", 
          RowBox[{"toString", "[", "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"evaluations", "=", 
        RowBox[{"FromScalaObject", "[", 
         RowBox[{
          RowBox[{"s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
           "@", 
          RowBox[{
           RowBox[{"allOneStepEvaluations", "[", "d0", "]"}], "@", 
           RowBox[{"toSeq", "[", "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{
        "\"\<evaluations, before reducing: \>\"", ",", "evaluations"}], "]"}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"evaluations", "=", 
        RowBox[{
         RowBox[{"ReducePolynomials", "[", "s", "]"}], "[", "evaluations", 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<evaluations, after reducing: \>\"", ",", "evaluations"}],
         "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", "\"\<Finished evaluating ...\>\"", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"DeclarePolynomialsZero", "[", 
         RowBox[{"DeleteCases", "[", 
          RowBox[{
           RowBox[{"Union", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Last", "[", "evaluations", "]"}], "-", "#"}], "&"}], "/@", 
             RowBox[{"Most", "[", "evaluations", "]"}]}], "]"}], ",", "0"}], 
          "]"}], "]"}], "[", 
        RowBox[{
         RowBox[{"ConsiderClosedDiagrams", "[", 
          RowBox[{"NamedPolyhedron", "/@", 
           RowBox[{"Union", "[", 
            RowBox[{"Cases", "[", 
             RowBox[{"evaluations", ",", 
              SubscriptBox["p", "_Integer"], ",", "\[Infinity]"}], "]"}], 
            "]"}]}], "]"}], "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"AppendClosedDiagram", "[", "d0", "]"}], "[", "s", "]"}], 
         "]"}], "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641178974545657*^9, 3.64117899791991*^9}, {
   3.64117902960489*^9, 3.641179040437148*^9}, {3.641179072273327*^9, 
   3.641179125128031*^9}, 3.6411803499108267`*^9, {3.641195999257172*^9, 
   3.641196061334652*^9}, {3.641202153269003*^9, 3.641202155278995*^9}, {
   3.641202271237156*^9, 3.6412022785063887`*^9}, 3.641204492925438*^9, {
   3.6412412090638*^9, 3.641241213996421*^9}, {3.641241285083352*^9, 
   3.641241302375154*^9}, {3.6412413325617228`*^9, 3.641241409792935*^9}, {
   3.6412427762556057`*^9, 3.6412428015002117`*^9}, {3.6412432785062428`*^9, 
   3.641243323892797*^9}, {3.6412436921324863`*^9, 3.641243694947925*^9}, {
   3.641243732668126*^9, 3.64124373856813*^9}, {3.641245943281187*^9, 
   3.6412459463559513`*^9}, {3.641246208374288*^9, 3.641246240652833*^9}, {
   3.641246353764984*^9, 3.6412463595356493`*^9}, {3.641247302908757*^9, 
   3.641247306746957*^9}, {3.6412586230188828`*^9, 3.6412586530917807`*^9}, {
   3.641259517341943*^9, 3.64125952156278*^9}, {3.643466012562915*^9, 
   3.643466031049287*^9}, {3.646204078005492*^9, 3.646204086417631*^9}, {
   3.646205979873363*^9, 3.6462060153624153`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ConsiderClosedDiagrams", "[", "diagrams_List", "]"}], "[", 
   "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"Fold", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"ConsiderClosedDiagram", "[", "#2", "]"}], "[", "#1", "]"}], 
     "&"}], ",", 
    RowBox[{"{", "s", "}"}], ",", "diagrams"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6411799163361683`*^9, 3.641179940950986*^9}, {
  3.646206019458063*^9, 3.646206020288433*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Spanning sets and bases", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{{3.64206170803734*^9, 3.642061712135041*^9}, {
  3.643604826645846*^9, 3.643604827871109*^9}}],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Clear", "[", "cachedInnerProduct", "]"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"cachedInnerProduct", "[", 
     RowBox[{"spiderHash_", ",", "x_String", ",", "y_String"}], "]"}], ":=", 
    "$Failed"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.64608916379377*^9, 3.646089182196916*^9}, 
   3.646089524941811*^9, {3.6644946038899927`*^9, 3.66449460902673*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"rotationFactor", "[", 
   RowBox[{"s_SpiderAnalysis", ",", 
    RowBox[{"rotations", ":", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"_Integer", ",", "_Integer"}], "}"}], "..."}], "}"}]}]}], 
   "]"}], ":=", 
  RowBox[{"Times", "@@", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"rotationFactor", "[", 
       RowBox[{"s", ",", "#"}], "]"}], "&"}], "/@", "rotations"}], 
    ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rotationFactor", "[", 
   RowBox[{"s_SpiderAnalysis", ",", 
    RowBox[{"rotation", ":", 
     RowBox[{"{", 
      RowBox[{"p_Integer", ",", "c_Integer"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "vertices", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"vertices", "=", 
      RowBox[{"Cases", "[", 
       RowBox[{
        RowBox[{"FromScalaObject", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
           "s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "@", 
           RowBox[{"generators", "[", "]"}]}], ",", "2"}], "]"}], ",", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"v_", ",", "w_"}], "}"}], "/;", 
           RowBox[{
            RowBox[{"v", "@", 
             RowBox[{"perimeter", "[", "]"}]}], "\[Equal]", "p"}]}], ")"}], 
         "\[RuleDelayed]", 
         RowBox[{"FromScalaObject", "[", "w", "]"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "vertices", "]"}], "\[NotEqual]", "1"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
        "Print", "[", 
         "\"\<Ask Scott to go implement rotations properly; for now you can't \
have two vertices with the same valence, but different eigenvalues.\>\"", 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Abort", "[", "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", 
     SuperscriptBox[
      RowBox[{
      "vertices", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
      "c"]}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.667358811231728*^9, 3.667359040575733*^9}, {
  3.667359151443626*^9, 3.667359161282681*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"cachingInnerProduct", "[", 
   RowBox[{"spider_SpiderAnalysis", ",", 
    RowBox[{"x", ":", "Diagram"}], ",", 
    RowBox[{"y", ":", "Diagram"}]}], "]"}], ":=", 
  RowBox[{"cachingInnerProduct", "[", 
   RowBox[{"spider", ",", 
    RowBox[{"x", "@", 
     RowBox[{"toString", "[", "]"}]}], ",", 
    RowBox[{"y", "@", 
     RowBox[{"toString", "[", "]"}]}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cachingInnerProduct", "[", 
   RowBox[{"s_SpiderAnalysis", ",", "x_String", ",", "y_String"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "xs", ",", "ys", ",", "outerHash", ",", "innerHash", ",", "result"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"outerHash", "=", 
      RowBox[{"Hash", "[", "s", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"innerHash", "=", 
      RowBox[{
       RowBox[{"s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
       "@", 
       RowBox[{"hashCode", "[", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"result", "=", 
      RowBox[{"cachedInnerProduct", "[", 
       RowBox[{"outerHash", ",", "x", ",", "y"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"result", "===", "$Failed"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"result", "=", 
         RowBox[{"cachedInnerProduct", "[", 
          RowBox[{"innerHash", ",", "x", ",", "y"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"result", "===", "$Failed"}], ",", "\[IndentingNewLine]", 
          RowBox[{"result", "=", 
           RowBox[{
            RowBox[{"cachedInnerProduct", "[", 
             RowBox[{"innerHash", ",", "x", ",", "y"}], "]"}], "=", 
            "\[IndentingNewLine]", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", "ip", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"ip", "=", 
                RowBox[{"PlanarGraphs", "@", 
                 RowBox[{
                  RowBox[{"spider", "[", "]"}], "@", 
                  RowBox[{
                   RowBox[{"innerProduct", "[", 
                    RowBox[{
                    RowBox[{"PlanarGraphs", "@", 
                    RowBox[{"fromString", "[", "x", "]"}]}], ",", 
                    RowBox[{"PlanarGraphs", "@", 
                    RowBox[{"fromString", "[", "y", "]"}]}]}], "]"}], "@", 
                   RowBox[{"canonicalFormWithDefect", "[", "]"}]}]}]}]}], ";",
                "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"rotationFactor", "[", 
                 RowBox[{"s", ",", 
                  RowBox[{"FromScalaObject", "[", 
                   RowBox[{"ip", "@", 
                    RowBox[{
                    RowBox[{"U2", "[", "]"}], "@", 
                    RowBox[{"vertexRotations", "[", "]"}]}]}], "]"}]}], "]"}], 
                RowBox[{"cachingEvaluation", "[", 
                 RowBox[{
                  RowBox[{
                  "s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
                   ",", 
                  RowBox[{"ip", "@", 
                   RowBox[{"U1", "[", "]"}]}]}], "]"}]}]}]}], 
             "\[IndentingNewLine]", "]"}]}]}]}], "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
            RowBox[{"FromScalaObject", "[", 
             RowBox[{
              RowBox[{
              "spider", "\[LeftDoubleBracket]", "1", 
               "\[RightDoubleBracket]"}], "@", 
              RowBox[{"innerProductMatrix", "[", 
               RowBox[{
                RowBox[{"Spiders`Private`AsScalaList", "[", 
                 RowBox[{"{", 
                  RowBox[{"PlanarGraphs", "@", 
                   RowBox[{"fromString", "[", "x", "]"}]}], "}"}], "]"}], ",", 
                RowBox[{"Spiders`Private`AsScalaList", "[", 
                 RowBox[{"{", 
                  RowBox[{"PlanarGraphs", "@", 
                   RowBox[{"fromString", "[", "y", "]"}]}], "}"}], "]"}]}], 
               "]"}]}], "]"}], "\[LeftDoubleBracket]", 
            RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}], ";"}], "*)"}],
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"result", "=", 
         RowBox[{
          RowBox[{"cachedInnerProduct", "[", 
           RowBox[{"outerHash", ",", "x", ",", "y"}], "]"}], "=", 
          RowBox[{
           RowBox[{"ReducePolynomials", "[", "s", "]"}], "[", "result", 
           "]"}]}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
     "\[IndentingNewLine]", "result"}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.646089126903282*^9, 3.646089316180543*^9}, {
   3.646089376378997*^9, 3.6460894770418158`*^9}, {3.646089660568536*^9, 
   3.6460897218269367`*^9}, {3.646089845040655*^9, 3.646089866092558*^9}, {
   3.646089900597015*^9, 3.6460899016214657`*^9}, {3.6460899410507593`*^9, 
   3.6460899474975967`*^9}, {3.6460902787350397`*^9, 3.64609028418943*^9}, {
   3.646091448197567*^9, 3.646091593040936*^9}, {3.646091640361519*^9, 
   3.64609165620229*^9}, {3.64609174530019*^9, 3.646091760003356*^9}, 
   3.64609180280296*^9, {3.6460920619461393`*^9, 3.646092089125104*^9}, 
   3.64609217535069*^9, {3.6460922134188433`*^9, 3.64609237763675*^9}, {
   3.646092454460243*^9, 3.646092522840252*^9}, {3.646092696117239*^9, 
   3.6460927064846773`*^9}, {3.646092741556252*^9, 3.64609274799371*^9}, {
   3.667357989508255*^9, 3.667358043472868*^9}, {3.6673586066336613`*^9, 
   3.667358626082583*^9}, {3.667358717335519*^9, 3.667358723113585*^9}, {
   3.667358760450142*^9, 3.667358771148069*^9}, {3.6673590569546137`*^9, 
   3.6673590832517557`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"cachedEvaluation", "[", 
   RowBox[{"hash_", ",", "xs_String"}], "]"}], ":=", 
  "$Failed"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cachingEvaluation", "[", 
   RowBox[{
    RowBox[{"spider_", "?", "JavaObjectQ"}], ",", 
    RowBox[{"x", ":", "Diagram"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"hash", ",", "result", ",", "xs"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"xs", "=", 
      RowBox[{"x", "@", 
       RowBox[{"toString", "[", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"hash", "=", 
      RowBox[{"spider", "@", 
       RowBox[{"hashCode", "[", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"result", "=", 
      RowBox[{"cachedEvaluation", "[", 
       RowBox[{"hash", ",", "xs"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"result", "===", "$Failed"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"result", "=", 
         RowBox[{
          RowBox[{"cachedEvaluation", "[", 
           RowBox[{"hash", ",", "xs"}], "]"}], "=", 
          RowBox[{"FromScalaObject", "[", 
           RowBox[{"spider", "@", 
            RowBox[{"evaluate", "[", 
             RowBox[{"spider", "@", 
              RowBox[{"replaceRepeatedly", "[", 
               RowBox[{
                RowBox[{"spider", "@", 
                 RowBox[{"reductions", "[", "]"}]}], ",", 
                RowBox[{"AsScalaMap", "[", 
                 RowBox[{"{", 
                  RowBox[{"x", "\[Rule]", 
                   RowBox[{"AsScalaObject", "[", 
                    RowBox[{
                    "1", ",", "\"\<MultivariableRationalFunction\>\""}], 
                    "]"}]}], "}"}], "]"}]}], "]"}]}], "]"}]}], "]"}]}]}], 
        ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     "result"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.646089126903282*^9, 3.646089316180543*^9}, {
   3.646089376378997*^9, 3.6460894770418158`*^9}, {3.646089660568536*^9, 
   3.6460897218269367`*^9}, {3.646089845040655*^9, 3.646089866092558*^9}, {
   3.646089900597015*^9, 3.6460899016214657`*^9}, {3.6460899410507593`*^9, 
   3.6460899474975967`*^9}, {3.6460902787350397`*^9, 3.64609028418943*^9}, {
   3.646091448197567*^9, 3.646091593040936*^9}, {3.646091640361519*^9, 
   3.64609165620229*^9}, {3.64609174530019*^9, 3.646091760003356*^9}, 
   3.64609180280296*^9, {3.6460920619461393`*^9, 3.646092089125104*^9}, 
   3.64609217535069*^9, {3.6460922134188433`*^9, 3.64609242245864*^9}, {
   3.646092568877092*^9, 3.646092569556158*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"cachingInnerProduct", "[", 
   RowBox[{"spider_SpiderAnalysis", ",", "xs_List"}], "]"}], ":=", 
  RowBox[{"cachingInnerProduct", "[", 
   RowBox[{"spider", ",", "xs", ",", "xs"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cachingInnerProduct", "[", 
   RowBox[{"spider_SpiderAnalysis", ",", "xs_List", ",", "ys_List"}], "]"}], ":=", 
  RowBox[{"Outer", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"cachingInnerProduct", "[", 
      RowBox[{"spider", ",", "##"}], "]"}], "&"}], ",", "xs", ",", "ys"}], 
   "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.64608998122433*^9, 3.6460900168708487`*^9}, {
  3.646090515164958*^9, 3.6460905307637663`*^9}}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "ConsiderPotentialSpanningSet", 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ConsiderPotentialSpanningSet", "[", 
    RowBox[{"diagrams", ":", 
     RowBox[{"{", 
      RowBox[{"Diagram", "..."}], "}"}]}], "]"}], ":=", 
   RowBox[{"ConsiderPotentialSpanningSet", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
      "diagrams", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "@", 
      RowBox[{"numberOfBoundaryPoints", "[", "]"}]}], ",", "diagrams"}], 
    "]"}]}], "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"ConsiderPotentialSpanningSet", "[", 
      RowBox[{"k_Integer", ",", 
       RowBox[{"diagrams", ":", 
        RowBox[{"{", 
         RowBox[{"Diagram", "..."}], "}"}]}]}], "]"}], "[", 
     "s_SpiderAnalysis", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "zzz", ",", "innerProducts", ",", "subsets", ",", "det", ",", 
        "determinants"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"s", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}],
           "]"}], "<", 
         RowBox[{"k", "+", "1"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ConsiderPotentialSpanningSet", "[", 
          RowBox[{"k", ",", "diagrams"}], "]"}], "[", 
         RowBox[{"ReplacePart", "[", 
          RowBox[{"s", ",", 
           RowBox[{"7", "\[Rule]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"PadRight", "[", 
               RowBox[{
                RowBox[{
                "s", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}], 
                ",", 
                RowBox[{"k", "+", "1"}], ",", "zzz"}], "]"}], "/.", 
              RowBox[{"zzz", "\[Rule]", 
               RowBox[{"{", "}"}]}]}], ")"}]}]}], "]"}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{
             RowBox[{"SpanningSets", "[", "k", "]"}], "[", "s", "]"}], "]"}], 
           ">", "0"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{
            "\"\<There's already a declared spanning set for \>\"", ",", " ", 
             "k", ",", " ", "\"\< boundary points\>\""}], "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"either", " ", 
               RowBox[{"it", "'"}], "s", " ", "a", " ", "spanning", " ", 
               "set"}], " ", "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"Print", "[", 
                RowBox[{"\"\<Declaring that \>\"", ",", 
                 RowBox[{"DrawPlanarGraph", "/@", "diagrams"}], ",", " ", 
                 "\"\< is a spanning set\>\""}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"ReplacePart", "[", 
                 RowBox[{"s", ",", 
                  RowBox[{"7", "\[Rule]", 
                   RowBox[{"ReplacePart", "[", 
                    RowBox[{
                    RowBox[{
                    "s", "\[LeftDoubleBracket]", "7", 
                    "\[RightDoubleBracket]"}], ",", 
                    RowBox[{
                    RowBox[{"k", "+", "1"}], "\[Rule]", 
                    RowBox[{"{", "diagrams", "}"}]}]}], "]"}]}]}], "]"}], 
                "}"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{"or", " ", 
                RowBox[{"it", "'"}], "s", " ", "not"}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "diagrams", "]"}], "\[GreaterEqual]", 
                 
                 RowBox[{"DimensionUpperBound", "[", 
                  RowBox[{"s", ",", "k"}], "]"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"(*", " ", 
                 RowBox[{"the", " ", "determinant", " ", "must", " ", 
                  RowBox[{"vanish", "!"}]}], " ", "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Print", "[", 
                  RowBox[{"\"\<Declaring that \>\"", ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#", "@", 
                    RowBox[{"toString", "[", "]"}]}], "&"}], "/@", 
                    "diagrams"}], ",", " ", 
                   "\"\< does not span, and hence that its matrix of inner \
products must vanish.\>\""}], "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"innerProducts", "=", 
                  RowBox[{"cachingInnerProduct", "[", 
                   RowBox[{"s", ",", "diagrams"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"subsets", "=", 
                  RowBox[{"Subsets", "[", 
                   RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "diagrams", "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"DimensionUpperBound", "[", 
                    RowBox[{"s", ",", "k"}], "]"}], "}"}]}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"det", "[", 
                   RowBox[{"{", "}"}], "]"}], "=", "1"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"det", "[", "m_", "]"}], ":=", 
                  RowBox[{"delegatingDeterminant", "[", "m", "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"determinants", " ", "=", 
                  RowBox[{"Union", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ReducePolynomials", "[", "s", "]"}], "[", 
                    RowBox[{"det", "[", 
                    RowBox[{"innerProducts", "\[LeftDoubleBracket]", 
                    RowBox[{"#", ",", "#"}], "\[RightDoubleBracket]"}], "]"}],
                     "]"}], "&"}], "/@", "subsets"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Print", "[", 
                  RowBox[{"\"\<determinants: \>\"", ",", "determinants"}], 
                  "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                  "DeclarePolynomialsZero", "[", "determinants", "]"}], "[", 
                  "s", "]"}]}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                 "Print", "[", 
                  "\"\<Be careful: you've proposed a spanning set that isn't \
as big as the dimension bound you're interested in!\>\"", "]"}], ";", 
                 RowBox[{"Abort", "[", "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"{", "s", "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
             "\[IndentingNewLine]", "}"}], ",", "1"}], "]"}]}], 
         "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{"automaticFlatMap", "[", "ConsiderPotentialSpanningSet", 
  "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641440542800742*^9, 3.6414405488464737`*^9}, {
   3.6414405810909452`*^9, 3.641440662515193*^9}, {3.641440731830686*^9, 
   3.6414407470851*^9}, {3.6414407783077507`*^9, 3.6414412852476*^9}, {
   3.641441340607666*^9, 3.641441347907793*^9}, {3.641442308566455*^9, 
   3.6414423087977123`*^9}, 3.641447079033965*^9, {3.641447143079713*^9, 
   3.641447151621131*^9}, {3.641447285500929*^9, 3.641447301089773*^9}, {
   3.6414473764678297`*^9, 3.641447400364243*^9}, {3.64145450940268*^9, 
   3.641454588761601*^9}, {3.6414546296550007`*^9, 3.64145463074872*^9}, {
   3.641457893984871*^9, 3.641457952935821*^9}, {3.64145799103403*^9, 
   3.641458037448512*^9}, {3.6414582762490683`*^9, 3.6414583194227943`*^9}, {
   3.641498183436859*^9, 3.641498183787787*^9}, {3.6420608671107187`*^9, 
   3.64206087800935*^9}, 3.643888989907235*^9, {3.6459549234476423`*^9, 
   3.645954929375243*^9}, {3.646090542570326*^9, 3.646090554543665*^9}, {
   3.664497234316453*^9, 3.6644972460354567`*^9}, 3.664664771270547*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ConsiderPotentialSpanningSet", "[", 
    RowBox[{"k_Integer", ",", 
     RowBox[{"diagrams", ":", 
      RowBox[{"{", 
       RowBox[{"Diagram", "..."}], "}"}]}]}], "]"}], "[", "s_SpiderAnalysis", 
   "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "zzz", ",", "s0", ",", "innerProducts", ",", "subsets", ",", "det", ",", 
      "determinants", ",", "gcd"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{"s", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}], 
        "]"}], "<", 
       RowBox[{"k", "+", "1"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ConsiderPotentialSpanningSet", "[", 
        RowBox[{"k", ",", "diagrams"}], "]"}], "[", 
       RowBox[{"ReplacePart", "[", 
        RowBox[{"s", ",", 
         RowBox[{"7", "\[Rule]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"PadRight", "[", 
             RowBox[{
              RowBox[{
              "s", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}], 
              ",", 
              RowBox[{"k", "+", "1"}], ",", "zzz"}], "]"}], "/.", 
            RowBox[{"zzz", "\[Rule]", 
             RowBox[{"{", "}"}]}]}], ")"}]}]}], "]"}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{
           RowBox[{"SpanningSets", "[", "k", "]"}], "[", "s", "]"}], "]"}], 
         ">", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{
          "\"\<There's already a declared spanning set for \>\"", ",", " ", 
           "k", ",", " ", "\"\< boundary points\>\""}], "]"}], ";", 
         RowBox[{"Abort", "[", "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"innerProducts", "=", 
          RowBox[{"cachingInnerProduct", "[", 
           RowBox[{"s", ",", "diagrams"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"det", "[", 
           RowBox[{"{", "}"}], "]"}], "=", "1"}], ";", "\[IndentingNewLine]", 
         
         RowBox[{
          RowBox[{"det", "[", "m_", "]"}], ":=", 
          RowBox[{"Factor", "[", 
           RowBox[{"delegatingDeterminant", "[", "m", "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{"either", " ", 
              RowBox[{"it", "'"}], "s", " ", "a", " ", "spanning", " ", 
              "set"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\"\<Declaring that \>\"", ",", 
                RowBox[{"DrawPlanarGraph", "/@", "diagrams"}], ",", " ", 
                "\"\< is a spanning set\>\""}], "]"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"s0", "=", 
               RowBox[{"ReplacePart", "[", 
                RowBox[{"s", ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"3", ",", 
                    RowBox[{"k", "+", "1"}], ",", "2"}], "}"}], "\[Rule]", 
                    RowBox[{"Min", "[", 
                    RowBox[{
                    RowBox[{"s", "\[LeftDoubleBracket]", 
                    RowBox[{"3", ",", 
                    RowBox[{"k", "+", "1"}], ",", "2"}], 
                    "\[RightDoubleBracket]"}], ",", 
                    RowBox[{"Length", "[", "diagrams", "]"}]}], "]"}]}], ",", 
                   
                   RowBox[{"7", "\[Rule]", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{
                    RowBox[{
                    "s", "\[LeftDoubleBracket]", "7", 
                    "\[RightDoubleBracket]"}], ",", 
                    RowBox[{
                    RowBox[{"k", "+", "1"}], "\[Rule]", 
                    RowBox[{"{", "diagrams", "}"}]}]}], "]"}]}]}], "}"}]}], 
                "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"s0", "\[LeftDoubleBracket]", 
                  RowBox[{"3", ",", 
                   RowBox[{"k", "+", "1"}], ",", "2"}], 
                  "\[RightDoubleBracket]"}], "<", 
                 RowBox[{"s0", "\[LeftDoubleBracket]", 
                  RowBox[{"3", ",", 
                   RowBox[{"k", "+", "1"}], ",", "1"}], 
                  "\[RightDoubleBracket]"}]}], ",", 
                RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Sum", "[", 
                    RowBox[{
                    RowBox[{"Binomial", "[", 
                    RowBox[{
                    RowBox[{"Length", "[", "diagrams", "]"}], ",", "m"}], 
                    "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"m", ",", 
                    RowBox[{"Range", "@@", 
                    RowBox[{"DimensionBounds", "[", 
                    RowBox[{"s", ",", "k"}], "]"}]}]}], "}"}]}], "]"}], ">", 
                    "20"}], ",", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    "Print", "[", 
                    "\"\<Warning, computing many determinants. Did you forget \
to set a lower bound on the dimension?\>\"", "]"}], ";"}]}], 
                  "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"subsets", "=", 
                  RowBox[{"Subsets", "[", 
                   RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "diagrams", "]"}], "]"}], ",", 
                    RowBox[{"DimensionBounds", "[", 
                    RowBox[{"s", ",", "k"}], "]"}]}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Print", "[", 
                  RowBox[{"\"\<subsets: \>\"", ",", 
                   RowBox[{"Length", "[", "subsets", "]"}]}], "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"determinants", " ", "=", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"ReducePolynomials", "[", "s", "]"}], "[", 
                    RowBox[{"det", "[", 
                    RowBox[{"innerProducts", "\[LeftDoubleBracket]", 
                    RowBox[{"#", ",", "#"}], "\[RightDoubleBracket]"}], "]"}],
                     "]"}], "&"}], "/@", "subsets"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                 "Print", "[", "\"\<calculated determinants\>\"", "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"(*", 
                  RowBox[{
                   RowBox[{"gcd", "=", 
                    RowBox[{"PolynomialGCD", "@@", "determinants"}]}], ";"}], 
                  "*)"}], "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                  "DeclareAtLeastOnePolynomialNonZero", "[", "determinants", 
                   "]"}], "[", "s0", "]"}]}]}], "\[IndentingNewLine]", 
               RowBox[{"(*", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                 "We", " ", "should", " ", "be", " ", "able", " ", "to", " ", 
                  "do", " ", "the", " ", "following"}], ",", " ", 
                 RowBox[{"but", " ", "it", " ", "seems", " ", 
                  RowBox[{"it", "'"}], "s", " ", "too", " ", 
                  RowBox[{"slow", "."}]}]}], "\[IndentingNewLine]", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{";", "\[IndentingNewLine]", 
                 RowBox[{"subsets", "=", 
                  RowBox[{"Subsets", "[", 
                   RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "diagrams", "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"DimensionUpperBound", "[", 
                    RowBox[{"s", ",", "k"}], "]"}], "+", "1"}], "}"}]}], 
                   "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"determinants", " ", "=", 
                  RowBox[{"Union", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ReducePolynomials", "[", "s", "]"}], "[", 
                    RowBox[{"det", "[", 
                    RowBox[{"innerProducts", "\[LeftDoubleBracket]", 
                    RowBox[{"#", ",", "#"}], "\[RightDoubleBracket]"}], "]"}],
                     "]"}], "&"}], "/@", "subsets"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Print", "[", 
                  RowBox[{"\"\<determinants: \>\"", ",", "determinants"}], 
                  "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                  "DeclarePolynomialsZero", "[", "determinants", "]"}], "[", 
                  RowBox[{
                   RowBox[{"DeclarePolynomialNonZero", "[", "gcd", "]"}], "[",
                    "s0", "]"}], "]"}]}], "*)"}], "\[IndentingNewLine]", 
               "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", ",", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"or", " ", 
               RowBox[{"it", "'"}], "s", " ", "not"}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{"determinants", " ", "must", " ", 
               RowBox[{"vanish", "!"}]}], " ", "*)"}], "\[IndentingNewLine]", 
             
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{"\"\<Declaring that \>\"", ",", 
                RowBox[{"DrawPlanarGraph", "/@", "diagrams"}], ",", " ", 
                
                "\"\< does not span, and hence that some determinants of \
inner products must vanish.\>\""}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"subsets", "=", 
               RowBox[{"Subsets", "[", 
                RowBox[{
                 RowBox[{"Range", "[", 
                  RowBox[{"Length", "[", "diagrams", "]"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"DimensionUpperBound", "[", 
                   RowBox[{"s", ",", "k"}], "]"}], "}"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"determinants", " ", "=", 
               RowBox[{"Union", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"ReducePolynomials", "[", "s", "]"}], "[", 
                   RowBox[{"det", "[", 
                    RowBox[{"innerProducts", "\[LeftDoubleBracket]", 
                    RowBox[{"#", ",", "#"}], "\[RightDoubleBracket]"}], "]"}],
                    "]"}], "&"}], "/@", "subsets"}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"Print", "[", 
               RowBox[{"\"\<determinants: \>\"", ",", "determinants"}], "]"}],
               ";", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
               "no", " ", "idea", " ", "what", " ", "this", " ", "next", " ", 
                "line", " ", "was", " ", "here", " ", 
                RowBox[{"for", ":", " ", 
                 RowBox[{"seems", " ", "wrong"}]}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
                RowBox[{"s0", "=", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{
                   RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"DeclarePolynomialZero", "[", 
                    RowBox[{"det", "[", "innerProducts", "]"}], "]"}], "[", 
                    "s", "]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"DeclarePolynomialNonZero", "[", 
                    RowBox[{"det", "[", "innerProducts", "]"}], "]"}], "[", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"s", ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"3", ",", 
                    RowBox[{"k", "+", "1"}], ",", "1"}], "}"}], "\[Rule]", 
                    RowBox[{"Max", "[", 
                    RowBox[{
                    RowBox[{"s", "\[LeftDoubleBracket]", 
                    RowBox[{"3", ",", 
                    RowBox[{"k", "+", "1"}], ",", "1"}], 
                    "\[RightDoubleBracket]"}], ",", 
                    RowBox[{
                    RowBox[{"Length", "[", "diagrams", "]"}], "+", "1"}]}], 
                    "]"}]}]}], "]"}], "]"}]}], "\[IndentingNewLine]", "}"}], 
                   ",", "1"}], "]"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
              
              RowBox[{"s0", "=", 
               RowBox[{
                RowBox[{"DeclarePolynomialsZero", "[", "determinants", "]"}], 
                "[", "s", "]"}]}]}]}], "\[IndentingNewLine]", "}"}], ",", 
           "1"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 InitializationCell->True,
 CellChangeTimes->{
  3.6420648828651447`*^9, {3.642064917989441*^9, 3.6420649408602543`*^9}, {
   3.642065083133215*^9, 3.642065083375593*^9}, {3.6420651473958273`*^9, 
   3.6420652893214073`*^9}, {3.642065419462682*^9, 3.6420654632436543`*^9}, {
   3.642065602333803*^9, 3.6420656435452843`*^9}, {3.6420656889323463`*^9, 
   3.642065706718646*^9}, {3.642065834093706*^9, 3.642065836393227*^9}, {
   3.642065899914844*^9, 3.642065933226019*^9}, {3.642066032202898*^9, 
   3.64206614323563*^9}, {3.642066273123933*^9, 3.642066347469152*^9}, {
   3.642066394691234*^9, 3.6420664146910143`*^9}, {3.642066455650752*^9, 
   3.64206645935807*^9}, {3.642066499395568*^9, 3.6420665294004297`*^9}, {
   3.6420733172161913`*^9, 3.642073319553043*^9}, 3.642073681049961*^9, {
   3.643438784695303*^9, 3.643438867256172*^9}, {3.643439949781865*^9, 
   3.643439991007118*^9}, 3.643888991671843*^9, {3.645956046497212*^9, 
   3.64595604931356*^9}, 3.6460905643780403`*^9, {3.6642272463475027`*^9, 
   3.664227249232087*^9}, {3.664227653055511*^9, 3.664227656253936*^9}, {
   3.66422769023512*^9, 3.66422771546066*^9}, {3.664228061114002*^9, 
   3.664228065113823*^9}, {3.6644776692178183`*^9, 3.6644776826857557`*^9}, 
   3.664477792123556*^9, {3.664497277434523*^9, 3.664497279112611*^9}, {
   3.664497380532323*^9, 3.66449738222894*^9}, 3.664497624729237*^9, {
   3.664502583048074*^9, 3.664502664758737*^9}, {3.664664958313501*^9, 
   3.6646649661454363`*^9}, {3.666990095813983*^9, 3.666990098075905*^9}, {
   3.666990130425111*^9, 3.666990161100544*^9}, {3.666990213762389*^9, 
   3.666990218185725*^9}, {3.666990325823675*^9, 3.666990332550783*^9}, {
   3.666990384351349*^9, 3.666990428828786*^9}, {3.673100348442678*^9, 
   3.673100355426409*^9}, {3.673100388616253*^9, 3.673100401322295*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"DeclareSpanningSet", "[", 
   RowBox[{"diagrams", ":", 
    RowBox[{"{", 
     RowBox[{"Diagram", "..."}], "}"}]}], "]"}], ":=", 
  RowBox[{"DeclareSpanningSet", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
     "diagrams", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "@", 
     
     RowBox[{"numberOfBoundaryPoints", "[", "]"}]}], ",", "diagrams"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DeclareSpanningSet", "[", 
    RowBox[{"k_Integer", ",", 
     RowBox[{"diagrams", ":", 
      RowBox[{"{", 
       RowBox[{"Diagram", "..."}], "}"}]}]}], "]"}], "[", "s_SpiderAnalysis", 
   "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "zzz", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{"s", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}], 
        "]"}], "<", 
       RowBox[{"k", "+", "1"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"DeclareSpanningSet", "[", 
        RowBox[{"k", ",", "diagrams"}], "]"}], "[", 
       RowBox[{"ReplacePart", "[", 
        RowBox[{"s", ",", 
         RowBox[{"7", "\[Rule]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"PadRight", "[", 
             RowBox[{
              RowBox[{
              "s", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}], 
              ",", 
              RowBox[{"k", "+", "1"}], ",", "zzz"}], "]"}], "/.", 
            RowBox[{"zzz", "\[Rule]", 
             RowBox[{"{", "}"}]}]}], ")"}]}]}], "]"}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"ReplacePart", "[", 
        RowBox[{"s", ",", 
         RowBox[{"7", "\[Rule]", 
          RowBox[{"ReplacePart", "[", 
           RowBox[{
            RowBox[{
            "s", "\[LeftDoubleBracket]", "7", "\[RightDoubleBracket]"}], ",", 
            
            RowBox[{
             RowBox[{"k", "+", "1"}], "\[Rule]", 
             RowBox[{"{", "diagrams", "}"}]}]}], "]"}]}]}], "]"}], "}"}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"automaticFlatMap", "[", "DeclareSpanningSet", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641463673363431*^9, 3.641463707685845*^9}, {
  3.6414640253794937`*^9, 3.64146404573665*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"DeclareBasis", "[", 
   RowBox[{"diagrams", ":", 
    RowBox[{"{", 
     RowBox[{"Diagram", "..."}], "}"}]}], "]"}], ":=", 
  RowBox[{"DeclareBasis", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
     "diagrams", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "@", 
     
     RowBox[{"numberOfBoundaryPoints", "[", "]"}]}], ",", "diagrams"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DeclareBasis", "[", 
    RowBox[{"k_Integer", ",", 
     RowBox[{"diagrams", ":", 
      RowBox[{"{", 
       RowBox[{"Diagram", "..."}], "}"}]}]}], "]"}], "[", "s_SpiderAnalysis", 
   "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"pairings", ",", "innerProducts", ",", "det", ",", "s0"}], "}"}],
     ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pairings", "=", "\[IndentingNewLine]", 
      RowBox[{"DeleteCases", "[", 
       RowBox[{
        RowBox[{"Flatten", "[", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ComputePairingsWithReducingRelations", "[", "d0", "]"}],
              "[", "s", "]"}], "~", "Join", "~", 
            RowBox[{
             RowBox[{
             "ComputePairingsWithNonReducingRelations", "[", "d0", "]"}], "[",
              "s", "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"d0", ",", "diagrams"}], "}"}]}], "]"}], "]"}], ",", 
        "0"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "pairings", "]"}], ">", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"DeclareBasis", "[", "diagrams", "]"}], "[", 
        RowBox[{
         RowBox[{"DeclarePolynomialsZero", "[", 
          RowBox[{"Numerator", "[", 
           RowBox[{"Together", "[", "pairings", "]"}], "]"}], "]"}], "[", "s",
          "]"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"DimensionLowerBound", "[", 
           RowBox[{"s", ",", "k"}], "]"}], "\[LessEqual]", 
          RowBox[{"Length", "[", "diagrams", "]"}], "\[LessEqual]", 
          RowBox[{"DimensionUpperBound", "[", 
           RowBox[{"s", ",", "k"}], "]"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"innerProducts", "=", 
           RowBox[{"cachingInnerProduct", "[", 
            RowBox[{"s", ",", "diagrams"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"det", "[", 
            RowBox[{"{", "}"}], "]"}], "=", "1"}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"det", "[", "m_", "]"}], ":=", 
           RowBox[{"Factor", "[", 
            RowBox[{"delegatingDeterminant", "[", "m", "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"s0", "=", 
           RowBox[{"ReplacePart", "[", 
            RowBox[{"s", ",", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"3", ",", 
                RowBox[{"k", "+", "1"}]}], "}"}], "\[Rule]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Length", "[", "diagrams", "]"}], ",", 
                RowBox[{"Length", "[", "diagrams", "]"}]}], "}"}]}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"s0", "=", 
           RowBox[{
            RowBox[{"DeclareSpanningSet", "[", 
             RowBox[{"k", ",", "diagrams"}], "]"}], "[", "s0", "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"s0", "=", 
           RowBox[{"Fold", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"AppendIndependentDiagram", "[", "#2", "]"}], "[", 
               "#1", "]"}], "&"}], ",", "s0", ",", "diagrams"}], "]"}]}], ";",
           "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"DeclarePolynomialNonZero", "[", 
            RowBox[{"det", "[", "innerProducts", "]"}], "]"}], "[", "s0", 
           "]"}]}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{"{", "}"}]}], "]"}]}], "\[IndentingNewLine]", "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"automaticFlatMap", "[", "DeclareBasis", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6434392775423183`*^9, 3.6434394235846567`*^9}, {
   3.643439458209916*^9, 3.643439483509636*^9}, {3.643439535423162*^9, 
   3.6434395654579353`*^9}, {3.6434396597929583`*^9, 
   3.6434396734147663`*^9}, {3.643439705458637*^9, 3.643439723208334*^9}, {
   3.6434404111314*^9, 3.643440414122342*^9}, {3.643440596685795*^9, 
   3.643440598582921*^9}, {3.6435523154062967`*^9, 3.643552406974833*^9}, {
   3.643555793490093*^9, 3.643555797442172*^9}, 3.64388899377896*^9, 
   3.6460905701504374`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Considering diagrams", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{{3.642061720717699*^9, 3.642061731157151*^9}}],

Cell[BoxData[{
 RowBox[{"Clear", "[", "ConsiderDiagrams", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ConsiderDiagrams", "[", 
    RowBox[{
     RowBox[{"diagrams", ":", 
      RowBox[{"{", 
       RowBox[{"Diagram", "..."}], "}"}]}], ",", 
     RowBox[{"options", ":", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"_String", "\[Rule]", 
         RowBox[{"(", 
          RowBox[{"True", "|", "False"}], ")"}]}], ")"}], "..."}]}]}], "]"}], 
   ":=", 
   RowBox[{"ConsiderDiagrams", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
      "diagrams", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "@", 
      RowBox[{"numberOfBoundaryPoints", "[", "]"}]}], ",", "diagrams", ",", 
     "options"}], "]"}]}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"ConsiderDiagrams", "[", 
      RowBox[{"k_Integer", ",", 
       RowBox[{"diagrams", ":", 
        RowBox[{"{", 
         RowBox[{"Diagram", "..."}], "}"}]}], ",", 
       RowBox[{"options", ":", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"_String", "\[Rule]", 
           RowBox[{"(", 
            RowBox[{"True", "|", "False"}], ")"}]}], ")"}], "..."}]}]}], 
      "]"}], "[", "s_SpiderAnalysis", "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Length", "[", 
        RowBox[{
         RowBox[{"SpanningSets", "[", "k", "]"}], "[", "s", "]"}], "]"}], 
       "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Fold", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"ConsiderDiagram", "[", 
           RowBox[{"#2", ",", "options"}], "]"}], "[", "#1", "]"}], "&"}], 
        ",", 
        RowBox[{
         RowBox[{"ConsiderPotentialSpanningSet", "[", 
          RowBox[{"k", ",", "diagrams"}], "]"}], "[", "s", "]"}], ",", 
        "diagrams"}], "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"Fold", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"ConsiderDiagram", "[", 
           RowBox[{"#2", ",", "options"}], "]"}], "[", "#1", "]"}], "&"}], 
        ",", 
        RowBox[{"{", "s", "}"}], ",", "diagrams"}], "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ConsiderDiagrams", "[", 
    RowBox[{"k_Integer", ",", 
     RowBox[{"diagrams", ":", 
      RowBox[{"{", 
       RowBox[{"Diagram", "..."}], "}"}]}], ",", 
     RowBox[{"options", ":", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"_String", "\[Rule]", 
         RowBox[{"(", 
          RowBox[{"True", "|", "False"}], ")"}]}], ")"}], "..."}]}]}], "]"}], 
   "[", "s_SpiderAnalysis", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{"a", " ", "global", " ", "variable"}], ",", " ", "blech"}], " ",
      "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"consideringDiagrams", "=", "diagrams"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Fold", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"ConsiderDiagram", "[", 
          RowBox[{"#2", ",", "options"}], "]"}], "[", "#1", "]"}], "&"}], ",", 
       RowBox[{"{", "s", "}"}], ",", "diagrams"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"automaticFlatMap", "[", "ConsiderDiagrams", "]"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621221785013006*^9, 3.62122182746987*^9}, {
  3.622184513135298*^9, 3.622184530204187*^9}, {3.641459214981658*^9, 
  3.6414594082899513`*^9}, {3.641514090751581*^9, 3.641514099464034*^9}, {
  3.6644801860530787`*^9, 3.664480231023759*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"ConsiderDiagrams", "[", 
     RowBox[{
      RowBox[{"diagrams", ":", 
       RowBox[{"{", 
        RowBox[{"Diagram", "..."}], "}"}]}], ",", 
      RowBox[{"options", ":", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"_String", "\[Rule]", 
          RowBox[{"(", 
           RowBox[{"True", "|", "False"}], ")"}]}], ")"}], "..."}]}]}], "]"}],
     "[", "s_SpiderAnalysis", "]"}], ":=", 
   RowBox[{"Fold", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"PairRelationsWith", "[", 
        RowBox[{"Drop", "[", 
         RowBox[{"diagrams", ",", 
          RowBox[{
          "#2", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
         "]"}], "]"}], "[", 
       RowBox[{
        RowBox[{"ConsiderDiagram", "[", 
         RowBox[{
          RowBox[{
          "#2", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], ",", 
          "options"}], "]"}], "[", "#1", "]"}], "]"}], "&"}], ",", 
     RowBox[{"{", "s", "}"}], ",", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{"diagrams", ",", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "diagrams", "]"}], "]"}]}], "}"}], "]"}]}], 
    "]"}]}], "*)"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641374461175118*^9, 3.641374476458311*^9}, 
   3.641441879564913*^9, {3.6414420747140007`*^9, 3.641442102801491*^9}, {
   3.641442364533721*^9, 3.641442364956411*^9}, {3.641442586632772*^9, 
   3.6414426347302*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ReconsiderClosedDiagrams", "[", "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{
   RowBox[{"ConsiderClosedDiagrams", "[", 
    RowBox[{"ClosedDiagrams", "[", "s", "]"}], "]"}], "[", 
   RowBox[{"ReplacePart", "[", 
    RowBox[{"s", ",", 
     RowBox[{"6", "\[Rule]", 
      RowBox[{"{", "}"}]}]}], "]"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ReconsiderClosedDiagrams", "[", "S_List", "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{"ReconsiderClosedDiagrams", "/@", "S"}], "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641201201631896*^9, 3.641201251653763*^9}, {
  3.641241255921709*^9, 3.6412412673361053`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ConsiderDiagram", "[", 
     RowBox[{
      RowBox[{"d0", ":", "Diagram"}], ",", 
      RowBox[{"options", ":", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"_String", "\[Rule]", 
          RowBox[{"(", 
           RowBox[{"True", "|", "False"}], ")"}]}], ")"}], "..."}]}]}], "]"}],
     "[", "s_SpiderAnalysis", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "k", ",", "closedDiagrams", ",", "pairings", ",", "secondPass", ",", 
       "insistIndependent", ",", "insistDependent"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"k", "=", 
       RowBox[{"d0", "@", 
        RowBox[{"numberOfBoundaryPoints", "[", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"memberQDiagrams", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"IndependentDiagrams", "[", "k", "]"}], "[", "s", "]"}], 
           "~", "Join", "~", 
           RowBox[{
            RowBox[{"DependentDiagrams", "[", "k", "]"}], "[", "s", "]"}]}], 
          ",", "d0"}], "]"}], ",", 
        RowBox[{"{", "s", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{
              RowBox[{"SpanningSets", "[", "k", "]"}], "[", "s", "]"}], "]"}],
             "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
            "Print", "[", 
             "\"\<You need to declare a spanning set before we can consider \
diagrams...\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ","}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"closedDiagrams", "=", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
              "s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "@", 
              RowBox[{
               RowBox[{"diagramSpider", "[", "]"}], "@", 
               RowBox[{
                RowBox[{"innerProduct", "[", 
                 RowBox[{"d", ",", "#"}], "]"}], "@", 
                RowBox[{
                 RowBox[{"canonicalFormWithDefect", "[", "]"}], "@", 
                 RowBox[{"U1", "[", "]"}]}]}]}]}], "&"}], "/@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"{", "d", "}"}], "~", "Join", "~", 
              RowBox[{
               RowBox[{"IndependentDiagrams", "[", "k", "]"}], "[", "s", 
               "]"}], "~", "Join", "~", 
              RowBox[{
               RowBox[{"DependentDiagrams", "[", "k", "]"}], "[", "s", 
               "]"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"closedDiagrams", "=", 
           RowBox[{
            RowBox[{"Complement", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"#", "@", 
                   RowBox[{"hashCode", "[", "]"}]}], ",", "#"}], "}"}], "&"}],
                "/@", "closedDiagrams"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"#", "@", 
                   RowBox[{"hashCode", "[", "]"}]}], ",", "#"}], "}"}], "&"}],
                "/@", 
               RowBox[{"ClosedDiagrams", "[", "s", "]"}]}], ",", 
              RowBox[{"SameTest", "->", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"First", "[", "#1", "]"}], " ", "===", " ", 
                  RowBox[{"First", "[", "#2", "]"}]}], " ", "&"}], ")"}]}]}], 
             "]"}], "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}], ";"}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"closedDiagrams", "=", 
          RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "closedDiagrams", "]"}], ">", "0"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
            "Print", "[", 
             "\"\<Found some new closed diagrams... trying all possible \
evaluations.\>\"", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"ConsiderDiagram", "[", 
              RowBox[{"d0", ",", "options"}], "]"}], "[", 
             RowBox[{
              RowBox[{"ConsiderClosedDiagrams", "[", "closedDiagrams", "]"}], 
              "[", "s", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"secondPass", "=", 
             RowBox[{
              RowBox[{"\"\<SecondPass\>\"", "/.", 
               RowBox[{"{", "options", "}"}]}], "/.", 
              RowBox[{"\"\<SecondPass\>\"", "\[Rule]", "False"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"insistIndependent", "=", 
             RowBox[{
              RowBox[{"\"\<InsistIndependent\>\"", "/.", 
               RowBox[{"{", "options", "}"}]}], "/.", 
              RowBox[{"\"\<InsistIndependent\>\"", "\[Rule]", "False"}]}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"insistDependent", "=", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"\"\<InsistDependent\>\"", "/.", 
                 RowBox[{"{", "options", "}"}]}], "/.", 
                RowBox[{"\"\<InsistDependent\>\"", "\[Rule]", "False"}]}], 
               ")"}], "||", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"IndependentDiagrams", "[", "k", "]"}], "[", "s", 
                 "]"}], "]"}], "\[Equal]", 
               RowBox[{"DimensionUpperBound", "[", 
                RowBox[{"s", ",", "k"}], "]"}]}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"insistIndependent", "\[And]", "insistDependent"}], ",",
               "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
               "Print", "[", 
                "\"\<Warning: you've asked for this diagram to be \
independent, but we already have enough independent diagrams. Killing this \
branch.\>\"", "]"}], ";", 
               RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                 "s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                 "@", 
                 RowBox[{"reducibleDiagramU$qmark", "[", "d0", "]"}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"{", "s", "}"}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"!", "secondPass"}], ",", "\[IndentingNewLine]", 
                   RowBox[{"Print", "[", 
                    RowBox[{"\"\<We now consider the diagram \>\"", ",", 
                    RowBox[{"DrawPlanarGraph", "[", "d0", "]"}], ",", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    "insistIndependent", ",", 
                    "\"\<, insisting that it is independent.\>\"", ",", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    "insistDependent", ",", 
                    "\"\<, insisting that it is dependent.\>\"", ",", 
                    "\"\<.\>\""}], "]"}]}], "]"}]}], "]"}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<We return to considering the diagram \>\"", ",", 
                    RowBox[{"DrawPlanarGraph", "[", "d0", "]"}], ",", 
                    "\"\<.\>\""}], "]"}]}], "\[IndentingNewLine]", "]"}], ";",
                  "\[IndentingNewLine]", 
                 RowBox[{"(*", 
                  RowBox[{
                   RowBox[{"Put", "[", 
                    RowBox[{
                    RowBox[{"PickleSpiderAnalysis", "[", "s", "]"}], ",", 
                    "\"\</Users/scott/projects/toolkit/algebra-spiders/src/\
main/mathematica/saved-states/last.m\>\""}], "]"}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"Global`lastDiagram", "=", "d0"}], ";"}], "*)"}], 
                 "\[IndentingNewLine]", 
                 RowBox[{"pairings", "=", 
                  RowBox[{"If", "[", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"memberQDiagrams", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{"SpanningSets", "[", "k", "]"}], "[", "s", "]"}], 
                    "]"}], ",", "d0"}], "]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "ComputePairingsWithReducingRelations", "[", "d0", "]"}], 
                    "[", "s", "]"}], "~", "Join", "~", 
                    RowBox[{
                    RowBox[{
                    "ComputePairingsWithNonReducingRelations", "[", "d0", 
                    "]"}], "[", "s", "]"}]}]}], "\[IndentingNewLine]", 
                   "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", "pairings", "]"}], ">", "0"}], ",",
                    "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"ConsiderDiagram", "[", 
                    RowBox[{"d0", ",", 
                    RowBox[{"\"\<SecondPass\>\"", "\[Rule]", "True"}], ",", 
                    RowBox[{
                    "\"\<InsistIndependent\>\"", "\[Rule]", 
                    "insistIndependent"}], ",", 
                    RowBox[{
                    "\"\<InsistDependent\>\"", "\[Rule]", 
                    "insistDependent"}]}], "]"}], "[", 
                    RowBox[{
                    RowBox[{"DeclarePolynomialsZero", "[", 
                    RowBox[{"Numerator", "[", 
                    RowBox[{"Together", "[", "pairings", "]"}], "]"}], "]"}], 
                    "[", "s", "]"}], "]"}], ",", "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"!", "insistDependent"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"!", "insistIndependent"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    "Print", "[", 
                    "\"\<We consider separately the possibilities that it is \
linearly independent or linearly dependent.\>\"", "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ConsiderIndependentDiagram", "[", "d0", "]"}], 
                    "[", "s", "]"}], "~", "Join", "~", 
                    RowBox[{
                    RowBox[{"ConsiderDependentDiagram", "[", "d0", "]"}], "[",
                     "s", "]"}]}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"ConsiderIndependentDiagram", "[", "d0", "]"}], 
                    "[", "s", "]"}]}], "\[IndentingNewLine]", "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"ConsiderDependentDiagram", "[", "d0", "]"}], "[",
                     "s", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
                  "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
               "]"}]}], "\[IndentingNewLine]", "]"}]}]}], 
          "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621068196430439*^9, 3.6210682301294727`*^9}, {
   3.6210694056502666`*^9, 3.621069575852037*^9}, {3.621069617289014*^9, 
   3.6210696204062233`*^9}, 3.6210696823972597`*^9, {3.621069728519867*^9, 
   3.621069835434147*^9}, {3.621069905439932*^9, 3.621069943614794*^9}, {
   3.6210699807711697`*^9, 3.621070034429183*^9}, {3.62107013076266*^9, 
   3.621070171516594*^9}, {3.621070210641602*^9, 3.621070241257526*^9}, 
   3.621071655603436*^9, {3.621209737192374*^9, 3.6212097382003613`*^9}, {
   3.62120994041186*^9, 3.621210188620388*^9}, {3.621210238882011*^9, 
   3.621210261529521*^9}, {3.621211071832605*^9, 3.6212110947128077`*^9}, {
   3.621220266228983*^9, 3.6212203010396233`*^9}, {3.621220373358019*^9, 
   3.621220407750991*^9}, {3.6212206731471786`*^9, 3.62122116500191*^9}, {
   3.6212212429694767`*^9, 3.621221252881797*^9}, {3.6212212881893578`*^9, 
   3.621221289103297*^9}, {3.621896983769223*^9, 3.6218970238091307`*^9}, {
   3.6218970771344337`*^9, 3.62189710469203*^9}, {3.62190362887155*^9, 
   3.621903650960041*^9}, {3.621905127889215*^9, 3.62190513110515*^9}, {
   3.6221845333389797`*^9, 3.622184615248272*^9}, {3.641069839033166*^9, 
   3.641069839206719*^9}, {3.64107025276422*^9, 3.641070257810486*^9}, {
   3.641179465442556*^9, 3.6411796450507174`*^9}, {3.641179861019335*^9, 
   3.641179900599883*^9}, {3.641180340383136*^9, 3.641180344929475*^9}, {
   3.641180423334853*^9, 3.641180531995886*^9}, {3.641264333913022*^9, 
   3.6412643355925417`*^9}, {3.641266633304737*^9, 3.6412666651294813`*^9}, {
   3.6412935845359*^9, 3.641293616295045*^9}, {3.641365252214806*^9, 
   3.641365255052844*^9}, {3.641366979551836*^9, 3.641366984331945*^9}, {
   3.641377225099921*^9, 3.64137722557605*^9}, {3.6414416820384207`*^9, 
   3.641441693541503*^9}, {3.641452022603973*^9, 3.641452023954932*^9}, {
   3.6414543456865273`*^9, 3.6414544444090357`*^9}, {3.64146150121657*^9, 
   3.641461506846863*^9}, {3.641501150536818*^9, 3.641501154194331*^9}, {
   3.6415210888866243`*^9, 3.641521090408731*^9}, {3.641521126183537*^9, 
   3.641521167034766*^9}, {3.641801948239243*^9, 3.641802051300109*^9}, {
   3.64206088499762*^9, 3.642060888126693*^9}, {3.643458807641843*^9, 
   3.6434588609125338`*^9}, {3.643549802027527*^9, 3.643549807772868*^9}, {
   3.645868305483712*^9, 3.645868399853932*^9}, 3.645869258194013*^9, {
   3.664063309996634*^9, 3.664063314087696*^9}, {3.664478916931417*^9, 
   3.6644789212853203`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PairRelationsWith", "[", 
    RowBox[{"d0", ":", "Diagram"}], "]"}], "[", "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "pairings", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"pairings", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"ComputePairingsWithReducingRelations", "[", "d0", "]"}], "[",
         "s", "]"}], "~", "Join", "~", 
       RowBox[{
        RowBox[{"ComputePairingsWithNonReducingRelations", "[", "d0", "]"}], 
        "[", "s", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Print", "[", 
        RowBox[{"\"\<d0: \>\"", ",", 
         RowBox[{"DrawPlanarGraph", "[", "d0", "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"\"\<pairings: \>\"", ",", "pairings"}], "]"}], ";"}], "*)"}],
      "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "pairings", "]"}], ">", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"DeclarePolynomialsZero", "[", 
         RowBox[{"Numerator", "[", 
          RowBox[{"Together", "[", "pairings", "]"}], "]"}], "]"}], "[", "s", 
        "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"{", "s", "}"}]}], "\[IndentingNewLine]", "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6413671082689867`*^9, 3.641367173573675*^9}, {
   3.6434588699160767`*^9, 3.643458873128716*^9}, {3.64595089356653*^9, 
   3.645950906450809*^9}, 3.645954447302383*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"PairRelationsWith", "[", "diagrams_List", "]"}], "[", 
   "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"Fold", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"PairRelationsWith", "[", "#2", "]"}], "[", "#1", "]"}], "&"}], 
    ",", 
    RowBox[{"{", "s", "}"}], ",", "diagrams"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6413672184078712`*^9, 3.641367265786414*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"automaticFlatMap", "/@", 
   RowBox[{"{", 
    RowBox[{
    "ConsiderDiagram", ",", "ConsiderDiagrams", ",", "ConsiderClosedDiagram", 
     ",", "ConsiderClosedDiagrams", ",", "PairRelationsWith"}], "}"}]}], 
  ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621222038396456*^9, 3.621222049700859*^9}, {
  3.6221846181288853`*^9, 3.622184620102059*^9}, {3.641179953433856*^9, 
  3.641179955057961*^9}, {3.64136718276723*^9, 3.641367183189156*^9}}],

Cell[BoxData[
 RowBox[{"Clear", "[", "ReducePolynomials", "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641282009917452*^9, 3.6412820124183197`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ReducePolynomials", "[", "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"ReducePolynomials", "[", 
   RowBox[{"s", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6412819625470533`*^9, 3.641281969809472*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ReducePolynomials", "[", "m_Manifold", "]"}], "[", "X_List", 
   "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"ReducePolynomials", "[", "m", "]"}], "[", "#", "]"}], "&"}], "/@",
    "X"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621212098330963*^9, 3.621212111707547*^9}, {
  3.622184637256666*^9, 3.622184649756318*^9}, {3.622186537834318*^9, 
  3.622186554506481*^9}, {3.6412819731615553`*^9, 3.64128197689851*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ReducePolynomials", "[", "m_Manifold", "]"}], "[", 
   RowBox[{"X", ":", "Diagram"}], "]"}], ":=", "X"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6411610349969482`*^9, 3.641161038256669*^9}, 
   3.641281981917119*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ReducePolynomials", "[", "m_", "]"}], "[", "X_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"X0", ",", "f", ",", "variables"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"X0", "=", 
      RowBox[{"withoutMultiplicity", "/@", 
       RowBox[{"timesToList", "[", 
        RowBox[{"Factor", "[", 
         RowBox[{"X", "/.", 
          RowBox[{
          "m", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
         "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"variables", "=", 
      RowBox[{
       RowBox[{"Union", "[", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"m", ",", "X0"}], "}"}], ",", 
          RowBox[{
           SubscriptBox["p", "_"], "|", 
           RowBox[{"tt", "[", "_", "]"}]}], ",", "\[Infinity]"}], "]"}], 
        "]"}], "~", "Join", "~", 
       RowBox[{
       "m", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"{", 
        RowBox[{"q_", ",", "k_"}], "}"}], "]"}], ":=", 
      SuperscriptBox[
       RowBox[{"Factor", "[", 
        RowBox[{
         RowBox[{"cachedPolynomialReduce", "[", 
          RowBox[{"q", ",", 
           RowBox[{
           "m", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",", 
           "variables"}], "]"}], "\[LeftDoubleBracket]", "2", 
         "\[RightDoubleBracket]"}], "]"}], "k"]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Times", "@@", 
      RowBox[{"(", 
       RowBox[{"f", "/@", "X0"}], ")"}]}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641260310515168*^9, 3.641260349489625*^9}, {
   3.641281986179225*^9, 3.641282006163959*^9}, {3.641345816740234*^9, 
   3.641345848759563*^9}, 3.643453109142909*^9, {3.643453700706378*^9, 
   3.643453721231372*^9}, {3.643453834394017*^9, 3.643453834665431*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ReducePolynomialsFurther", "[", "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"ReducePolynomialsFurther", "[", 
   RowBox[{"s", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641293196035284*^9, 3.641293200167461*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ReducePolynomialsFurther", "[", "m_Manifold", "]"}], "[", 
   "X_List", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"ReducePolynomialsFurther", "[", "m", "]"}], "[", "#", "]"}], 
    "&"}], "/@", "X"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641293342463181*^9, 3.6412933555461683`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ReducePolynomialsFurther", "[", "m_Manifold", "]"}], "[", "X_", 
   "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"X0", ",", "f", ",", "variables", ",", "result"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"X0", "=", 
      RowBox[{"withoutMultiplicity", "/@", 
       RowBox[{"timesToList", "[", 
        RowBox[{"Factor", "[", 
         RowBox[{"X", "/.", 
          RowBox[{
          "m", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
         "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"variables", "=", 
      RowBox[{
       RowBox[{"Union", "[", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"m", ",", "X0"}], "}"}], ",", 
          RowBox[{
           SubscriptBox["p", "_"], "|", 
           RowBox[{"tt", "[", "_", "]"}]}], ",", "\[Infinity]"}], "]"}], 
        "]"}], "~", "Join", "~", 
       RowBox[{
       "m", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"f", "[", 
       RowBox[{"{", 
        RowBox[{"q_", ",", "k_"}], "}"}], "]"}], ":=", 
      SuperscriptBox[
       RowBox[{"Factor", "[", 
        RowBox[{
         RowBox[{"cachedPolynomialReduce", "[", 
          RowBox[{"q", ",", 
           RowBox[{
            RowBox[{
            "m", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], "~", 
            "Join", "~", 
            RowBox[{
            "m", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}]}], 
           ",", "variables"}], "]"}], "\[LeftDoubleBracket]", "2", 
         "\[RightDoubleBracket]"}], "]"}], "k"]}], ";", "\[IndentingNewLine]", 
     RowBox[{"result", "=", 
      RowBox[{"Times", "@@", 
       RowBox[{"(", 
        RowBox[{"f", "/@", "X0"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"NumericQ", "[", "result", "]"}], ",", 
       RowBox[{"result", "=", 
        RowBox[{"RootReduce", "[", "result", "]"}]}]}], "]"}], ";", 
     "\[IndentingNewLine]", "result"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641260310515168*^9, 3.641260349489625*^9}, {
  3.641281986179225*^9, 3.641282006163959*^9}, {3.641293208795864*^9, 
  3.6412932173638697`*^9}, {3.6413458378024397`*^9, 3.641345844965626*^9}, {
  3.667157671945932*^9, 3.66715769025883*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ComputePairingsWithReducingRelations", "[", 
    RowBox[{"d0", ":", "Diagram"}], "]"}], "[", "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "relations", ",", "innerProducts", ",", "oldSpider", ",", "relation"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"relations", "=", 
      RowBox[{
       RowBox[{"ReducingRelations", "[", 
        RowBox[{"d0", "@", 
         RowBox[{"numberOfBoundaryPoints", "[", "]"}]}], "]"}], "[", "s", 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Print", "[", 
        RowBox[{"\"\<reducing relations: \>\"", ",", "relations"}], "]"}], 
       ";"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"innerProducts", "=", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", "pair", "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"oldSpider", ",", "relation"}], "}"}], "=", "pair"}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"ReducePolynomials", "[", "s", "]"}], "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Plus", "@@", 
               RowBox[{"(", 
                RowBox[{"relation", "/.", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"z_", ",", 
                    RowBox[{"c", ":", "Diagram"}]}], "}"}], "\[RuleDelayed]", 
                  
                  RowBox[{"z", " ", 
                   RowBox[{"(", 
                    RowBox[{"cachingInnerProduct", "[", 
                    RowBox[{
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"s", ",", 
                    RowBox[{"1", "\[Rule]", "oldSpider"}]}], "]"}], ",", "c", 
                    ",", "d0"}], "]"}], ")"}]}]}]}], ")"}]}], ",", 
              RowBox[{"Plus", "@@", 
               RowBox[{"(", 
                RowBox[{"relation", "/.", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"z_", ",", 
                    RowBox[{"c", ":", "Diagram"}]}], "}"}], "\[RuleDelayed]", 
                  
                  RowBox[{"z", " ", 
                   RowBox[{"(", 
                    RowBox[{"cachingInnerProduct", "[", 
                    RowBox[{"s", ",", "c", ",", "d0"}], "]"}], ")"}]}]}]}], 
                ")"}]}]}], "}"}], "]"}]}]}], "\[IndentingNewLine]", "]"}], "/@",
         "relations"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", "innerProducts", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"DeleteCases", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"ReducePolynomialsFurther", "[", "s", "]"}], "[", 
        "innerProducts", "]"}], ",", "0"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.62121027345573*^9, 3.6212103157002163`*^9}, {
   3.621210708455922*^9, 3.6212108605189333`*^9}, 3.621210941864338*^9, {
   3.6221846667547207`*^9, 3.622184681345024*^9}, {3.622186594198947*^9, 
   3.6221866011186438`*^9}, {3.641069961254953*^9, 3.64106997427106*^9}, {
   3.641070094642329*^9, 3.641070197458233*^9}, {3.6410702308245363`*^9, 
   3.641070233878368*^9}, {3.641266674617758*^9, 3.641266677350889*^9}, {
   3.641266836874666*^9, 3.641266844600062*^9}, {3.641266952264662*^9, 
   3.641266978937439*^9}, {3.641273178873184*^9, 3.641273271370761*^9}, {
   3.641273357594612*^9, 3.641273373798027*^9}, {3.641279649286227*^9, 
   3.641279659334798*^9}, {3.6412936320890627`*^9, 3.641293632705522*^9}, 
   3.641978322305093*^9, {3.643458883418253*^9, 3.643458889581188*^9}, {
   3.643555273395*^9, 3.64355527767481*^9}, {3.643555307881812*^9, 
   3.643555346092746*^9}, {3.643555967226975*^9, 3.643555995281601*^9}, {
   3.646090834983323*^9, 3.6460908693507338`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ComputePairingsWithNonReducingRelations", "[", 
    RowBox[{"d0", ":", "Diagram"}], "]"}], "[", "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "relations", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"relations", "=", 
      RowBox[{
       RowBox[{"NonReducingRelations", "[", 
        RowBox[{"d0", "@", 
         RowBox[{"numberOfBoundaryPoints", "[", "]"}]}], "]"}], "[", "s", 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Print", "[", 
        RowBox[{"\"\<non-reducing relations: \>\"", ",", "relations"}], "]"}],
        ";"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"DeleteCases", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"ReducePolynomialsFurther", "[", "s", "]"}], "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Plus", "@@", "#"}], "&"}], "/@", 
         RowBox[{"(", 
          RowBox[{"relations", "/.", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"z_", ",", 
              RowBox[{"c", ":", "Diagram"}]}], "}"}], "\[RuleDelayed]", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", "r", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"r", "=", 
                RowBox[{"cachingInnerProduct", "[", 
                 RowBox[{"s", ",", "c", ",", "d0"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"Print", "[", 
                  RowBox[{"\"\<inner product of \>\"", ",", 
                   RowBox[{"DrawPlanarGraph", "[", "c", "]"}], ",", " ", 
                   "\"\< and \>\"", ",", " ", 
                   RowBox[{"DrawPlanarGraph", "[", "d0", "]"}], ",", " ", 
                   "\"\< is \>\"", ",", "r", ",", " ", 
                   "\"\< which evaluates to \>\"", ",", 
                   RowBox[{
                    RowBox[{"ReducePolynomialsFurther", "[", "s", "]"}], "[", 
                    "r", "]"}]}], "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"r", " ", "z"}]}]}], "]"}]}]}], "\[IndentingNewLine]", 
          ")"}]}], "]"}], ",", "0"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.62121027345573*^9, 3.6212103157002163`*^9}, {
   3.621210708455922*^9, 3.6212108605189333`*^9}, 3.621210941864338*^9, {
   3.6221846667547207`*^9, 3.622184681345024*^9}, {3.622186594198947*^9, 
   3.6221866011186438`*^9}, {3.641069961254953*^9, 3.64106997427106*^9}, {
   3.641070094642329*^9, 3.641070197458233*^9}, {3.6410702308245363`*^9, 
   3.641070233878368*^9}, {3.641266850308429*^9, 3.6412668549794893`*^9}, {
   3.641293637469192*^9, 3.641293638077162*^9}, 3.641978325098764*^9, {
   3.643458895923986*^9, 3.643458901494917*^9}, {3.645952380962261*^9, 
   3.645952455200068*^9}, {3.6459525327671423`*^9, 3.645952545615383*^9}, 
   3.6459539927910767`*^9, {3.6460906861468143`*^9, 3.646090699521216*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"delegatingNullSpace", "[", 
   RowBox[{"m_", ",", "options___"}], "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Length", "[", "m", "]"}], ">", "\[Infinity]"}], "\[And]", 
     RowBox[{
      RowBox[{"Length", "[", 
       RowBox[{"Variables", "[", "m", "]"}], "]"}], ">", "1"}]}], ",", 
    RowBox[{"{", 
     RowBox[{"SchwartzZippelNullSpace", "[", "m", "]"}], "}"}], ",", 
    RowBox[{"NullSpace", "[", 
     RowBox[{"m", ",", "options"}], "]"}]}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"delegatingDeterminant", "[", "m_", "]"}], ":=", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", "m", "]"}], ">", "10"}], ",", 
    RowBox[{"GuessingPolynomials`Private`onDiskParallelDeterminant", "[", 
     RowBox[{"m", ",", 
      RowBox[{"IntegerString", "[", 
       RowBox[{
        RowBox[{"Hash", "[", 
         RowBox[{"m", ",", "\"\<SHA1\>\""}], "]"}], ",", "16", ",", "16"}], 
       "]"}]}], "]"}], ",", 
    RowBox[{"Det", "[", "m", "]"}]}], "]"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643888862227923*^9, 3.643888957179709*^9}, {
   3.643890833404532*^9, 3.64389083953512*^9}, {3.64389454008435*^9, 
   3.6438945439435062`*^9}, {3.664498034980833*^9, 3.664498044024487*^9}, {
   3.664498305214761*^9, 3.664498308094858*^9}, 3.6646650389259253`*^9, {
   3.667163093328683*^9, 3.6671630938973637`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ConsiderIndependentDiagram", "[", 
    RowBox[{"d0", ":", "Diagram"}], "]"}], "[", "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "s0", ",", "s1", ",", "k", ",", "i", ",", "innerProducts", ",", 
      "innerProducts2", ",", "det", ",", "minors", ",", "nullSpace", ",", 
      "spanningSet", ",", "reorderedSpanningSet", ",", "dot", ",", "j"}], 
     "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"k", "=", 
      RowBox[{"d0", "@", 
       RowBox[{"numberOfBoundaryPoints", "[", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"memberQDiagrams", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"IndependentDiagrams", "[", "k", "]"}], "[", "s", "]"}], 
          "~", "Join", "~", 
          RowBox[{
           RowBox[{"DependentDiagrams", "[", "k", "]"}], "[", "s", "]"}]}], 
         ",", "d0"}], "]"}], ",", 
       RowBox[{"{", "s", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"s0", "=", 
         RowBox[{
          RowBox[{"AppendIndependentDiagram", "[", "d0", "]"}], "[", "s", 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"i", "=", 
         RowBox[{
          RowBox[{"IndependentDiagrams", "[", "k", "]"}], "[", "s0", "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"innerProducts", "=", 
         RowBox[{"cachingInnerProduct", "[", 
          RowBox[{"s0", ",", "i"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"det", "=", 
         RowBox[{
          RowBox[{"ReducePolynomials", "[", "s0", "]"}], "[", 
          RowBox[{"Factor", "[", 
           RowBox[{"delegatingDeterminant", "[", "innerProducts", "]"}], 
           "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "i", "]"}], "\[Equal]", 
           RowBox[{"DimensionUpperBound", "[", 
            RowBox[{"s0", ",", "k"}], "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"s0", "=", 
           RowBox[{
            RowBox[{"DeclarePolynomialNonZero", "[", "det", "]"}], "[", "s0", 
            "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{"(*", " ", 
            RowBox[{
             RowBox[{
              RowBox[{
              "Either", " ", "the", " ", "determinant", " ", "is", " ", 
               "non"}], "-", "zero"}], ",", " ", 
             RowBox[{
             "and", " ", "we", " ", "can", " ", "proceed", " ", "happily"}]}],
             " ", "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"DeclarePolynomialNonZero", "[", "det", "]"}], "[", "s0",
              "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{"or", " ", 
               RowBox[{"it", "'"}], "s", " ", "zero"}], ",", " ", 
              RowBox[{
              "in", " ", "which", " ", "case", " ", "we", " ", "find", " ", 
               "the", " ", "corresponding", " ", "ghost", " ", "relation"}], 
              ",", " ", 
              RowBox[{
              "find", " ", "the", " ", "element", " ", "of", " ", "the", " ", 
               "spanning", " ", "set", " ", "that", " ", "exorcises", " ", 
               "it"}], ",", " ", 
              RowBox[{
              "and", " ", "make", " ", "sure", " ", "we", " ", "consider", 
               " ", "that", " ", "diagram", " ", "next"}]}], " ", "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"s1", "=", 
              RowBox[{
               RowBox[{"DeclarePolynomialZero", "[", "det", "]"}], "[", "s0", 
               "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "s1", "]"}], ">", "0"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"minors", "=", 
                 RowBox[{"Union", "[", 
                  RowBox[{"Flatten", "[", 
                   RowBox[{"Minors", "[", 
                    RowBox[{"innerProducts", ",", 
                    RowBox[{
                    RowBox[{"Length", "[", "innerProducts", "]"}], "-", "1"}],
                     ",", 
                    RowBox[{
                    RowBox[{"Factor", "[", 
                    RowBox[{"delegatingDeterminant", "[", "#", "]"}], "]"}], 
                    "&"}]}], "]"}], "]"}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"Print", "[", 
                 RowBox[{"\"\<minors: \>\"", ",", "minors"}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"s1", "=", 
                 RowBox[{
                  RowBox[{
                  "DeclareAtLeastOnePolynomialNonZero", "[", "minors", "]"}], 
                  "[", "s1", "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Function", "[", 
                 RowBox[{
                  RowBox[{"{", "ss", "}"}], ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"Print", "[", 
                    RowBox[{"\"\<innerProducts: \>\"", ",", "innerProducts"}],
                     "]"}], ";", "\[IndentingNewLine]", 
                   RowBox[{"nullSpace", "=", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "i", "]"}], "\[Equal]", "1"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"{", "1", "}"}], "}"}], ",", 
                    RowBox[{"Factor", "[", 
                    RowBox[{"delegatingNullSpace", "[", 
                    RowBox[{
                    RowBox[{"Most", "[", "innerProducts", "]"}], ",", 
                    RowBox[{
                    "\"\<Method\>\"", "\[Rule]", 
                    "\"\<OneStepRowReduction\>\""}]}], "]"}], "]"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"(*", " ", 
                    RowBox[{"FIXME", " ", "worry", " ", "about", " ", 
                    RowBox[{
                    RowBox[{"denominators", "!"}], "?"}]}], " ", "*)"}], 
                   "\[IndentingNewLine]", 
                   RowBox[{"Print", "[", 
                    RowBox[{"\"\<nullSpace: \>\"", ",", "nullSpace"}], "]"}], 
                   ";", "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "nullSpace", "]"}], "\[NotEqual]", 
                    "1"}], ",", 
                    RowBox[{
                    RowBox[{
                    "Print", "[", 
                    "\"\<null space wasn't 1-dimensional! help!\>\"", "]"}], 
                    ";", 
                    RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"spanningSet", "=", 
                    RowBox[{"unionDiagrams", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{"SpanningSets", "[", "k", "]"}], "[", "ss", "]"}],
                     "]"}], "~", "Join", "~", "consideringDiagrams"}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"reorderedSpanningSet", "=", 
                    RowBox[{"i", "~", "Join", "~", 
                    RowBox[{"complementDiagrams", "[", 
                    RowBox[{"spanningSet", ",", "i"}], "]"}]}]}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "reorderedSpanningSet", "]"}], "=!=", 
                    RowBox[{"Length", "[", "spanningSet", "]"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    "Print", "[", 
                    "\"\<something is wrong with complementDiagrams\>\"", 
                    "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"Print", "[", 
                    RowBox[{"\"\<spanning set: \>\"", ",", 
                    RowBox[{"DrawPlanarGraph", "/@", "spanningSet"}]}], "]"}],
                     ";", "\[IndentingNewLine]", 
                    RowBox[{"Global`i", "=", "i"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Print", "[", 
                    RowBox[{"\"\<independent diagrams: \>\"", ",", 
                    RowBox[{"DrawPlanarGraph", "/@", "i"}]}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Print", "[", 
                    RowBox[{"\"\<reordering spanning set: \>\"", ",", 
                    RowBox[{"DrawPlanarGraph", "/@", 
                    RowBox[{"complementDiagrams", "[", 
                    RowBox[{"spanningSet", ",", "i"}], "]"}]}]}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Abort", "[", "]"}]}]}], "\[IndentingNewLine]", 
                    "]"}], ";", "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{
                    RowBox[{"Print", "[", 
                    RowBox[{"\"\<reorderedSpanningSet: \>\"", ",", 
                    RowBox[{
                    "DrawPlanarGraph", "/@", "reorderedSpanningSet"}]}], 
                    "]"}], ";"}], "*)"}], "\[IndentingNewLine]", 
                   RowBox[{"innerProducts2", "=", 
                    RowBox[{"cachingInnerProduct", "[", 
                    RowBox[{"ss", ",", "reorderedSpanningSet", ",", "i"}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<innerProducts2: \>\"", ",", "innerProducts2"}], 
                    "]"}], ";", "\[IndentingNewLine]", 
                   RowBox[{"dot", "=", 
                    RowBox[{
                    RowBox[{"ReducePolynomials", "[", "ss", "]"}], "[", 
                    RowBox[{"innerProducts2", ".", 
                    RowBox[{
                    "nullSpace", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}]}], "]"}]}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Take", "[", 
                    RowBox[{"dot", ",", 
                    RowBox[{"Length", "[", "i", "]"}]}], "]"}], "=!=", 
                    RowBox[{"Table", "[", 
                    RowBox[{"0", ",", 
                    RowBox[{"{", 
                    RowBox[{"Length", "[", "i", "]"}], "}"}]}], "]"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"dot", "=", 
                    RowBox[{
                    RowBox[{"ReducePolynomialsFurther", "[", "ss", "]"}], "[",
                     "dot", "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Take", "[", 
                    RowBox[{"dot", ",", 
                    RowBox[{"Length", "[", "i", "]"}]}], "]"}], "=!=", 
                    RowBox[{"Table", "[", 
                    RowBox[{"0", ",", 
                    RowBox[{"{", 
                    RowBox[{"Length", "[", "i", "]"}], "}"}]}], "]"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    "Print", "[", "\"\<something is messed up!\>\"", "]"}], 
                    ";", "\[IndentingNewLine]", 
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<innerProducts2: \>\"", ",", "innerProducts2"}], 
                    "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"Print", "[", 
                    RowBox[{"\"\<dot: \>\"", ",", "dot"}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "ss", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Print", "[", 
                    RowBox[{"\"\<i: \>\"", ",", 
                    RowBox[{"DrawPlanarGraph", "/@", "i"}]}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"dot", "===", 
                    RowBox[{"Table", "[", 
                    RowBox[{"0", ",", 
                    RowBox[{"{", 
                    RowBox[{"Length", "[", "reorderedSpanningSet", "]"}], 
                    "}"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"SpanningSets", "[", "k", "]"}], "[", "ss", "]"}],
                     "]"}], "\[Equal]", "0"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    "Print", "[", 
                    "\"\<You need to declare a spanning set to proceed!\>\"", 
                    "]"}], ";", 
                    RowBox[{"Abort", "[", "]"}]}]}], "\[IndentingNewLine]", 
                    "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{
                    "Print", "[", 
                    "\"\<Successfully ruled out the possibility of a ghost \
relation!\>\"", "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"j", "=", 
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{"dot", ",", 
                    RowBox[{"Except", "[", "0", "]"}], ",", "1", ",", "1", 
                    ",", 
                    RowBox[{"Heads", "\[Rule]", "False"}]}], "]"}], 
                    "\[LeftDoubleBracket]", 
                    RowBox[{"1", ",", "1"}], "\[RightDoubleBracket]"}]}], ";",
                     "\[IndentingNewLine]", 
                    RowBox[{"Print", "[", 
                    RowBox[{"\"\<dot: \>\"", ",", "dot"}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Print", "[", 
                    RowBox[{"\"\<j: \>\"", ",", "j"}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<Because of a ghost relation, we're about to consider \
\>\"", ",", 
                    RowBox[{
                    RowBox[{
                    "reorderedSpanningSet", "\[LeftDoubleBracket]", "j", 
                    "\[RightDoubleBracket]"}], "@", 
                    RowBox[{"toString", "[", "]"}]}], ",", 
                    "\"\<, possibly out of order.\>\""}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", " ", 
                    RowBox[{
                    "FIXME", " ", "think", " ", "carefully", " ", "about", 
                    " ", "whether", " ", "it", " ", "is", " ", "correct", " ",
                     "that", " ", "we", " ", "can", " ", "assume", " ", 
                    "this", " ", "one", " ", "is", " ", 
                    RowBox[{"independent", "?"}]}], " ", "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"ConsiderDiagram", "[", 
                    RowBox[{
                    RowBox[{
                    "reorderedSpanningSet", "\[LeftDoubleBracket]", "j", 
                    "\[RightDoubleBracket]"}], ",", 
                    RowBox[{
                    "\"\<InsistIndependent\>\"", "\[Rule]", "True"}]}], "]"}],
                     "[", "ss", "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}], 
                 "\[IndentingNewLine]", "]"}], "/@", "s1"}], ",", "1"}], 
              "]"}]}]}], "\[IndentingNewLine]", "}"}], ",", "1"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621211207343486*^9, 3.621211220073881*^9}, {
   3.62121188985466*^9, 3.6212118934093847`*^9}, {3.6212194108079453`*^9, 
   3.62121943196255*^9}, {3.621219466100642*^9, 3.6212197311758137`*^9}, {
   3.621219839802692*^9, 3.621219857611624*^9}, {3.621220337521693*^9, 
   3.621220337983882*^9}, {3.621221324292845*^9, 3.621221343302621*^9}, {
   3.62122137695466*^9, 3.6212214294551086`*^9}, {3.621222956397656*^9, 
   3.621222965326921*^9}, {3.6212230227809563`*^9, 3.621223023458712*^9}, {
   3.621897140386133*^9, 3.6218971858506937`*^9}, {3.6218972307188053`*^9, 
   3.621897337320443*^9}, {3.621897953347204*^9, 3.621897954466404*^9}, {
   3.6218981154496813`*^9, 3.621898147596964*^9}, 3.621898323630821*^9, {
   3.622184685856433*^9, 3.6221847329165*^9}, 3.622185549201511*^9, {
   3.641366987847211*^9, 3.641366995099921*^9}, {3.641373601602859*^9, 
   3.641373615955948*^9}, {3.6414483257927303`*^9, 3.641448496611413*^9}, {
   3.641448526901143*^9, 3.641448653128742*^9}, {3.641448688488381*^9, 
   3.641448698736376*^9}, 3.641451577932625*^9, {3.641451687104409*^9, 
   3.641451698720565*^9}, 3.641451740722652*^9, {3.6414519222384644`*^9, 
   3.641451981069676*^9}, {3.641452089998543*^9, 3.641452090266741*^9}, {
   3.641452257753834*^9, 3.641452260352648*^9}, {3.641452364094688*^9, 
   3.6414524562335577`*^9}, {3.641452501946719*^9, 3.641452510884926*^9}, {
   3.641452594720325*^9, 3.641452622554944*^9}, {3.6414527330810957`*^9, 
   3.6414527443914948`*^9}, {3.641454316461588*^9, 3.641454326339034*^9}, {
   3.641456432315632*^9, 3.64145650723713*^9}, {3.641456616805108*^9, 
   3.64145667768025*^9}, {3.6414567517724543`*^9, 3.641456771211301*^9}, {
   3.641456813799655*^9, 3.641456876601225*^9}, {3.641457007745255*^9, 
   3.641457062045072*^9}, {3.641457131875321*^9, 3.641457617311854*^9}, {
   3.641460098110516*^9, 3.641460100189193*^9}, {3.641460151853035*^9, 
   3.641460169016663*^9}, {3.6414605004707603`*^9, 3.641460519558015*^9}, {
   3.641460594065941*^9, 3.641460595792088*^9}, {3.6414607473823023`*^9, 
   3.641460754746212*^9}, {3.641460785603386*^9, 3.641460797803965*^9}, {
   3.64146111692168*^9, 3.641461155492939*^9}, {3.64146121724426*^9, 
   3.641461219308311*^9}, {3.641461317680385*^9, 3.641461326081088*^9}, {
   3.641461485851673*^9, 3.641461494874339*^9}, {3.6415137077688923`*^9, 
   3.641513728414569*^9}, 3.641513762070904*^9, {3.6419780127214813`*^9, 
   3.641978037338192*^9}, {3.6420022897441483`*^9, 3.642002299458516*^9}, {
   3.6420027013820133`*^9, 3.642002712735609*^9}, {3.642002856686063*^9, 
   3.642002869538074*^9}, {3.642003079202066*^9, 3.642003151567135*^9}, {
   3.642003188528495*^9, 3.642003236202927*^9}, {3.642003370927177*^9, 
   3.6420033770492887`*^9}, {3.642060890513665*^9, 3.64206089330245*^9}, {
   3.643458906762446*^9, 3.64345891375456*^9}, 3.643888944863263*^9, 
   3.643888999981937*^9, {3.6459516551719418`*^9, 3.645951711619307*^9}, {
   3.645954740204794*^9, 3.645954780021658*^9}, {3.645955343329143*^9, 
   3.645955346137765*^9}, 3.646001672314866*^9, {3.646090713765629*^9, 
   3.646090739254346*^9}, {3.664069957777773*^9, 3.6640699669058867`*^9}, {
   3.664165277292265*^9, 3.664165290017671*^9}, {3.664165396228261*^9, 
   3.6641654043596163`*^9}, {3.66416544419088*^9, 3.664165449895726*^9}, {
   3.664165495783607*^9, 3.6641654963446198`*^9}, {3.6641659997321367`*^9, 
   3.664166000193306*^9}, {3.664219259005289*^9, 3.664219275591406*^9}, {
   3.664479032122011*^9, 3.6644790519870377`*^9}, {3.6644802683519278`*^9, 
   3.664480309563755*^9}, {3.664482697304936*^9, 3.664482706712738*^9}, {
   3.664496027961948*^9, 3.664496033375985*^9}, {3.6730860983072577`*^9, 
   3.673086100506769*^9}, {3.673089829229797*^9, 3.673089866814576*^9}, {
   3.673089974489544*^9, 3.6730900039585*^9}, {3.6730900977803307`*^9, 
   3.6730900989293633`*^9}, {3.673090651438079*^9, 3.6730906868153467`*^9}, {
   3.67309077413439*^9, 3.67309078667829*^9}, {3.673090977455654*^9, 
   3.67309098361194*^9}, {3.673091097872016*^9, 3.6730911080643597`*^9}, {
   3.673091316227147*^9, 3.6730913175546017`*^9}, {3.673091406387885*^9, 
   3.6730914076412287`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"NullSpaceInPolynomialQuotient", "[", 
   RowBox[{
    RowBox[{"matrix_", "?", "MatrixQ"}], ",", "ideal_", ",", "variables_"}], 
   "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"l", ",", "a", ",", "as", ",", "gb"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Print", "[", 
      RowBox[{
      "\"\<computing null space of \>\"", ",", "matrix", ",", " ", 
       "\"\< mod \>\"", ",", " ", "ideal"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"l", "=", 
      RowBox[{"Length", "[", 
       RowBox[{
       "matrix", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"as", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"a", "[", "i", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "l"}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"gb", "=", 
      RowBox[{"GroebnerBasis", "[", 
       RowBox[{
        RowBox[{"ideal", "~", "Join", "~", 
         RowBox[{"Together", "[", 
          RowBox[{"matrix", ".", "as"}], "]"}]}], ",", 
        RowBox[{"as", "~", "Join", "~", "variables"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"\"\<gb: \>\"", ",", "gb"}], "]"}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"NullSpace", "[", 
      RowBox[{
       RowBox[{"DeleteCases", "[", 
        RowBox[{"gb", ",", 
         RowBox[{"r_", "/;", 
          RowBox[{"FreeQ", "[", 
           RowBox[{"r", ",", 
            RowBox[{"a", "[", "_Integer", "]"}]}], "]"}]}]}], "]"}], "/.", 
       RowBox[{
        RowBox[{"a", "[", "i_", "]"}], "\[RuleDelayed]", 
        RowBox[{"UnitVector", "[", 
         RowBox[{"l", ",", "i"}], "]"}]}]}], "]"}]}]}], "\[IndentingNewLine]",
    "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641169892413027*^9, 3.6411700770490017`*^9}, {
  3.641171020002595*^9, 3.64117103424053*^9}, {3.6411710705170813`*^9, 
  3.641171083919817*^9}, {3.641171151721998*^9, 3.641171172256097*^9}, {
  3.6411712052452507`*^9, 3.641171209541493*^9}, {3.641171975705964*^9, 
  3.6411719801924553`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ConsiderDependentDiagram", "[", 
    RowBox[{"d0", ":", "Diagram"}], "]"}], "[", "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "k", ",", "i", ",", "innerProducts", ",", "det", ",", "det0", ",", "s0", 
      ",", "nullSpace", ",", "newRelation", ",", "denominators", ",", 
      RowBox[{"result", "=", 
       RowBox[{"{", "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"k", "=", 
      RowBox[{"d0", "@", 
       RowBox[{"numberOfBoundaryPoints", "[", "]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"memberQDiagrams", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"IndependentDiagrams", "[", "k", "]"}], "[", "s", "]"}], 
          "~", "Join", "~", 
          RowBox[{
           RowBox[{"DependentDiagrams", "[", "k", "]"}], "[", "s", "]"}]}], 
         ",", "d0"}], "]"}], ",", 
       RowBox[{"{", "s", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<considering the dependent diagram \>\"", ",", 
          RowBox[{"DrawPlanarGraph", "[", "d0", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<manifold: \>\"", ",", 
          RowBox[{
          "s", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"i", "=", 
         RowBox[{
          RowBox[{"IndependentDiagrams", "[", "k", "]"}], "[", "s", "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"innerProducts", "=", 
         RowBox[{"cachingInnerProduct", "[", 
          RowBox[{"s", ",", 
           RowBox[{"i", "~", "Join", "~", 
            RowBox[{"{", "d0", "}"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
        "Print", "[", "\"\<computed and reduced inner products.\>\"", "]"}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"det0", "[", 
          RowBox[{"{", "}"}], "]"}], "=", "1"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"det0", "[", "M_", "]"}], ":=", 
         RowBox[{"delegatingDeterminant", "[", "M", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ReducePolynomials", "[", "s", "]"}], "[", 
              RowBox[{"Factor", "[", 
               RowBox[{"det0", "[", 
                RowBox[{"Most", "[", 
                 RowBox[{"Most", "/@", "innerProducts"}], "]"}], "]"}], "]"}],
               "]"}], "===", "0"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
             "Print", "[", 
              "\"\<Something has gone wrong; the upper left minor should have \
nonzero determinant!\>\"", "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"Print", "[", 
              RowBox[{
              "s", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"Print", "[", "innerProducts", "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Print", "[", 
              RowBox[{"Factor", "[", 
               RowBox[{"Det", "[", 
                RowBox[{"Most", "[", 
                 RowBox[{"Most", "/@", "innerProducts"}], "]"}], "]"}], "]"}],
               "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"Print", "[", 
              RowBox[{
               RowBox[{"ReducePolynomials", "[", "s", "]"}], "[", 
               RowBox[{"Factor", "[", 
                RowBox[{"det0", "[", 
                 RowBox[{"Most", "[", 
                  RowBox[{"Most", "/@", "innerProducts"}], "]"}], "]"}], 
                "]"}], "]"}], "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"Message", "[", 
              RowBox[{"foo", "::", "bar"}], "]"}], ";", "\[IndentingNewLine]", 
             RowBox[{"Abort", "[", "]"}]}]}], "\[IndentingNewLine]", "]"}], 
          ";"}], "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"innerProducts0", "=", "innerProducts"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"det", "=", 
         RowBox[{"det0", "[", "innerProducts", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Print", "[", "\"\<computed determinant\>\"", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"det", "=", 
         RowBox[{
          RowBox[{"ReducePolynomials", "[", "s", "]"}], "[", "det", "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"Print", "[", "\"\<reduced determinant\>\"", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"s0", "=", 
         RowBox[{
          RowBox[{"DeclarePolynomialsZero", "[", 
           RowBox[{"{", "det", "}"}], "]"}], "[", "s", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Print", "[", "\"\<declared determinant zero\>\"", "]"}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "s0", "]"}], "==", "0"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Print", "[", 
            RowBox[{
             RowBox[{"DrawPlanarGraph", "[", "d0", "]"}], ",", 
             "\"\< can't be dependent; the determinant of inner products \
isn't allowed to vanish\>\""}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"nullSpace", "=", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "i", "]"}], "\[Equal]", "0"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"{", "1", "}"}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"Factor", "[", 
               RowBox[{"delegatingNullSpace", "[", 
                RowBox[{
                 RowBox[{"Most", "[", "innerProducts", "]"}], ",", 
                 RowBox[{
                 "\"\<Method\>\"", "\[Rule]", 
                  "\"\<OneStepRowReduction\>\""}]}], "]"}], "]"}]}], 
             "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"Print", "[", "\"\<computed null space\>\"", "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "nullSpace", "]"}], "=!=", "1"}], ",", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{
               "\"\<Found a null space that wasn't 1-dimensional: \>\"", ",", 
                "nullSpace"}], "]"}], ";", 
              RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"newRelation", "=", 
            RowBox[{"Factor", "[", 
             RowBox[{
             "nullSpace", "\[LeftDoubleBracket]", "1", 
              "\[RightDoubleBracket]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"newRelation", "\[LeftDoubleBracket]", 
               RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], "===", "0"}], 
             ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{
               "\"\<The only possible relation is \>\"", ",", "newRelation", 
                ",", "\"\<, but that only involves diagrams which we've \
already declared independent.\>\""}], "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"Print", "[", 
               RowBox[{"\"\<innerProducts: \>\"", ",", "innerProducts"}], 
               "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"Abort", "[", "]"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Print", "[", 
               RowBox[{
               "\"\<We find a candidate relation \>\"", ",", "newRelation"}], 
               "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"denominators", "=", 
               RowBox[{"Complement", "[", 
                RowBox[{
                 RowBox[{"Union", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"withoutMultiplicity", "[", "#", "]"}], 
                    "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                    "&"}], "/@", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"timesToList", "/@", 
                    RowBox[{"Factor", "[", 
                    RowBox[{"DeleteCases", "[", 
                    RowBox[{
                    RowBox[{"Denominator", "/@", "newRelation"}], ",", 
                    RowBox[{"1", "|", 
                    RowBox[{"-", "1"}]}]}], "]"}], "]"}]}], "]"}]}], "]"}], 
                 ",", 
                 RowBox[{
                  RowBox[{"s", "\[LeftDoubleBracket]", 
                   RowBox[{"2", ",", "4"}], "\[RightDoubleBracket]"}], "~", 
                  "Join", "~", 
                  RowBox[{"(", 
                   RowBox[{"-", 
                    RowBox[{"s", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "4"}], "\[RightDoubleBracket]"}]}], 
                   ")"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "denominators", "]"}], ">", "0"}], 
                ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"denominators", "=", 
                  RowBox[{
                   RowBox[{"ReducePolynomials", "[", 
                    RowBox[{
                    "s", "\[LeftDoubleBracket]", "2", 
                    "\[RightDoubleBracket]"}], "]"}], "[", "denominators", 
                   "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"MemberQ", "[", 
                    RowBox[{"denominators", ",", "0"}], "]"}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{
                    "Print", "[", 
                    "\"\<That null space calculation was bogus: bad \
denominators!\>\"", "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"Print", "[", 
                    RowBox[{"\"\<Groebner basis: \>\"", ",", 
                    RowBox[{"s", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "2"}], "\[RightDoubleBracket]"}]}], 
                    "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"Print", "[", 
                    RowBox[{"\"\<nonzero stuff: \>\"", ",", 
                    RowBox[{"s", "\[LeftDoubleBracket]", 
                    RowBox[{"2", ",", "4"}], "\[RightDoubleBracket]"}]}], 
                    "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"Print", "[", 
                    RowBox[{
                    "\"\<inner products: \>\"", ",", "innerProducts"}], "]"}],
                     ";", "\[IndentingNewLine]", 
                    RowBox[{"Print", "[", 
                    RowBox[{"\"\<det: \>\"", ",", "det"}], "]"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Print", "[", 
                  RowBox[{
                  "\"\<This has denominators, \>\"", ",", "denominators", 
                   ",", "\"\<, and we first consider the possibility that one \
of these vanishes.\>\""}], "]"}], ";", "\[IndentingNewLine]", 
                 RowBox[{"result", "=", 
                  RowBox[{
                   RowBox[{"ConsiderDependentDiagram", "[", "d0", "]"}], "[", 
                   
                   RowBox[{
                    RowBox[{
                    "DeclareAtLeastOnePolynomialZero", "[", "denominators", 
                    "]"}], "[", "s0", "]"}], "]"}]}], ";"}]}], 
               "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"result", "~", "Join", "~", 
               RowBox[{
                RowBox[{"PairRelationsWith", "[", 
                 RowBox[{"complementDiagrams", "[", 
                  RowBox[{
                   RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{"SpanningSets", "[", "k", "]"}], "[", "s", "]"}], 
                    "]"}], ",", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"IndependentDiagrams", "[", "k", "]"}], "[", "s", 
                    "]"}], "~", "Join", "~", 
                    RowBox[{
                    RowBox[{"DependentDiagrams", "[", "k", "]"}], "[", "s", 
                    "]"}]}], "]"}]}], "]"}], "]"}], "[", 
                RowBox[{
                 RowBox[{"IntroduceRelation", "[", 
                  RowBox[{"k", ",", 
                   RowBox[{"Transpose", "[", 
                    RowBox[{"{", 
                    RowBox[{"newRelation", ",", 
                    RowBox[{"Append", "[", 
                    RowBox[{"i", ",", "d0"}], "]"}]}], "}"}], "]"}]}], "]"}], 
                 "[", 
                 RowBox[{
                  RowBox[{"AppendDependentDiagram", "[", "d0", "]"}], "[", 
                  RowBox[{
                   RowBox[{
                   "DeclarePolynomialsNonZero", "[", "denominators", "]"}], 
                   "[", "s0", "]"}], "]"}], "]"}], "]"}]}]}]}], 
            "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
         "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.621211225538184*^9, 3.62121189849776*^9, {3.621904986371375*^9, 
   3.621905072336936*^9}, {3.62190520165291*^9, 3.621905250207527*^9}, {
   3.621905420802417*^9, 3.621905518373662*^9}, {3.6219055521254253`*^9, 
   3.621905711365254*^9}, {3.621905828664753*^9, 3.62190585248324*^9}, {
   3.6219058925352783`*^9, 3.621905902471244*^9}, {3.621905951323913*^9, 
   3.621905954172449*^9}, {3.622184757980463*^9, 3.622184797460238*^9}, {
   3.622185633703443*^9, 3.622185681926783*^9}, {3.622186140709152*^9, 
   3.622186170359498*^9}, {3.622187071276224*^9, 3.622187074884384*^9}, {
   3.62218711305313*^9, 3.622187129304729*^9}, {3.622420041582466*^9, 
   3.622420042284843*^9}, {3.622421779959168*^9, 3.62242180371336*^9}, {
   3.6224220453369017`*^9, 3.6224220486879873`*^9}, {3.622422095047598*^9, 
   3.622422117910234*^9}, {3.622423345025906*^9, 3.622423351473606*^9}, {
   3.6410263374968367`*^9, 3.64102634483044*^9}, {3.641162023696113*^9, 
   3.6411620619626923`*^9}, {3.6411701283766193`*^9, 3.641170131150816*^9}, {
   3.641170178591857*^9, 3.64117025706321*^9}, {3.641170372778429*^9, 
   3.641170400908135*^9}, {3.641170448397148*^9, 3.6411704508389397`*^9}, {
   3.6411704972019*^9, 3.641170552726803*^9}, {3.641172949558412*^9, 
   3.641173007499886*^9}, {3.6412529884053926`*^9, 3.641253016630754*^9}, {
   3.6412579196473713`*^9, 3.6412579283329687`*^9}, {3.6412582507472687`*^9, 
   3.641258253875396*^9}, {3.641258307019043*^9, 3.6412583122983913`*^9}, {
   3.641258345173703*^9, 3.641258346830901*^9}, {3.64129425930611*^9, 
   3.641294259734335*^9}, {3.641351509421825*^9, 3.641351544048162*^9}, {
   3.6413752475259733`*^9, 3.641375249061339*^9}, {3.641375402586977*^9, 
   3.6413754157119226`*^9}, {3.6413758019618673`*^9, 
   3.6413758407502813`*^9}, {3.641375894897122*^9, 3.641376091528006*^9}, {
   3.641376200959929*^9, 3.6413762015113497`*^9}, {3.641376410569111*^9, 
   3.6413764334271393`*^9}, {3.641376566632061*^9, 3.641376576510887*^9}, {
   3.6413766465340033`*^9, 3.641376730491003*^9}, {3.6414419131191807`*^9, 
   3.641441925216062*^9}, {3.64144196380294*^9, 3.6414419970025597`*^9}, {
   3.641442135925234*^9, 3.641442153506358*^9}, 3.6414423321609697`*^9, {
   3.641442383833053*^9, 3.641442384557598*^9}, {3.641442415779207*^9, 
   3.641442420922824*^9}, {3.641442459239423*^9, 3.641442460866336*^9}, {
   3.641442546952167*^9, 3.641442558453891*^9}, {3.641461409042321*^9, 
   3.641461477432228*^9}, {3.64151377041385*^9, 3.641513775590629*^9}, {
   3.6415257191566467`*^9, 3.641525745965169*^9}, {3.64197957713024*^9, 
   3.64197957742311*^9}, {3.641980365491684*^9, 3.641980396385524*^9}, {
   3.641980523115662*^9, 3.641980532984416*^9}, {3.6419810267781153`*^9, 
   3.641981079485347*^9}, {3.641981141408854*^9, 3.6419811448669567`*^9}, {
   3.641981239151909*^9, 3.641981250615131*^9}, {3.642000212322529*^9, 
   3.642000225499826*^9}, {3.642000339677908*^9, 3.6420003482962217`*^9}, {
   3.642000697633638*^9, 3.642000702759986*^9}, {3.6420735034247417`*^9, 
   3.642073530221575*^9}, {3.6433698029839687`*^9, 3.643369813663452*^9}, {
   3.643683226944916*^9, 3.643683304820528*^9}, {3.643716118225916*^9, 
   3.643716121373466*^9}, {3.6437161709691563`*^9, 3.643716177375374*^9}, {
   3.643718444055553*^9, 3.643718446882926*^9}, {3.6438889719122963`*^9, 
   3.6438889847655354`*^9}, {3.64609074898652*^9, 3.646090788090053*^9}, {
   3.664063325518251*^9, 3.66406333123806*^9}, {3.664070152887492*^9, 
   3.664070155258494*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"automaticFlatMap", "/@", 
   RowBox[{"{", 
    RowBox[{"ConsiderIndependentDiagram", ",", "ConsiderDependentDiagram"}], 
    "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.639697992986432*^9, 3.639698019398528*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"IntroduceRelation", "[", 
   RowBox[{"relation", ":", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"_", ",", 
        RowBox[{"_", ":", "Diagram"}]}], "}"}], ".."}], "}"}]}], "]"}], ":=", 
  
  RowBox[{"IntroduceRelation", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"relation", "\[LeftDoubleBracket]", 
      RowBox[{"1", ",", "2"}], "\[RightDoubleBracket]"}], "@", 
     RowBox[{"numberOfBoundaryPoints", "[", "]"}]}], ",", "relation"}], 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6413660407040453`*^9, 3.641366098263548*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"IntroduceRelation", "[", 
    RowBox[{"size_Integer", ",", 
     RowBox[{"{", "}"}]}], "]"}], "[", "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"{", "s", "}"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.622186197652719*^9, 3.62218620167231*^9}, {
  3.641366027779275*^9, 3.641366028603178*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"IntroduceRelation", "[", 
   RowBox[{"size_Integer", ",", 
    RowBox[{"relation", ":", 
     RowBox[{"{", 
      RowBox[{"terms___", ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "_"}], "}"}]}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"IntroduceRelation", "[", 
   RowBox[{"size", ",", " ", 
    RowBox[{"{", "terms", "}"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.622186251239317*^9, 3.622186272738789*^9}, 
   3.641366032468232*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"IntroduceRelation", "[", 
    RowBox[{"size_Integer", ",", 
     RowBox[{"relation", ":", 
      RowBox[{"{", 
       RowBox[{"initialTerms___", ",", 
        RowBox[{"{", 
         RowBox[{"z_", ",", "diagram_"}], "}"}]}], "}"}]}]}], "]"}], "[", 
   "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Print", "[", 
      RowBox[{
      "\"\<As we are considering a relation with final coefficient not equal \
to one (\>\"", ",", "z", ",", 
       "\"\<), we branch into two cases, where that coefficient is zero or \
nonzero (and then divide through).\>\""}], "]"}], ";", "\[IndentingNewLine]", 
     
     RowBox[{
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"IntroduceRelation", "[", 
            RowBox[{"size", ",", 
             RowBox[{
              RowBox[{"ReducePolynomials", "[", "#", "]"}], "[", "relation", 
              "]"}]}], "]"}], "[", "#", "]"}], "&"}], "/@", 
         RowBox[{
          RowBox[{"DeclarePolynomialZero", "[", "z", "]"}], "[", "s", "]"}]}],
         ",", "1"}], "]"}], "~", "Join", "~", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"IntroduceRelation", "[", 
        RowBox[{"size", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "/", 
            RowBox[{"{", 
             RowBox[{"z", ",", "1"}], "}"}]}], "&"}], "/@", "relation"}]}], 
        "]"}], "[", 
       RowBox[{
        RowBox[{"DeclarePolynomialNonZero", "[", "z", "]"}], "[", "s", "]"}], 
       "]"}]}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.622186379724717*^9, 3.622186475718417*^9}, {
   3.622186521828974*^9, 3.622186529004547*^9}, {3.622186636436152*^9, 
   3.622186742677191*^9}, 3.6221867925158978`*^9, {3.6411610592129507`*^9, 
   3.6411610681669893`*^9}, 3.641366033685927*^9, {3.6413773084124327`*^9, 
   3.641377340229013*^9}, {3.641377481225872*^9, 3.641377487832242*^9}, {
   3.6413775421193447`*^9, 3.641377556188588*^9}, {3.641377711442347*^9, 
   3.641377722419832*^9}, {3.6413779086487703`*^9, 3.641377908953506*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"IntroduceRelation", "[", 
    RowBox[{"size_Integer", ",", 
     RowBox[{"relation", ":", 
      RowBox[{"{", 
       RowBox[{"initialTerms___", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "diagram_"}], "}"}]}], "}"}]}]}], "]"}], "[", 
   "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "diagrams", ",", "moreDiagrams", ",", "scalaRelation", ",", 
      "innerProducts", ",", "nonzeroInnerProducts", ",", "newS"}], "}"}], ",",
     "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"diagrams", "=", 
      RowBox[{"relation", "\[LeftDoubleBracket]", 
       RowBox[{"All", ",", "2"}], "\[RightDoubleBracket]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"moreDiagrams", "=", 
      RowBox[{"unionDiagrams", "[", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
           "s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "@", 
           RowBox[{
            RowBox[{"diagramSpider", "[", "]"}], "@", 
            RowBox[{"rotate", "[", 
             RowBox[{"d0", ",", "k"}], "]"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{"d0", ",", 
            RowBox[{"unionDiagrams", "[", 
             RowBox[{"diagrams", "~", "Join", "~", 
              RowBox[{
               RowBox[{"DependentDiagrams", "[", 
                RowBox[{
                 RowBox[{
                 "s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                 "@", 
                 RowBox[{
                  RowBox[{"diagramSpider", "[", "]"}], "@", 
                  RowBox[{"circumference", "[", "diagram", "]"}]}]}], "]"}], 
               "[", "s", "]"}], "~", "Join", "~", 
              RowBox[{
               RowBox[{"IndependentDiagrams", "[", 
                RowBox[{
                 RowBox[{
                 "s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
                 "@", 
                 RowBox[{
                  RowBox[{"diagramSpider", "[", "]"}], "@", 
                  RowBox[{"circumference", "[", "diagram", "]"}]}]}], "]"}], 
               "[", "s", "]"}]}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"k", ",", "0", ",", 
            RowBox[{
             RowBox[{
              RowBox[{
              "s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              "@", 
              RowBox[{
               RowBox[{"diagramSpider", "[", "]"}], "@", 
               RowBox[{"circumference", "[", "d0", "]"}]}]}], "-", "1"}]}], 
           "}"}]}], "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", "\"\<starting innerProductMatrix\>\"", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"innerProducts", "=", 
      RowBox[{"cachingInnerProduct", "[", 
       RowBox[{"s", ",", "diagrams", ",", "moreDiagrams"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"nonzeroInnerProducts", "=", 
      RowBox[{"Numerator", "[", 
       RowBox[{"DeleteCases", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ReducePolynomialsFurther", "[", "s", "]"}], "[", 
          RowBox[{
           RowBox[{"relation", "\[LeftDoubleBracket]", 
            RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}], ".", 
           "innerProducts"}], "]"}], ",", "0"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"scalaRelation", "=", 
        RowBox[{"AsScalaObject", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "\[Rule]", 
            RowBox[{"AsScalaObject", "[", 
             RowBox[{
              RowBox[{
              "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
              ",", "\"\<MultivariableRationalFunction\>\""}], "]"}]}], "&"}], 
          "/@", "relation"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"innerProducts", "=", 
        RowBox[{"Numerator", "[", 
         RowBox[{"Together", "[", 
          RowBox[{"FromScalaObject", "[", 
           RowBox[{
            RowBox[{
            "s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], "@", 
            
            RowBox[{"allInnerProductEvaluations", "[", 
             RowBox[{"scalaRelation", ",", 
              RowBox[{"AsScalaList", "[", "moreDiagrams", "]"}]}], "]"}]}], 
           "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nonzeroInnerProducts", "=", 
        RowBox[{"nonzeroInnerProducts", "~", "Join", "~", 
         RowBox[{"Union", "[", 
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ReducePolynomials", "[", "s", "]"}], "[", 
             "innerProducts", "]"}], ",", "0"}], "]"}], "]"}]}]}], ";"}], 
      "\[IndentingNewLine]", "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", "\"\<finished innerProductMatrix\>\"", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "nonzeroInnerProducts", "]"}], ">", "0"}], ",",
        "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
        "text", "[", 
         "\"\<The candidate relation has non-trivial inner products with some \
of the diagrams appearing in it; we set these to zero first before \
proceeding.\>\"", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Print", "[", "innerProducts", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{
         "\"\<declaring zero: \>\"", ",", " ", "nonzeroInnerProducts"}], 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"newS", "=", 
         RowBox[{
          RowBox[{
          "DeclarePolynomialsZero", "[", "nonzeroInnerProducts", "]"}], "[", 
          "s", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Print", "[", "newS", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"s", "===", "newS"}], ",", 
          RowBox[{
           RowBox[{"Print", "[", "newS", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"IntroduceRelation", "[", 
              RowBox[{"size", ",", 
               RowBox[{
                RowBox[{"ReducePolynomials", "[", "#", "]"}], "[", "relation",
                 "]"}]}], "]"}], "[", "#", "]"}], "&"}], "/@", "newS"}], ",", 
          "1"}], "]"}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{
        "Decide", " ", "if", " ", "it", " ", "is", " ", "a", " ", "reducing", 
         " ", "relation", " ", "or", " ", 
         RowBox[{"not", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"diagramWeight", "[", "diagram", "]"}], ">", 
          RowBox[{"Max", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"diagramWeight", "[", "#", "]"}], "&"}], "/@", 
            RowBox[{"Cases", "[", 
             RowBox[{
              RowBox[{"{", "initialTerms", "}"}], ",", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"z_", ",", "d_"}], "}"}], "/;", 
                 RowBox[{"z", "=!=", "0"}]}], ")"}], "\[RuleDelayed]", 
               "d"}]}], "]"}]}], "]"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"IntroduceReducingRelation", "[", 
           RowBox[{"size", ",", "relation"}], "]"}], "[", "s", "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"IntroduceNonReducingRelation", "[", 
           RowBox[{"size", ",", "relation"}], "]"}], "[", "s", "]"}]}], 
        "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.622185683319483*^9, 3.622185710480742*^9}, {
   3.6221858061137667`*^9, 3.6221859029242773`*^9}, {3.622186034252976*^9, 
   3.6221860873985043`*^9}, {3.6221861474062557`*^9, 
   3.6221861795215883`*^9}, {3.622186213840969*^9, 3.6221862320259857`*^9}, {
   3.622186280603532*^9, 3.622186325203093*^9}, {3.622256482833406*^9, 
   3.622256513290818*^9}, {3.622420044754319*^9, 3.62242004497919*^9}, {
   3.622420100287483*^9, 3.6224201629589863`*^9}, {3.622420209162343*^9, 
   3.622420338335973*^9}, {3.622420384107933*^9, 3.622420521440988*^9}, {
   3.62242064799822*^9, 3.622420658470398*^9}, {3.622420725916934*^9, 
   3.622420729692464*^9}, {3.622420935016252*^9, 3.622420936175528*^9}, {
   3.6397747705479593`*^9, 3.639774805282979*^9}, {3.6409994789344893`*^9, 
   3.640999481960526*^9}, {3.6409995380091457`*^9, 3.640999543517272*^9}, {
   3.641021731265128*^9, 3.641021735256424*^9}, {3.641024778865795*^9, 
   3.64102480307593*^9}, {3.641025705000494*^9, 3.6410257301848927`*^9}, {
   3.641026374706315*^9, 3.641026376548367*^9}, {3.641154201146593*^9, 
   3.641154218114225*^9}, {3.641155038308111*^9, 3.641155085439637*^9}, {
   3.641155120348897*^9, 3.64115515487105*^9}, {3.6411568627512007`*^9, 
   3.641156872722241*^9}, {3.641156906803677*^9, 3.64115700517631*^9}, {
   3.641157054462175*^9, 3.6411570651417847`*^9}, {3.6411571708844547`*^9, 
   3.641157179436348*^9}, {3.6411572205502567`*^9, 3.641157223633368*^9}, {
   3.641159174221512*^9, 3.641159176079212*^9}, {3.641161367489513*^9, 
   3.6411613749068127`*^9}, {3.641162082917425*^9, 3.6411621258416758`*^9}, {
   3.641162265752057*^9, 3.641162268166376*^9}, {3.641162718483345*^9, 
   3.6411627243634663`*^9}, {3.6411665966885853`*^9, 
   3.6411665996574507`*^9}, {3.641167103584127*^9, 3.641167103762898*^9}, {
   3.64116718271084*^9, 3.641167187491541*^9}, {3.641167239686466*^9, 
   3.641167243249564*^9}, {3.641178694626319*^9, 3.641178725930765*^9}, {
   3.6412001365579233`*^9, 3.641200137045176*^9}, {3.6412002163242683`*^9, 
   3.641200223219668*^9}, {3.641200253883428*^9, 3.6412002637737303`*^9}, {
   3.641260969484235*^9, 3.641260991370286*^9}, {3.6412643717921886`*^9, 
   3.641264406807291*^9}, {3.6412646692559767`*^9, 3.6412646783123827`*^9}, {
   3.641266436517638*^9, 3.6412664420350227`*^9}, {3.641266508073154*^9, 
   3.641266520907324*^9}, {3.641293164488228*^9, 3.641293169370178*^9}, 
   3.641366037788632*^9, {3.641514212003461*^9, 3.6415142125185213`*^9}, 
   3.641514256613977*^9, {3.643466115055757*^9, 3.6434661196937847`*^9}, {
   3.64609079605009*^9, 3.646090810735322*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"tCounter", "=", "1"}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.639788039030589*^9, 3.639788044310792*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"IntroduceReducingRelation", "[", 
    RowBox[{"size_", ",", 
     RowBox[{"relation", ":", 
      RowBox[{"{", 
       RowBox[{"initialTerms___", ",", 
        RowBox[{"{", 
         RowBox[{"1", ",", "diagram_"}], "}"}]}], "}"}]}]}], "]"}], "[", 
   "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"reduction", ",", "newSubstitutions"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
     "text", "[", 
      "\"\<We now add this relation to the set of reducing relations.\>\"", 
      "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"newSubstitutions", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"tt", "[", 
           RowBox[{"tCounter", "++"}], "]"}], "\[Rule]", "#"}], ")"}], "&"}], 
       "/@", 
       RowBox[{
        RowBox[{"{", "initialTerms", "}"}], "\[LeftDoubleBracket]", 
        RowBox[{"All", ",", "1"}], "\[RightDoubleBracket]"}]}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"reduction", "=", 
      RowBox[{"ScalaCaseClass", "[", 
       RowBox[{
       "\"\<net.tqft.toolkit.algebra.spiders.Reduction\>\"", ",", "diagram", 
        ",", 
        RowBox[{"AsScalaMap", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
            "\[Rule]", 
            RowBox[{"AsScalaObject", "[", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
              ",", "\"\<MultivariableRationalFunction\>\""}], "]"}]}], "&"}], 
          "/@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"{", "initialTerms", "}"}], "/.", 
            RowBox[{"(", 
             RowBox[{"Reverse", "/@", "newSubstitutions"}], ")"}]}], ")"}]}], 
         "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"PairRelationsWith", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"IndependentDiagrams", "[", "size", "]"}], "[", "s", "]"}], 
        "~", "Join", "~", 
        RowBox[{
         RowBox[{"DependentDiagrams", "[", "size", "]"}], "[", "s", "]"}]}], 
       "]"}], "[", 
      RowBox[{"Global`stash", "=", 
       RowBox[{"ReconsiderClosedDiagrams", "[", 
        RowBox[{
         RowBox[{"DeclarePolynomialsZero", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Numerator", "[", 
             RowBox[{"Together", "[", 
              RowBox[{
               RowBox[{
               "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               "-", 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
              "]"}], "]"}], "&"}], "/@", "newSubstitutions"}], "]"}], "[", 
         RowBox[{"ReplacePart", "[", 
          RowBox[{"s", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"1", "\[Rule]", 
              RowBox[{
               RowBox[{
               "s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               "@", 
               RowBox[{"addReduction", "[", "reduction", "]"}]}]}], ",", 
             RowBox[{
              RowBox[{"-", "2"}], "\[Rule]", 
              RowBox[{
               RowBox[{"s", "\[LeftDoubleBracket]", 
                RowBox[{"-", "2"}], "\[RightDoubleBracket]"}], "~", "Join", 
               "~", 
               RowBox[{"{", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                  "s", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
                   ",", "relation"}], "}"}], "}"}]}]}]}], "}"}]}], "]"}], 
         "]"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.622185910258069*^9, 3.6221859152387247`*^9}, {
   3.622186343436524*^9, 3.622186353948721*^9}, {3.62218679677278*^9, 
   3.622186797947009*^9}, {3.622188572768833*^9, 3.6221886897594147`*^9}, {
   3.6221906734190617`*^9, 3.62219072503115*^9}, {3.622222207493886*^9, 
   3.622222248939636*^9}, {3.62223161649837*^9, 3.622231625175474*^9}, {
   3.62223239902291*^9, 3.6222324013759003`*^9}, 3.622250408446537*^9, {
   3.622250443378903*^9, 3.622250481740024*^9}, {3.622250512823997*^9, 
   3.6222505273485527`*^9}, {3.6397876702975063`*^9, 
   3.6397877130230007`*^9}, {3.639787991674758*^9, 3.639788031632793*^9}, {
   3.639788063706381*^9, 3.639788188507854*^9}, {3.639788335801277*^9, 
   3.639788336140836*^9}, {3.63978916057586*^9, 3.639789183772889*^9}, {
   3.639792213642136*^9, 3.639792213759329*^9}, 3.6410270486120243`*^9, {
   3.6411622080737467`*^9, 3.641162223450263*^9}, {3.64120119008745*^9, 
   3.641201194839095*^9}, {3.641203535408752*^9, 3.641203554738831*^9}, {
   3.641273430787517*^9, 3.641273439822988*^9}, {3.641289355250345*^9, 
   3.641289368548229*^9}, {3.641351935531871*^9, 3.64135193720394*^9}, {
   3.643555527163846*^9, 3.64355557003227*^9}, {3.645951279085785*^9, 
   3.645951284291857*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"IntroduceNonReducingRelation", "[", 
    RowBox[{"size_", ",", "relation_"}], "]"}], "[", "s_SpiderAnalysis", 
   "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
     "Print", "[", 
      "\"\<Adding a non-reducing relations, but for the most part ignoring \
it!\>\"", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"ReplacePart", "[", 
      RowBox[{"s", ",", 
       RowBox[{
        RowBox[{"-", "1"}], "\[Rule]", 
        RowBox[{
         RowBox[{"s", "\[LeftDoubleBracket]", 
          RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], "~", "Join", "~", 
         RowBox[{"{", "relation", "}"}]}]}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.622186763877996*^9, 3.622186764105174*^9}, {
  3.622186800692418*^9, 3.622186803847026*^9}, {3.622188589242963*^9, 
  3.622188589607645*^9}, {3.6398830910622597`*^9, 3.6398831056615677`*^9}, {
  3.641069069257739*^9, 3.641069108869904*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"automaticFlatMap", "/@", 
   RowBox[{"{", 
    RowBox[{
    "IntroduceRelation", ",", "IntroduceReducingRelation", ",", 
     "IntroduceNonReducingRelation"}], "}"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.622186916752366*^9, 3.622186930507717*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DeclarePolynomialEitherZeroOrNonZero", "[", "polynomial_", "]"}], 
   "[", "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"Flatten", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"DeclarePolynomialsZero", "[", 
        RowBox[{"{", "polynomial", "}"}], "]"}], "[", "s", "]"}], ",", 
      RowBox[{
       RowBox[{"DeclarePolynomialNonZero", "[", "polynomial", "]"}], "[", "s",
        "]"}]}], "}"}], ",", "1"}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641368889594645*^9, 3.6413689442837763`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DeclarePolynomialZero", "[", "polynomial_", "]"}], "[", 
   "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{
   RowBox[{"DeclarePolynomialsZero", "[", 
    RowBox[{"{", "polynomial", "}"}], "]"}], "[", "s", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.641377831536537*^9, 3.6413778492042217`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DeclarePolynomialsZero", "[", "polynomials_List", "]"}], "[", 
   "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "newManifolds", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"newManifolds", "=", 
      RowBox[{
       RowBox[{"DeclarePolynomialsZero", "[", "polynomials", "]"}], "[", 
       RowBox[{"s", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
       "TODO", " ", "should", " ", "we", " ", "look", " ", "at", " ", "the", 
        " ", "non"}], "-", 
       RowBox[{
       "reducing", " ", "relations", " ", "and", " ", "see", " ", "if", " ", 
        "any", " ", "became", " ", 
        RowBox[{"reducing", "?", "!"}]}]}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"ReplacePart", "[", 
        RowBox[{"s", ",", 
         RowBox[{"2", "\[Rule]", "#"}]}], "]"}], "&"}], "/@", 
      "newManifolds"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621212471765955*^9, 3.6212125112252693`*^9}, {
   3.621212551085021*^9, 3.62121262049223*^9}, {3.621213220164653*^9, 
   3.6212132342120247`*^9}, {3.621219026588146*^9, 3.621219045738554*^9}, {
   3.622184803575325*^9, 3.622184834721281*^9}, {3.639792723048723*^9, 
   3.639792723464302*^9}, 3.641264280236288*^9, {3.641346367662208*^9, 
   3.641346368042573*^9}, {3.6413464118144283`*^9, 3.6413464815951033`*^9}, {
   3.641346769503613*^9, 3.641346770487588*^9}, 3.641346865373933*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DeclareAtLeastOnePolynomialZero", "[", "polynomials_List", "]"}], 
   "[", "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "newManifolds", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"newManifolds", "=", 
      RowBox[{
       RowBox[{"DeclareAtLeastOnePolynomialZero", "[", "polynomials", "]"}], 
       "[", 
       RowBox[{"s", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
       RowBox[{
       "TODO", " ", "should", " ", "we", " ", "look", " ", "at", " ", "the", 
        " ", "non"}], "-", 
       RowBox[{
       "reducing", " ", "relations", " ", "and", " ", "see", " ", "if", " ", 
        "any", " ", "became", " ", 
        RowBox[{"reducing", "?", "!"}]}]}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"ReplacePart", "[", 
        RowBox[{"s", ",", 
         RowBox[{"2", "\[Rule]", "#"}]}], "]"}], 
       RowBox[{"(*", 
        RowBox[{"/.", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"d", ":", "Diagram"}], "\[Rule]", "z_"}], ")"}], 
          "\[RuleDelayed]", 
          RowBox[{"(", 
           RowBox[{"d", "\[Rule]", 
            RowBox[{
             RowBox[{"cachedPolynomialReduce", "[", 
              RowBox[{"z", ",", 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
              "]"}], "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}],
            ")"}]}]}], "*)"}], "&"}], "/@", "newManifolds"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6219053722269773`*^9, 3.6219054167366056`*^9}, {
   3.622184809728599*^9, 3.622184856674217*^9}, {3.6397927254871473`*^9, 
   3.6397927267486486`*^9}, 3.641264275752967*^9, 3.641290226991542*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
   "DeclareAtLeastOnePolynomialNonZero", "[", "polynomials_List", "]"}], "[", 
   "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "newManifolds", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"newManifolds", "=", 
      RowBox[{
       RowBox[{
       "DeclareAtLeastOnePolynomialNonZero", "[", "polynomials", "]"}], "[", 
       RowBox[{"s", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"ReplacePart", "[", 
        RowBox[{"s", ",", 
         RowBox[{"2", "\[Rule]", "#"}]}], "]"}], "&"}], "/@", 
      "newManifolds"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6219053722269773`*^9, 3.6219054167366056`*^9}, {
   3.622184809728599*^9, 3.622184856674217*^9}, {3.6397927254871473`*^9, 
   3.6397927267486486`*^9}, 3.641264275752967*^9, 3.641290226991542*^9, {
   3.6730904691028357`*^9, 3.673090479897187*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DeclarePolynomialsNonZero", "[", "polynomials_List", "]"}], "[", 
   "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "newManifolds", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"newManifolds", "=", 
      RowBox[{
       RowBox[{"DeclarePolynomialsNonZero", "[", "polynomials", "]"}], "[", 
       RowBox[{"s", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"ReplacePart", "[", 
        RowBox[{"s", ",", 
         RowBox[{"2", "\[Rule]", "#"}]}], "]"}], 
       RowBox[{"(*", 
        RowBox[{"/.", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"d", ":", "Diagram"}], "\[Rule]", "z_"}], ")"}], 
          "\[RuleDelayed]", 
          RowBox[{"(", 
           RowBox[{"d", "\[Rule]", 
            RowBox[{
             RowBox[{"cachedPolynomialReduce", "[", 
              RowBox[{"z", ",", 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
              "]"}], "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}],
            ")"}]}]}], "*)"}], "&"}], "/@", "newManifolds"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.621905724708951*^9, 3.621905731310268*^9}, {
   3.6221848154784727`*^9, 3.6221848549452057`*^9}, 3.6221868763015223`*^9, {
   3.63979272866339*^9, 3.639792729056324*^9}, 3.641264272344571*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"DeclarePolynomialNonZero", "[", "polynomial_", "]"}], "[", 
   "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "newManifolds", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"newManifolds", "=", 
      RowBox[{
       RowBox[{"DeclarePolynomialNonZero", "[", "polynomial", "]"}], "[", 
       RowBox[{"s", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"ReplacePart", "[", 
        RowBox[{"s", ",", 
         RowBox[{"2", "\[Rule]", "#"}]}], "]"}], 
       RowBox[{"(*", 
        RowBox[{"/.", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"d", ":", "Diagram"}], "\[Rule]", "z_"}], ")"}], 
          "\[RuleDelayed]", 
          RowBox[{"(", 
           RowBox[{"d", "\[Rule]", 
            RowBox[{
             RowBox[{"cachedPolynomialReduce", "[", 
              RowBox[{"z", ",", 
               RowBox[{
               "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
              "]"}], "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}],
            ")"}]}]}], "*)"}], "&"}], "/@", "newManifolds"}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"automaticFlatMap", "[", "DeclarePolynomialNonZero", "]"}]}], "Input",\

 InitializationCell->True,
 CellChangeTimes->{{3.621219762713732*^9, 3.621219785675132*^9}, {
  3.6221848225754642`*^9, 3.6221848533603277`*^9}, {3.639792731559876*^9, 
  3.6397927319616137`*^9}, {3.6412642542162857`*^9, 3.641264266038056*^9}, {
  3.641459656586235*^9, 3.6414596663226633`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Pickling", "Subsubsection",
 InitializationCell->True,
 CellChangeTimes->{{3.6436003232625027`*^9, 3.6436003256854*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"PickleSpiderAnalysis", "[", "s_SpiderAnalysis", "]"}], ":=", 
  RowBox[{"Append", "[", 
   RowBox[{
    RowBox[{"PickledSpiderAnalysis", "@@", 
     RowBox[{"(", 
      RowBox[{"s", "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"d0", ":", "Diagram"}], "\[RuleDelayed]", 
          RowBox[{"d0", "@", 
           RowBox[{"toString", "[", "]"}]}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{"q_", "?", "JavaObjectQ"}], "/;", 
           RowBox[{"InstanceOf", "[", 
            RowBox[{
            "q", ",", 
             "\"\<net.tqft.toolkit.algebra.spiders.examples.QuotientSpider\>\"\
"}], "]"}]}], "\[RuleDelayed]", 
          RowBox[{"PickleQuotientSpider", "[", "q", "]"}]}]}], "}"}]}], 
      ")"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{"#", ",", 
        RowBox[{
         RowBox[{"NamedPolyhedron", "[", "#", "]"}], "@", 
         RowBox[{"toString", "[", "]"}]}]}], "}"}], "&"}], "/@", 
     RowBox[{"Union", "[", 
      RowBox[{"Cases", "[", 
       RowBox[{"s", ",", 
        SubscriptBox["p", "_"], ",", "\[Infinity]"}], "]"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PickleSpiderAnalysis", "[", "S_List", "]"}], ":=", 
  RowBox[{"PickleSpiderAnalysis", "/@", "S"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643598715645447*^9, 3.643598806867407*^9}, {
   3.643598844367263*^9, 3.6435988517661877`*^9}, {3.643600175881687*^9, 
   3.643600194319602*^9}, {3.643630186307571*^9, 3.6436302233697453`*^9}, {
   3.643630538453689*^9, 3.643630538618145*^9}, {3.643694997768949*^9, 
   3.6436950090195847`*^9}, {3.643695060929679*^9, 3.6436950634242477`*^9}, 
   3.643711104800021*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"UnpickleSpiderAnalysis", "[", "s_PickledSpiderAnalysis", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "renamer", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"tCounter", "=", 
      RowBox[{"Max", "[", 
       RowBox[{"tCounter", ",", 
        RowBox[{
         RowBox[{"Union", "[", 
          RowBox[{"Cases", "[", 
           RowBox[{"s", ",", 
            RowBox[{
             RowBox[{"tt", "[", "k_", "]"}], "\[RuleDelayed]", "k"}], ",", 
            "\[Infinity]"}], "]"}], "]"}], "+", "1"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"renamer", "[", 
       SubscriptBox["p", "k_"], "]"}], ":=", 
      RowBox[{
       RowBox[{"renamer", "[", 
        SubscriptBox["p", "k"], "]"}], "=", 
       RowBox[{
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"s", "\[LeftDoubleBracket]", 
           RowBox[{"-", "1"}], "\[RightDoubleBracket]"}], ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             SubscriptBox["p", "k"], ",", "r_"}], "}"}], "\[RuleDelayed]", 
           RowBox[{"Name", "[", 
            RowBox[{"PlanarGraphs", "@", 
             RowBox[{"fromString", "[", "r", "]"}]}], "]"}]}], ",", "1", ",", 
          "1"}], "]"}], "\[LeftDoubleBracket]", "1", 
        "\[RightDoubleBracket]"}]}]}], ";", 
     RowBox[{"SpiderAnalysis", "@@", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"Most", "[", "s", "]"}], "/.", 
         RowBox[{"{", 
          RowBox[{
           SubscriptBox["p", "k_"], "\[RuleDelayed]", 
           RowBox[{"renamer", "[", 
            SubscriptBox["p", "k"], "]"}]}], "}"}]}], "/.", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"d0_String", "/;", 
            RowBox[{
             RowBox[{"StringTake", "[", 
              RowBox[{"d0", ",", "12"}], "]"}], "===", 
             "\"\<PlanarGraph(\>\""}]}], "\[RuleDelayed]", 
           RowBox[{"PlanarGraphs", "@", 
            RowBox[{"fromString", "[", "d0", "]"}]}]}], ",", 
          RowBox[{"q_PickledQuotientSpider", "\[RuleDelayed]", 
           RowBox[{"UnpickleQuotientSpider", "[", "q", "]"}]}]}], "}"}]}], 
       ")"}]}]}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"UnpickleSpiderAnalysis", "[", "S_List", "]"}], ":=", 
  RowBox[{"UnpickleSpiderAnalysis", "/@", "S"}]}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643598825721304*^9, 3.643598913811945*^9}, {
   3.6436002021623297`*^9, 3.643600218945519*^9}, {3.643630232057972*^9, 
   3.6436302447074423`*^9}, {3.643630288265876*^9, 3.643630410341858*^9}, 
   3.643630443244113*^9, {3.643630505145281*^9, 3.643630517230509*^9}, {
   3.643630792297721*^9, 3.643630795236498*^9}, {3.643695084566243*^9, 
   3.643695089295455*^9}, 3.643711102368021*^9, {3.643912536775056*^9, 
   3.6439125817612867`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"PickleQuotientSpider", "[", 
   RowBox[{"q_", "/;", 
    RowBox[{"InstanceOf", "[", 
     RowBox[{
     "q", ",", 
      "\"\<net.tqft.toolkit.algebra.spiders.examples.QuotientSpider\>\""}], 
     "]"}]}], "]"}], ":=", 
  RowBox[{"PickledQuotientSpider", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"Flatten", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{"\"\<{\>\"", "<>", 
           RowBox[{"StringTake", "[", 
            RowBox[{
             RowBox[{"#", "@", 
              RowBox[{
               RowBox[{"U1", "[", "]"}], "@", 
               RowBox[{"toString", "[", "]"}]}]}], ",", 
             RowBox[{"{", 
              RowBox[{"12", ",", 
               RowBox[{"-", "2"}]}], "}"}]}], "]"}], "<>", "\"\<}\>\""}], 
          "]"}], ",", 
         RowBox[{"FromScalaObject", "[", 
          RowBox[{"#", "@", 
           RowBox[{"U2", "[", "]"}]}], "]"}]}], "}"}], "]"}], "&"}], "/@", 
     RowBox[{"FromScalaObject", "[", 
      RowBox[{
       RowBox[{"q", "@", 
        RowBox[{"generators", "[", "]"}]}], ",", "1"}], "]"}]}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"#", "@", 
         RowBox[{
          RowBox[{"big", "[", "]"}], "@", 
          RowBox[{"toString", "[", "]"}]}]}], ",", 
        RowBox[{"FromScalaObject", "[", 
         RowBox[{"#", "@", 
          RowBox[{"small", "[", "]"}]}], "]"}]}], "}"}], "&"}], "/@", 
     RowBox[{"FromScalaObject", "[", 
      RowBox[{
       RowBox[{"q", "@", 
        RowBox[{"extraReductions", "[", "]"}]}], ",", "1"}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6435993361972513`*^9, 3.643599381606679*^9}, {
   3.6435997105139303`*^9, 3.643599716153652*^9}, {3.64359977146235*^9, 
   3.643599771497386*^9}, 3.643600392332299*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"UnpickleQuotientSpider", "[", 
   RowBox[{"PickledQuotientSpider", "[", 
    RowBox[{"generators_", ",", "reductions_"}], "]"}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "scalaReductions", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"scalaReductions", "=", 
      RowBox[{
       RowBox[{
        RowBox[{"ScalaCaseClass", "[", 
         RowBox[{"\"\<net.tqft.toolkit.algebra.spiders.Reduction\>\"", ",", 
          RowBox[{"PlanarGraphs", "@", 
           RowBox[{"fromString", "[", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
            "]"}]}], ",", 
          RowBox[{"AsScalaMap", "[", 
           RowBox[{
            RowBox[{"Function", "[", 
             RowBox[{
              RowBox[{"{", "term", "}"}], ",", 
              RowBox[{
               RowBox[{"PlanarGraphs", "@", 
                RowBox[{"fromString", "[", 
                 RowBox[{
                 "term", "\[LeftDoubleBracket]", "1", 
                  "\[RightDoubleBracket]"}], "]"}]}], "\[Rule]", 
               RowBox[{"AsScalaObject", "[", 
                RowBox[{
                 RowBox[{
                 "term", "\[LeftDoubleBracket]", "2", 
                  "\[RightDoubleBracket]"}], ",", 
                 "\"\<MultivariableRationalFunction\>\""}], "]"}]}]}], "]"}], 
            "/@", 
            RowBox[{
            "#", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}]}], 
           "]"}]}], "]"}], "&"}], "/@", "reductions"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Fold", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"#1", "@", 
         RowBox[{"addReduction", "[", "#2", "]"}]}], "&"}], ",", 
       RowBox[{"FreeSpider", "[", "generators", "]"}], ",", 
       "scalaReductions"}], "]"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.643599778528183*^9, 3.643599803696001*^9}, {
  3.643599949886572*^9, 3.643600096301259*^9}, {3.643600135218828*^9, 
  3.643600137002946*^9}, {3.643912504593279*^9, 3.6439125321363*^9}, {
  3.644414800320551*^9, 3.644414803859248*^9}}]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["End of package", "Section",
 InitializationCell->True,
 CellChangeTimes->{{3.643604752210631*^9, 3.6436047585251513`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}]], "Input",
 InitializationCell->True],

Cell[BoxData[
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]], "Input",
 InitializationCell->True]
}, Open  ]]
}, Open  ]]
},
AutoGeneratedPackage->Automatic,
Evaluator->"Local (3)",
WindowSize->{1440, 851},
WindowMargins->{{Automatic, -158}, {Automatic, 0}},
FrontEndVersion->"11.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (September \
21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[422, 15, 122, 2, 65, "Chapter",
 InitializationCell->True],
Cell[547, 19, 210, 5, 30, "Text",
 InitializationCell->True],
Cell[760, 26, 249, 6, 32, "Input"],
Cell[CellGroupData[{
Cell[1034, 36, 192, 3, 35, "Subsubsection",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[1251, 43, 2789, 48, 112, "Input",
 InitializationCell->True],
Cell[4043, 93, 788, 14, 24, "Message"],
Cell[4834, 109, 792, 14, 42, "Message"],
Cell[5629, 125, 788, 14, 24, "Message"],
Cell[6420, 141, 525, 10, 24, "Message"],
Cell[6948, 153, 781, 13, 42, "Message"],
Cell[7732, 168, 785, 13, 42, "Message"],
Cell[8520, 183, 785, 13, 42, "Message"],
Cell[9308, 198, 524, 10, 24, "Message"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[9881, 214, 145, 2, 35, "Subsubsection",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[10051, 220, 322, 6, 91, "Input",
 InitializationCell->True],
Cell[10376, 228, 184, 2, 24, "Print"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[10609, 236, 225, 4, 64, "Section",
 InitializationCell->True],
Cell[10837, 242, 640, 13, 48, "Input",
 InitializationCell->True],
Cell[11480, 257, 245, 4, 48, "Input",
 InitializationCell->True],
Cell[11728, 263, 296, 5, 48, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[12049, 272, 416, 7, 48, "Input",
 InitializationCell->True],
Cell[12468, 281, 173, 2, 32, "Output"]
}, Open  ]],
Cell[12656, 286, 277, 5, 48, "Input",
 InitializationCell->True],
Cell[12936, 293, 295, 6, 48, "Input",
 InitializationCell->True],
Cell[13234, 301, 132, 3, 48, "Input",
 InitializationCell->True],
Cell[13369, 306, 636, 10, 196, "Input",
 InitializationCell->True],
Cell[14008, 318, 315, 5, 48, "Input",
 InitializationCell->True],
Cell[14326, 325, 176, 4, 48, "Input",
 InitializationCell->True],
Cell[14505, 331, 539, 9, 238, "Input",
 InitializationCell->True],
Cell[15047, 342, 353, 6, 48, "Input",
 InitializationCell->True],
Cell[15403, 350, 220, 4, 48, "Input",
 InitializationCell->True],
Cell[15626, 356, 228, 4, 48, "Input",
 InitializationCell->True],
Cell[15857, 362, 369, 6, 48, "Input",
 InitializationCell->True],
Cell[16229, 370, 541, 9, 196, "Input",
 InitializationCell->True],
Cell[16773, 381, 290, 5, 48, "Input",
 InitializationCell->True],
Cell[17066, 388, 347, 6, 48, "Input",
 InitializationCell->True],
Cell[17416, 396, 119, 3, 48, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[17560, 403, 130, 2, 44, "Subsection",
 InitializationCell->True],
Cell[17693, 407, 954, 24, 70, "Input",
 InitializationCell->True],
Cell[18650, 433, 426, 10, 48, "Input",
 InitializationCell->True],
Cell[19079, 445, 267, 5, 48, "Input",
 InitializationCell->True],
Cell[19349, 452, 2108, 55, 133, "Input",
 InitializationCell->True],
Cell[21460, 509, 740, 19, 112, "Input",
 InitializationCell->True],
Cell[22203, 530, 2842, 70, 217, "Input",
 InitializationCell->True],
Cell[25048, 602, 1506, 37, 175, "Input",
 InitializationCell->True],
Cell[26557, 641, 164, 3, 48, "Input",
 InitializationCell->True],
Cell[26724, 646, 210, 5, 48, "Input",
 InitializationCell->True],
Cell[26937, 653, 482, 13, 48, "Input",
 InitializationCell->True],
Cell[27422, 668, 2264, 61, 112, "Input",
 InitializationCell->True],
Cell[29689, 731, 959, 25, 70, "Input",
 InitializationCell->True],
Cell[30651, 758, 296, 9, 48, "Input",
 InitializationCell->True],
Cell[30950, 769, 3499, 79, 204, "Input",
 InitializationCell->True],
Cell[34452, 850, 526, 12, 48, "Input",
 InitializationCell->True],
Cell[34981, 864, 159, 4, 48, "Input",
 InitializationCell->True],
Cell[35143, 870, 140, 3, 48, "Input",
 InitializationCell->True],
Cell[35286, 875, 545, 14, 70, "Input",
 InitializationCell->True],
Cell[35834, 891, 579, 15, 70, "Input",
 InitializationCell->True],
Cell[36416, 908, 529, 13, 70, "Input",
 InitializationCell->True],
Cell[36948, 923, 165, 3, 48, "Input",
 InitializationCell->True],
Cell[37116, 928, 1977, 47, 133, "Input",
 InitializationCell->True],
Cell[39096, 977, 263, 6, 48, "Input",
 InitializationCell->True],
Cell[39362, 985, 824, 18, 91, "Input",
 InitializationCell->True],
Cell[40189, 1005, 297, 8, 48, "Input",
 InitializationCell->True],
Cell[40489, 1015, 1584, 40, 112, "Input",
 InitializationCell->True],
Cell[42076, 1057, 286, 8, 48, "Input",
 InitializationCell->True],
Cell[42365, 1067, 346, 10, 48, "Input",
 InitializationCell->True],
Cell[42714, 1079, 266, 7, 48, "Input",
 InitializationCell->True],
Cell[42983, 1088, 5045, 121, 261, "Input",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[48053, 1213, 153, 2, 35, "Subsubsection",
 InitializationCell->True],
Cell[48209, 1217, 551, 15, 48, "Input",
 InitializationCell->True],
Cell[48763, 1234, 498, 14, 51, "Input",
 InitializationCell->True],
Cell[49264, 1250, 276, 8, 48, "Input",
 InitializationCell->True],
Cell[49543, 1260, 480, 13, 48, "Input",
 InitializationCell->True],
Cell[50026, 1275, 659, 19, 48, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[50722, 1299, 141, 2, 35, "Subsubsection",
 InitializationCell->True],
Cell[50866, 1303, 620, 15, 48, "Input",
 InitializationCell->True],
Cell[51489, 1320, 1104, 29, 91, "Input",
 InitializationCell->True],
Cell[52596, 1351, 308, 7, 48, "Input",
 InitializationCell->True],
Cell[52907, 1360, 327, 8, 51, "Input",
 InitializationCell->True],
Cell[53237, 1370, 992, 27, 70, "Input",
 InitializationCell->True],
Cell[54232, 1399, 1068, 31, 70, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[55337, 1435, 144, 2, 35, "Subsubsection",
 InitializationCell->True],
Cell[55484, 1439, 1018, 30, 48, "Input",
 InitializationCell->True],
Cell[56505, 1471, 1138, 33, 91, "Input",
 InitializationCell->True],
Cell[57646, 1506, 738, 21, 48, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[58421, 1532, 140, 2, 35, "Subsubsection",
 InitializationCell->True],
Cell[58564, 1536, 3133, 79, 364, "Input",
 InitializationCell->True],
Cell[61700, 1617, 2531, 67, 238, "Input",
 InitializationCell->True],
Cell[64234, 1686, 192, 4, 48, "Input",
 InitializationCell->True],
Cell[64429, 1692, 190, 4, 48, "Input",
 InitializationCell->True]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[64668, 1702, 190, 3, 44, "Subsection",
 InitializationCell->True],
Cell[64861, 1707, 329, 8, 70, "Input",
 InitializationCell->True],
Cell[65193, 1717, 455, 13, 73, "Input",
 InitializationCell->True],
Cell[65651, 1732, 154, 3, 48, "Input",
 InitializationCell->True],
Cell[65808, 1737, 1147, 26, 70, "Input",
 InitializationCell->True],
Cell[66958, 1765, 590, 15, 48, "Input",
 InitializationCell->True],
Cell[67551, 1782, 903, 16, 70, "Input",
 InitializationCell->True],
Cell[68457, 1800, 573, 15, 48, "Input",
 InitializationCell->True],
Cell[69033, 1817, 574, 16, 48, "Input",
 InitializationCell->True],
Cell[69610, 1835, 2273, 57, 145, "Input",
 InitializationCell->True],
Cell[71886, 1894, 517, 14, 28, "Input",
 InitializationCell->True],
Cell[72406, 1910, 609, 16, 28, "Input",
 InitializationCell->True],
Cell[73018, 1928, 5535, 120, 285, "Input",
 InitializationCell->True],
Cell[78556, 2050, 181, 3, 28, "Input",
 InitializationCell->True],
Cell[78740, 2055, 4302, 82, 266, "Input",
 InitializationCell->True],
Cell[83045, 2139, 12933, 264, 558, "Input",
 InitializationCell->True],
Cell[95981, 2405, 1932, 48, 165, "Input",
 InitializationCell->True],
Cell[97916, 2455, 270, 7, 28, "Input",
 InitializationCell->True],
Cell[98189, 2464, 467, 12, 28, "Input",
 InitializationCell->True],
Cell[98659, 2478, 2390, 56, 131, "Input",
 InitializationCell->True],
Cell[101052, 2536, 2371, 57, 196, "Input",
 InitializationCell->True],
Cell[103426, 2595, 2652, 61, 165, "Input",
 InitializationCell->True],
Cell[106081, 2658, 3067, 74, 233, "Input",
 InitializationCell->True],
Cell[109151, 2734, 1274, 30, 97, "Input",
 InitializationCell->True],
Cell[110428, 2766, 6366, 146, 355, "Input",
 InitializationCell->True],
Cell[116797, 2914, 3381, 83, 268, "Input",
 InitializationCell->True],
Cell[120181, 2999, 11294, 237, 540, "Input",
 InitializationCell->True],
Cell[131478, 3238, 520, 14, 28, "Input",
 InitializationCell->True],
Cell[132001, 3254, 352, 9, 31, "Input",
 InitializationCell->True],
Cell[132356, 3265, 3126, 71, 132, "Input",
 InitializationCell->True],
Cell[135485, 3338, 3764, 83, 212, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[139286, 3426, 137, 2, 44, "Subsection",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[139448, 3432, 170, 2, 35, "Subsubsection",
 InitializationCell->True],
Cell[139621, 3436, 2913, 70, 217, "Input",
 InitializationCell->True],
Cell[142537, 3508, 1120, 20, 63, "Input",
 InitializationCell->True],
Cell[143660, 3530, 1138, 29, 80, "Input",
 InitializationCell->True],
Cell[144801, 3561, 757, 18, 46, "Input",
 InitializationCell->True],
Cell[145561, 3581, 3412, 89, 114, "Input",
 InitializationCell->True],
Cell[148976, 3672, 606, 15, 28, "Input",
 InitializationCell->True],
Cell[149585, 3689, 581, 15, 28, "Input",
 InitializationCell->True],
Cell[150169, 3706, 639, 16, 28, "Input",
 InitializationCell->True],
Cell[150811, 3724, 454, 10, 28, "Input",
 InitializationCell->True],
Cell[151268, 3736, 1566, 38, 63, "Input",
 InitializationCell->True],
Cell[152837, 3776, 1367, 38, 46, "Input",
 InitializationCell->True],
Cell[154207, 3816, 3213, 76, 199, "Input",
 InitializationCell->True],
Cell[157423, 3894, 317, 7, 28, "Input",
 InitializationCell->True],
Cell[157743, 3903, 1444, 42, 64, "Input",
 InitializationCell->True],
Cell[159190, 3947, 1419, 37, 80, "Input",
 InitializationCell->True],
Cell[160612, 3986, 1012, 29, 28, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[161661, 4020, 134, 2, 35, "Subsubsection",
 InitializationCell->True],
Cell[161798, 4024, 389, 10, 28, "Input",
 InitializationCell->True],
Cell[162190, 4036, 757, 21, 63, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[162984, 4062, 135, 2, 35, "Subsubsection",
 InitializationCell->True],
Cell[163122, 4066, 1154, 31, 46, "Input",
 InitializationCell->True],
Cell[164279, 4099, 1057, 27, 46, "Input",
 InitializationCell->True],
Cell[165339, 4128, 271, 6, 28, "Input",
 InitializationCell->True],
Cell[165613, 4136, 4809, 107, 335, "Input",
 InitializationCell->True],
Cell[170425, 4245, 511, 14, 28, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[170973, 4264, 189, 3, 35, "Subsubsection",
 InitializationCell->True],
Cell[171165, 4269, 461, 10, 63, "Input",
 InitializationCell->True],
Cell[171629, 4281, 2363, 66, 175, "Input",
 InitializationCell->True],
Cell[173995, 4349, 5855, 127, 352, "Input",
 InitializationCell->True],
Cell[179853, 4478, 2688, 60, 199, "Input",
 InitializationCell->True],
Cell[182544, 4540, 717, 17, 46, "Input",
 InitializationCell->True],
Cell[183264, 4559, 8590, 186, 522, "Input",
 InitializationCell->True],
Cell[191857, 4747, 15457, 326, 845, "Input",
 InitializationCell->True],
Cell[207317, 5075, 2404, 66, 148, "Input",
 InitializationCell->True],
Cell[209724, 5143, 4857, 118, 335, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[214618, 5266, 138, 2, 35, "Subsubsection",
 InitializationCell->True],
Cell[214759, 5270, 3730, 102, 236, "Input",
 InitializationCell->True],
Cell[218492, 5374, 1526, 43, 47, "Input",
 InitializationCell->True],
Cell[220021, 5419, 690, 16, 46, "Input",
 InitializationCell->True],
Cell[220714, 5437, 14764, 314, 846, "Input",
 InitializationCell->True],
Cell[235481, 5753, 1655, 41, 165, "Input",
 InitializationCell->True],
Cell[237139, 5796, 452, 13, 28, "Input",
 InitializationCell->True],
Cell[237594, 5811, 500, 11, 28, "Input",
 InitializationCell->True],
Cell[238097, 5824, 169, 3, 28, "Input",
 InitializationCell->True],
Cell[238269, 5829, 320, 7, 28, "Input",
 InitializationCell->True],
Cell[238592, 5838, 503, 13, 28, "Input",
 InitializationCell->True],
Cell[239098, 5853, 283, 7, 28, "Input",
 InitializationCell->True],
Cell[239384, 5862, 2032, 53, 131, "Input",
 InitializationCell->True],
Cell[241419, 5917, 332, 7, 28, "Input",
 InitializationCell->True],
Cell[241754, 5926, 375, 11, 28, "Input",
 InitializationCell->True],
Cell[242132, 5939, 2490, 65, 165, "Input",
 InitializationCell->True],
Cell[244625, 6006, 3998, 89, 199, "Input",
 InitializationCell->True],
Cell[248626, 6097, 3089, 66, 165, "Input",
 InitializationCell->True],
Cell[251718, 6165, 1450, 35, 46, "Input",
 InitializationCell->True],
Cell[253171, 6202, 21114, 417, 1185, "Input",
 InitializationCell->True],
Cell[274288, 6621, 2222, 58, 148, "Input",
 InitializationCell->True],
Cell[276513, 6681, 17445, 357, 1067, "Input",
 InitializationCell->True],
Cell[293961, 7040, 278, 7, 28, "Input",
 InitializationCell->True],
Cell[294242, 7049, 615, 18, 28, "Input",
 InitializationCell->True],
Cell[294860, 7069, 359, 9, 28, "Input",
 InitializationCell->True],
Cell[295222, 7080, 502, 14, 28, "Input",
 InitializationCell->True],
Cell[295727, 7096, 2249, 55, 114, "Input",
 InitializationCell->True],
Cell[297979, 7153, 10813, 235, 590, "Input",
 InitializationCell->True],
Cell[308795, 7390, 167, 4, 28, "Input",
 InitializationCell->True],
Cell[308965, 7396, 5136, 123, 165, "Input",
 InitializationCell->True],
Cell[314104, 7521, 1084, 27, 80, "Input",
 InitializationCell->True],
Cell[315191, 7550, 313, 8, 28, "Input",
 InitializationCell->True],
Cell[315507, 7560, 604, 16, 28, "Input",
 InitializationCell->True],
Cell[316114, 7578, 363, 9, 28, "Input",
 InitializationCell->True],
Cell[316480, 7589, 1652, 37, 97, "Input",
 InitializationCell->True],
Cell[318135, 7628, 1971, 50, 97, "Input",
 InitializationCell->True],
Cell[320109, 7680, 1070, 26, 80, "Input",
 InitializationCell->True],
Cell[321182, 7708, 1569, 39, 80, "Input",
 InitializationCell->True],
Cell[322754, 7749, 1712, 42, 97, "Input",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[324503, 7796, 126, 2, 35, "Subsubsection",
 InitializationCell->True],
Cell[324632, 7800, 1810, 45, 143, "Input",
 InitializationCell->True],
Cell[326445, 7847, 2931, 71, 170, "Input",
 InitializationCell->True],
Cell[329379, 7920, 1964, 55, 80, "Input",
 InitializationCell->True],
Cell[331346, 7977, 2185, 53, 114, "Input",
 InitializationCell->True]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[333592, 8037, 128, 2, 64, "Section",
 InitializationCell->True],
Cell[333723, 8041, 96, 3, 28, "Input",
 InitializationCell->True],
Cell[333822, 8046, 103, 3, 28, "Input",
 InitializationCell->True]
}, Open  ]]
}, Open  ]]
}
]
*)

